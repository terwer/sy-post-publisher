import{f as e,e as a,a as l,i as t,h as o,E as s,b as d,F as n}from"./vendor_element-plus-6396cda2.js";import{L as i,ab as u,c as p,ak as r,al as c,ac as m,am as f,ae as g,v as b,l as _,k as y,b as P,P as S,w as v,x as E,an as k,j as V,A as I,$ as h}from"./AppLayout.vue_vue_type_script_setup_true_lang-59c75e45.js";import{O,ad as D,z as K,M as U,A as Y,u as w,x as C,P as T,U as j,V as x,a2 as $,_ as A,Q as L,ao as N,a1 as q,$ as B,a0 as R,W as z,a3 as H,X as M,aN as F,aO as G}from"./vendor-42595716.js";import{u as J}from"./vendor_vue-i18n-8a61efa7.js";const Q={key:1},W=y(O({name:"PostBind",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(d){const n=d,y=i.getLogger("components/publish/tab/PostBind.vue"),{t:P}=J(),{tabCountStore:S,vuepressEnabled:v,hugoEnabled:E,hexoEnabled:k,jekyllEnabled:V,jvueEnabled:I,confEnabled:h,cnblogsEnabled:O,wordpressEnabled:M,liandiEnabled:F,yuqueEnabled:G,kmsEnabled:W,doCount:X}=u(),Z=D({dynamicConfigArray:[]}),ee=()=>{X();const e=m().totalCfg||[];Z.dynamicConfigArray.length=0,e.forEach((e=>{const a=f(e.platformKey);e.modelValue=g(a),Z.dynamicConfigArray.push(e)})),y.debug(Z.dynamicConfigArray)};K((()=>n.isReload),(async(e,a)=>{ee(),await se()})),U((async()=>{ee(),await se()})),Y((()=>{}));const ae={pageId:"",meta:{}},le=w(),te=D({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),oe=D({});async function se(){const e=await p(!0,n.pageId);if(y.debug("PostBind pageId=>",e),!e||""===e)return;const a=new b,l=await a.getBlockAttrs(e);ae.pageId=e,ae.meta=l,te.vuepressSlug=l[r.VUEPRESS_POSTID_KEY],te.hugoSlug=l[r.HUGO_POSTID_KEY],te.hexoSlug=l[r.HEXO_POSTID_KEY],te.jekyllSlug=l[r.JEKYLL_POSTID_KEY],te.jvuePostid=l[r.JVUE_POSTID_KEY],te.confPostid=l[r.CONFLUENCE_POSTID_KEY],te.cnblogsPostid=l[r.CNBLOGS_POSTID_KEY],te.wordpressPostid=l[r.WORDPRESS_POSTID_KEY],te.liandiPostid=l[r.LIANDI_POSTID_KEY],te.yuquePostid=l[r.YUQUE_POSTID_KEY],te.kmsPostid=l[r.KMS_POSTID_KEY];const t=Z.dynamicConfigArray;Z.dynamicConfigArray=[],t.forEach((e=>{const a=c(e.platformKey);e.posid=l[a]||"",Z.dynamicConfigArray.push(e)}))}const de=(e,a,l,t)=>{e&&!_(t)?Object.assign(a,{[l]:t}):Object.assign(a,{[l]:""})};return(d,n)=>{const i=e,u=a,p=l,m=t,f=o;return C(S).tabCount>0?(T(),j(m,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:le,model:te,rules:oe,"status-icon":""},{default:x((()=>[C(v)?(T(),j(u,{key:0,label:d.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:x((()=>[$(i,{modelValue:te.vuepressSlug,"onUpdate:modelValue":n[0]||(n[0]=e=>te.vuepressSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(E)?(T(),j(u,{key:1,label:d.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:x((()=>[$(i,{modelValue:te.hugoSlug,"onUpdate:modelValue":n[1]||(n[1]=e=>te.hugoSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(k)?(T(),j(u,{key:2,label:d.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:x((()=>[$(i,{modelValue:te.hexoSlug,"onUpdate:modelValue":n[2]||(n[2]=e=>te.hexoSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(V)?(T(),j(u,{key:3,label:d.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:x((()=>[$(i,{modelValue:te.jekyllSlug,"onUpdate:modelValue":n[3]||(n[3]=e=>te.jekyllSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(I)?(T(),j(u,{key:4,label:d.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:x((()=>[$(i,{modelValue:te.jvuePostid,"onUpdate:modelValue":n[4]||(n[4]=e=>te.jvuePostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(h)?(T(),j(u,{key:5,label:d.$t("post.bind.conf.postid"),prop:"confPostid"},{default:x((()=>[$(i,{modelValue:te.confPostid,"onUpdate:modelValue":n[5]||(n[5]=e=>te.confPostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(O)?(T(),j(u,{key:6,label:d.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:x((()=>[$(i,{modelValue:te.cnblogsPostid,"onUpdate:modelValue":n[6]||(n[6]=e=>te.cnblogsPostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(M)?(T(),j(u,{key:7,label:d.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:x((()=>[$(i,{modelValue:te.wordpressPostid,"onUpdate:modelValue":n[7]||(n[7]=e=>te.wordpressPostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(F)?(T(),j(u,{key:8,label:d.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:x((()=>[$(i,{modelValue:te.liandiPostid,"onUpdate:modelValue":n[8]||(n[8]=e=>te.liandiPostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(G)?(T(),j(u,{key:9,label:d.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:x((()=>[$(i,{modelValue:te.yuquePostid,"onUpdate:modelValue":n[9]||(n[9]=e=>te.yuquePostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),C(W)?(T(),j(u,{key:10,label:d.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:x((()=>[$(i,{modelValue:te.kmsPostid,"onUpdate:modelValue":n[10]||(n[10]=e=>te.kmsPostid=e)},null,8,["modelValue"])])),_:1},8,["label"])):A("",!0),(T(!0),L(q,null,N(Z.dynamicConfigArray,((e,a)=>z((T(),j(u,{key:a,label:e.platformName},{default:x((()=>[$(i,{modelValue:e.posid,"onUpdate:modelValue":a=>e.posid=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])),[[H,e.modelValue]]))),128)),$(u,null,{default:x((()=>[$(p,{type:"primary",onClick:n[11]||(n[11]=e=>(async e=>{if(!e)return;if(await e.validate(((e,a)=>{e?y.debug("校验成功"):y.error(P("main.opt.failure"),a)})))try{const e={};de(v.value,e,r.VUEPRESS_POSTID_KEY,te.vuepressSlug),de(E.value,e,r.HUGO_POSTID_KEY,te.hugoSlug),de(k.value,e,r.HEXO_POSTID_KEY,te.hexoSlug),de(V.value,e,r.JEKYLL_POSTID_KEY,te.jekyllSlug),de(I.value,e,r.JVUE_POSTID_KEY,te.jvuePostid),de(h.value,e,r.CONFLUENCE_POSTID_KEY,te.confPostid),de(O.value,e,r.CNBLOGS_POSTID_KEY,te.cnblogsPostid),de(M.value,e,r.WORDPRESS_POSTID_KEY,te.wordpressPostid),de(F.value,e,r.LIANDI_POSTID_KEY,te.liandiPostid),de(G.value,e,r.YUQUE_POSTID_KEY,te.yuquePostid),de(W.value,e,r.KMS_POSTID_KEY,te.kmsPostid),Z.dynamicConfigArray.forEach((a=>{const l=c(a.platformKey);de(a.modelValue,e,l,a.posid)})),y.debug("PostBind保存属性到思源笔记,meta=>",e);const a=new b;await a.setBlockAttrs(ae.pageId,e),s.success(P("main.opt.success"))}catch(a){y.error("保存异常",a);let e="保存异常";a&&(e=a.toString()),s.error({dangerouslyUseHTMLString:!0,message:P("main.opt.failure")+"=>"+e})}})(le.value))},{default:x((()=>[B(R(d.$t("post.bind.conf.save")),1)])),_:1})])),_:1})])),_:1},8,["model","rules"])):(T(),L("div",Q,[$(f,{class:"top-version-tip",title:d.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),[["__scopeId","data-v-56d92254"]]),X={class:"post-detail-wrap"},Z={key:0,style:{display:"none"}},ee={class:"post-detail-id"},ae={class:"id-text"},le=["innerHTML"],te=O({__name:"PostDetailService",props:{pageId:{type:String,default:void 0}},setup(e){const a=e,t=i.getLogger("components/blog/themes/default/PostDetailService.vue"),s=w(P());K((()=>a.pageId),((e,a)=>{y(),t.debug("文章详情查看初始化")}));const u=new S,p=w(u),r=w(!1),c=()=>{v()&&E(p.value.postid)},m=()=>{const e=p.value.postid,a=k("/detail/index.html?id="+e,"");v()&&E(a)},f=()=>{const e=p.value.postid;V("/detail/index.html?id="+e)},g=()=>{const e=p.value.postid;V("/picgo/index.html?id="+e)},b=()=>{const e=p.value.postid;V("/anki/index.html?id="+e)},_=()=>{r.value=!0},y=async()=>{if(!a.pageId||""===a.pageId)return;const e=new I(h.API_TYPE_SIYUAN),l=await e.getPost(a.pageId||"");p.value=l};return Y((async()=>{await y()})),(e,t)=>{const i=o,u=F("font-awesome-icon"),y=l,P=d,S=n,v=G("beauty"),E=G("highlight");return T(),L("div",X,[s.value?(T(),L("h1",Z,R(p.value.title),1)):A("",!0),$(i,{class:"top-share-tip",title:e.$t("siyuan.local.share.tip"),type:"warning",closable:!1},null,8,["title"]),M("blockquote",ee,[M("span",ae,"本文ID："+R(p.value.postid),1),$(P,{class:"box-item",effect:"dark",content:e.$t("post.detail.button.copy.id"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"warning",onClick:c},{default:x((()=>[$(u,{icon:"fa-solid fa-list-ol"})])),_:1})])),_:1},8,["content"]),$(P,{class:"box-item",effect:"dark",content:e.$t("post.detail.button.share.link"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"primary",onClick:m},{default:x((()=>[$(u,{icon:"fa-solid fa-share-nodes"})])),_:1})])),_:1},8,["content"]),$(P,{class:"box-item",effect:"dark",content:e.$t("post.detail.button.browser.open"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"danger",onClick:f},{default:x((()=>[$(u,{icon:"fa-brands fa-chrome"})])),_:1})])),_:1},8,["content"]),$(P,{class:"box-item",effect:"dark",content:e.$t("post.detail.button.pic.manage"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"primary",onClick:g},{default:x((()=>[$(u,{icon:"fa-solid fa-image"})])),_:1})])),_:1},8,["content"]),$(P,{class:"box-item",effect:"dark",content:e.$t("post.detail.button.anki.mark"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"success",onClick:b},{default:x((()=>[$(u,{icon:"fa-solid fa-credit-card"})])),_:1})])),_:1},8,["content"]),$(P,{class:"box-item",effect:"dark",content:e.$t("service.tab.post.bind"),placement:"bottom-start"},{default:x((()=>[$(y,{size:"small",type:"success",onClick:_},{default:x((()=>[$(u,{icon:"fa-solid fa-link"})])),_:1})])),_:1},8,["content"])]),z(M("div",{id:"post-detail-content",innerHTML:p.value.description},null,8,le),[[v],[E]]),$(S,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),title:e.$t("service.tab.post.bind")},{default:x((()=>[$(W,{"page-id":a.pageId},null,8,["page-id"])])),_:1},8,["modelValue","title"])])}}});export{te as _};

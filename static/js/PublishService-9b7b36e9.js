var ya=Object.defineProperty;var ba=(p,e,l)=>e in p?ya(p,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[e]=l;var ie=(p,e,l)=>(ba(p,typeof e!="symbol"?e+"":e,l),l);import{k as Ye,a as qe,s as ut,e as je,c as aa,d as la,j as Je,f as We,b as ha,n as _a,o as va,q as bt,r as ht,E as Y,h as Xe,g as it,t as Ca,u as wa,v as $t,w as At,x as It,y as Ft,z as oa,A as Bt,B as sa,C as na}from"./vendor_element-plus-d9283429.js";import{L as _e,q as st,s as Te,t as Ee,u as Pt,v as ua,w as at,D as lt,x as xt,y as ea,z as Ea,j as Ze,A as Se,B as Ut,E as Ta,F as Ie,G as Sa,H as ka,I as Da,b as rt,J as oe,K as nt,M as Oe,N as He,O as dt,Q as fe,R as Ge,P as Yt,T as Qe,U as pt,V as Pa,W as ye,e as Ue,X as ia,Y as tt,Z as Kt,$ as ke,a0 as ra,a1 as Ma,a2 as Mt,a3 as Vt,r as Ot,n as _t,a4 as vt,a5 as Rt,C as Lt,a6 as Nt,a7 as Ht,a8 as Gt,a9 as Va,aa as ze,ab as pe,ac as Me,ad as jt,ae as Wt,af as $a,ag as Aa,ah as qt,ai as Ia,aj as Fa,ak as Ba,al as Ua,am as Ya,an as Ka,ao as da,ap as pa,k as Oa,aq as Ra,ar as La,as as Na,at as Ha,au as Ga}from"./api-56d69f30.js";import{u as De}from"./vendor_vue-i18n-5b80ab8c.js";import{M as ae,u as v,ac as ce,A as Ke,O as u,T as g,U as a,a1 as t,y as s,_ as N,$ as L,Z as w,P as te,ao as $e,a0 as Ae,z as Re,F as Be,W as be,K as ja,V as Wa,a2 as qa,ap as Jt,X as yt,a8 as ca}from"./vendor-a9bad54d.js";import{d as Ja}from"./vendor_pinia-306dd1ce.js";import{d as zt}from"./vendor_shorthash2-e60185c0.js";import{c as za}from"./vendor_copy-to-clipboard-a51858f9.js";import{f as Qa}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{f as Xa}from"./vendor_cross-fetch-e4e57030.js";const wt=[{platformType:"Github",subPlatformType:"Github_Vitepress",platformKey:"githubVitepress-mhxj3",platformName:"Vitepress"},{platformType:"Github",subPlatformType:"Github_Nuxt",platformKey:"githubNuxt-z1xcb7x",platformName:"Nuxt content"},{platformType:"Github",subPlatformType:"Github_Next",platformKey:"githubNext-ziz9v8",platformName:"Nextra"}],Et=[{platformType:"Metaweblog",subPlatformType:"none",platformKey:"metaweblog-zahrlw",platformName:"\u5F00\u6E90\u4E2D\u56FD"},{platformType:"Metaweblog",subPlatformType:"none",platformKey:"metaweblog-22pamt",platformName:"Typeecho"}],Tt=[],Za=_e.getLogger("utils/import/importUtil.ts"),St=(p,e)=>{if(ua(e,p))return!1;const l="switch-"+p,n="custom-"+p+"-post-id";return!(at(p)||at(l)||at(n))},kt=(p,e,l,n)=>{const i=new lt(p,e,l);return i.subPlatformType=n,i},xa=()=>{const p=st().totalCfg||[];wt&&wt.length>0&&wt.forEach(e=>{if(St(e.platformKey,p)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te[e.subPlatformType]);p.push(l)}}),Et&&Et.length>0&&Et.forEach(e=>{if(St(e.platformKey,p)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te.NONE);p.push(l)}}),Tt&&Tt.length>0&&Tt.forEach(e=>{if(St(e.platformKey,p)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te.NONE);p.push(l)}}),Za.debug("\u5C06\u8981\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0\uFF1A",p),Pt(p)},el=ae({__name:"DynamicPlatform",setup(p){const e=_e.getLogger("components/publish/tab/DynamicPlatform.vue"),{t:l}=De(),n=v(!0),i=Te.Github_Jekyll,b=v(),r=ce({subtype:i,ptype:Ee.Github,dynCfg:new lt(Ee.Github,xt(Ee.Github,i),"Jekyll-1"),subtypeOptions:[],dynamicConfigArray:[]}),k=ce({platformName:[{required:!0,message:()=>l("form.validate.name.required")}]}),E=m=>{r.subtype=m,e.debug(r.subtype),y(r.ptype)},y=m=>{r.ptype=m,r.subtypeOptions=ea(m);const o=Ea(m,r.subtype,r.subtypeOptions.length>0&&r.subtype!==Te.NONE);r.dynCfg=new lt(m,xt(m,r.subtypeOptions.length>0?r.subtype:Te.NONE),o),n.value=r.ptype!==Ee.Custom,e.debug(r.ptype)},M=m=>{if(r.ptype===Ee.Custom)return Y.error(l("dynamic.platform.opt.noselect")),!1;const o=r.dynCfg.platformKey;if(e.debug("\u5C06\u8981\u4FDD\u5B58\u7684\u5E73\u53F0key",o),ua(r.dynamicConfigArray,o))return Y.error(l("dynamic.platform.opt.key.exist")),!1;const C="switch-"+o,c="custom-"+o+"-post-id";return at(o)||at(C)||at(c)?(Y.error(l("dynamic.platform.opt.key.exist")),!1):!0},A=async m=>{if(!m||!M()||!await m.validate((c,f)=>{c?e.debug("\u6821\u9A8C\u6210\u529F"):e.error(l("main.opt.failure"),f)}))return;const C=new lt(r.ptype,r.dynCfg.platformKey,r.dynCfg.platformName);r.ptype===Ee.Github?C.subPlatformType=r.subtype:C.subPlatformType=Te.NONE,r.dynamicConfigArray.push(C),Pt(r.dynamicConfigArray),h(),Y.success(l("main.opt.success"))},D=[],$=v(0),U=v(),V=v(l("dynamic.platform.opt.item.select")),_=m=>{U.value=m,V.value=l("dynamic.platform.opt.item.select.tip")+U.value.platformName,e.debug(U.value)},B=async()=>{Xe.confirm(l("dynamic.platform.opt.del.confirm"),l("main.opt.warning"),{confirmButtonText:l("main.opt.ok"),cancelButtonText:l("main.opt.cancel"),type:"warning"}).then(async()=>{if(!U.value||!U.value.platformKey){Y.error(l("dynamic.platform.opt.item.no.select.tip"));return}for(let m=0;m<r.dynamicConfigArray.length;m++)U.value.platformKey===r.dynamicConfigArray[m].platformKey&&r.dynamicConfigArray.splice(m,1);Pt(r.dynamicConfigArray),h(),Y.success(l("main.opt.success"))}).catch(()=>{})},h=()=>{D.length=0;for(let m=0;m<r.dynamicConfigArray.length;m++)D.push(r.dynamicConfigArray[m]);$.value=r.dynamicConfigArray.length},d=async()=>{r.subtypeOptions=ea(Ee.Github),r.dynamicConfigArray=st().totalCfg||[],h(),e.debug("dynamic init page=>",r.dynamicConfigArray)};return Ke(async()=>{e.info("\u5F00\u59CB\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0..."),xa(),e.info("\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0\u6210\u529F."),await d()}),(m,o)=>{const C=Ye,c=qe,f=ut,P=je,J=aa,F=la,T=Je,I=We,K=ha,H=_a,q=va,Z=bt,Q=ht;return u(),g(Q,null,{default:a(()=>[t(K,{height:"300px",class:"publish-dyn-header"},{default:a(()=>[t(I,{"label-width":"165px",ref_key:"formRef",ref:b,model:r.dynCfg,rules:k},{default:a(()=>[t(C,{class:"top-version-tip",title:m.$t("dynamic.platform.tip"),type:"info",closable:!1},null,8,["title"]),t(P,{label:m.$t("dynamic.platform.type")},{default:a(()=>[t(f,null,{default:a(()=>[t(c,{type:r.ptype===s(Ee).Github?"primary":"",onClick:o[0]||(o[0]=re=>y(s(Ee).Github))},{default:a(()=>[N(L(m.$t("dynamic.platform.type.github")),1)]),_:1},8,["type"]),t(c,{type:r.ptype===s(Ee).Metaweblog?"primary":"",onClick:o[1]||(o[1]=re=>y(s(Ee).Metaweblog))},{default:a(()=>[N(L(m.$t("dynamic.platform.type.metaweblog")),1)]),_:1},8,["type"]),t(c,{type:r.ptype===s(Ee).Wordpress?"primary":"",onClick:o[2]||(o[2]=re=>y(s(Ee).Wordpress))},{default:a(()=>[N(L(m.$t("dynamic.platform.type.wordpress")),1)]),_:1},8,["type"]),t(c,{type:r.ptype===s(Ee).Custom?"primary":"",onClick:o[3]||(o[3]=re=>y(s(Ee).Custom))},{default:a(()=>[N(L(m.$t("dynamic.platform.type.custom")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),n.value?w("",!0):(u(),g(P,{key:0},{default:a(()=>[t(C,{title:"\u656C\u8BF7\u671F\u5F85",type:"info",closable:!1})]),_:1})),r.subtypeOptions.length>0&&n.value?(u(),g(P,{key:1},{default:a(()=>[t(F,{modelValue:r.subtype,"onUpdate:modelValue":o[4]||(o[4]=re=>r.subtype=re),class:"m-2",placeholder:"Select",onChange:E},{default:a(()=>[(u(!0),te(Ae,null,$e(r.subtypeOptions,re=>(u(),g(J,{key:re,label:re,value:re},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):w("",!0),n.value?(u(),g(P,{key:2,label:r.ptype+m.$t("dynamic.platform.name"),prop:"platformName"},{default:a(()=>[t(T,{modelValue:r.dynCfg.platformName,"onUpdate:modelValue":o[5]||(o[5]=re=>r.dynCfg.platformName=re),placeholder:m.$t("dynamic.platform.name.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),w("",!0),n.value?(u(),g(P,{key:4},{default:a(()=>[t(c,{type:"primary",onClick:o[6]||(o[6]=re=>A(b.value))},{default:a(()=>[N(L(m.$t("dynamic.platform.opt.add")),1)]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules"])]),_:1}),t(Z,{class:"dyn-table-list"},{default:a(()=>[t(P,null,{default:a(()=>[(u(),g(q,{data:D,key:$.value,border:"",stripe:"","highlight-current-row":"","empty-text":"\u6682\u65E0\u6570\u636E",onCurrentChange:_},{default:a(()=>[t(H,{prop:"platformType",label:m.$t("dynamic.platform.type")},null,8,["label"]),t(H,{prop:"subPlatformType",label:m.$t("dynamic.platform.subtype")},null,8,["label"]),t(H,{prop:"platformKey",label:m.$t("dynamic.platform.key")},null,8,["label"]),t(H,{prop:"platformName",label:m.$t("dynamic.platform.name")},null,8,["label"])]),_:1}))]),_:1}),t(P,null,{default:a(()=>[U.value?(u(),g(C,{key:0,class:"top-version-tip",title:V.value,type:"info",closable:!1},null,8,["title"])):w("",!0),t(c,{type:"danger",onClick:B},{default:a(()=>[N(L(m.$t("dynamic.platform.opt.del.select")),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const tl=Ze(el,[["__scopeId","data-v-bc346138"]]),al=Ja("tabCount",()=>{const p=v(0);function e(){p.value=0}function l(n){n&&p.value++}return{tabCount:p,resetCount:e,incrementIf:l}}),ll="switch-vuepress",ol="switch-hugo",sl="switch-hexo",nl="switch-jekyll",ul="switch-jvue",il="switch-conf",rl="switch-cnblogs",dl="switch-wordpress",pl="switch-liandi",cl="switch-yuque",ml="switch-kms",he={SWITCH_VUEPRESS_KEY:ll,SWITCH_HUGO_KEY:ol,SWITCH_HEXO_KEY:sl,SWITCH_JEKYLL_KEY:nl,SWITCH_JVUE_KEY:ul,SWITCH_CONF_KEY:il,SWITCH_CNBLOGS_KEY:rl,SWITCH_WORDPRESS_KEY:dl,SWITCH_LIANDI_KEY:pl,SWITCH_YUQUE_KEY:cl,SWITCH_KMS_KEY:ml},Ct=()=>{const p=al(),e=v(!1),l=v(!1),n=v(!1),i=v(!1),b=v(!1),r=v(!1),k=v(!1),E=v(!1),y=v(!1),M=v(!1),A=v(!1),D=ce({dynamicConfigArray:[]});function $(){p.resetCount(),e.value=Se(he.SWITCH_VUEPRESS_KEY),p.incrementIf(e.value),l.value=Se(he.SWITCH_HUGO_KEY),p.incrementIf(l.value),n.value=Se(he.SWITCH_HEXO_KEY),p.incrementIf(n.value),i.value=Se(he.SWITCH_JEKYLL_KEY),p.incrementIf(i.value),b.value=Se(he.SWITCH_JVUE_KEY),p.incrementIf(b.value),r.value=Se(he.SWITCH_CONF_KEY),p.incrementIf(r.value),k.value=Se(he.SWITCH_CNBLOGS_KEY),p.incrementIf(k.value),E.value=Se(he.SWITCH_WORDPRESS_KEY),p.incrementIf(E.value),y.value=Se(he.SWITCH_LIANDI_KEY),p.incrementIf(y.value),M.value=Se(he.SWITCH_YUQUE_KEY),p.incrementIf(M.value),A.value=Se(he.SWITCH_KMS_KEY),p.incrementIf(A.value);const V=st().totalCfg||[];D.dynamicConfigArray=[],V.forEach(_=>{const B=Ut(_.platformKey),h=Se(B);_.modelValue=Ta({switchKey:_.platformKey,switchValue:h}),p.incrementIf(h),D.dynamicConfigArray.push(_)})}return{tabCountStore:p,vuepressEnabled:e,hugoEnabled:l,hexoEnabled:n,jekyllEnabled:i,jvueEnabled:b,confEnabled:r,cnblogsEnabled:k,wordpressEnabled:E,liandiEnabled:y,yuqueEnabled:M,kmsEnabled:A,switchFormData:D,doCount:$}},gl={key:0},fl=ae({__name:"ServiceSwitch",props:{isReload:{type:Boolean,default:!1}},setup(p){const e=p,{tabCountStore:l,vuepressEnabled:n,hugoEnabled:i,hexoEnabled:b,jekyllEnabled:r,jvueEnabled:k,confEnabled:E,cnblogsEnabled:y,wordpressEnabled:M,liandiEnabled:A,yuqueEnabled:D,kmsEnabled:$,switchFormData:U,doCount:V}=Ct(),_=v(!1),B=K=>{Ie(he.SWITCH_VUEPRESS_KEY,K),I()},h=K=>{Ie(he.SWITCH_HUGO_KEY,K),I()},d=K=>{Ie(he.SWITCH_HEXO_KEY,K),I()},m=K=>{Ie(he.SWITCH_JEKYLL_KEY,K),I()},o=K=>{Ie(he.SWITCH_JVUE_KEY,K),I()},C=K=>{Ie(he.SWITCH_CONF_KEY,K),I()},c=K=>{Ie(he.SWITCH_CNBLOGS_KEY,K),I()},f=K=>{Ie(he.SWITCH_WORDPRESS_KEY,K),I()},P=K=>{Ie(he.SWITCH_LIANDI_KEY,K),I()},J=K=>{Ie(he.SWITCH_YUQUE_KEY,K),I()},F=K=>{Ie(he.SWITCH_KMS_KEY,K),I()},T=K=>{const H=Da(K);Ie(H.switchKey,H.switchValue),I()},I=()=>{V(),l.tabCount===0?_.value=!0:_.value=!1};return Re(()=>e.isReload,async(K,H)=>{I()}),Ke(()=>{I()}),(K,H)=>{const q=it,Z=je,Q=Ye,re=We;return u(),g(re,{class:"switch-form",inline:""},{default:a(()=>[t(Z,{label:K.$t("service.switch.vuepress")},{default:a(()=>[t(q,{modelValue:s(n),"onUpdate:modelValue":H[0]||(H[0]=X=>Be(n)?n.value=X:null),onChange:B},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.hugo")},{default:a(()=>[t(q,{modelValue:s(i),"onUpdate:modelValue":H[1]||(H[1]=X=>Be(i)?i.value=X:null),onChange:h},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.hexo")},{default:a(()=>[t(q,{modelValue:s(b),"onUpdate:modelValue":H[2]||(H[2]=X=>Be(b)?b.value=X:null),onChange:d},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.jekyll")},{default:a(()=>[t(q,{modelValue:s(r),"onUpdate:modelValue":H[3]||(H[3]=X=>Be(r)?r.value=X:null),onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.jvue")},{default:a(()=>[t(q,{modelValue:s(k),"onUpdate:modelValue":H[4]||(H[4]=X=>Be(k)?k.value=X:null),onChange:o},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.conf")},{default:a(()=>[t(q,{modelValue:s(E),"onUpdate:modelValue":H[5]||(H[5]=X=>Be(E)?E.value=X:null),onChange:C},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.cnblogs")},{default:a(()=>[t(q,{modelValue:s(y),"onUpdate:modelValue":H[6]||(H[6]=X=>Be(y)?y.value=X:null),onChange:c},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.wordpress")},{default:a(()=>[t(q,{modelValue:s(M),"onUpdate:modelValue":H[7]||(H[7]=X=>Be(M)?M.value=X:null),onChange:f},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.liandi")},{default:a(()=>[t(q,{modelValue:s(A),"onUpdate:modelValue":H[8]||(H[8]=X=>Be(A)?A.value=X:null),onChange:P},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.yuque")},{default:a(()=>[t(q,{modelValue:s(D),"onUpdate:modelValue":H[9]||(H[9]=X=>Be(D)?D.value=X:null),onChange:J},null,8,["modelValue"])]),_:1},8,["label"]),t(Z,{label:K.$t("service.switch.kms")},{default:a(()=>[t(q,{modelValue:s($),"onUpdate:modelValue":H[10]||(H[10]=X=>Be($)?$.value=X:null),onChange:F},null,8,["modelValue"])]),_:1},8,["label"]),(u(!0),te(Ae,null,$e(s(U).dynamicConfigArray,X=>(u(),g(Z,{key:X.posid,label:X.platformName},{default:a(()=>[t(q,{modelValue:X.modelValue,"onUpdate:modelValue":Fe=>X.modelValue=Fe,"active-value":s(Sa)(X.platformKey),"inactive-value":s(ka)(X.platformKey),onChange:T},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])]),_:2},1032,["label"]))),128)),_.value?(u(),te("div",gl,[be("p",null,[t(Q,{title:K.$t("platform.must.select.one"),type:"error",closable:!1},null,8,["title"])])])):w("",!0)]),_:1})}}});const yl=Ze(fl,[["__scopeId","data-v-aa0af289"]]),bl={key:1},hl={name:"PostBind"},_l=ae({...hl,props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/PostBind.vue"),{t:n}=De(),{tabCountStore:i,vuepressEnabled:b,hugoEnabled:r,hexoEnabled:k,jekyllEnabled:E,jvueEnabled:y,confEnabled:M,cnblogsEnabled:A,wordpressEnabled:D,liandiEnabled:$,yuqueEnabled:U,kmsEnabled:V,doCount:_}=Ct(),B=ce({dynamicConfigArray:[]}),h=()=>{_();const T=st().totalCfg||[];B.dynamicConfigArray.length=0,T.forEach(I=>{const K=Ut(I.platformKey);I.modelValue=Se(K),B.dynamicConfigArray.push(I)}),l.debug(B.dynamicConfigArray)};Re(()=>e.isReload,async(F,T)=>{h(),await c()}),ja(async()=>{h(),await c()}),Ke(()=>{});const d={pageId:"",meta:{}},m=v(),o=ce({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),C=ce({});async function c(){const F=await rt(!0,e.pageId);if(l.debug("PostBind pageId=>",F),!F||F==="")return;const I=await new Oe().getBlockAttrs(F);d.pageId=F,d.meta=I,o.vuepressSlug=I[oe.VUEPRESS_POSTID_KEY],o.hugoSlug=I[oe.HUGO_POSTID_KEY],o.hexoSlug=I[oe.HEXO_POSTID_KEY],o.jekyllSlug=I[oe.JEKYLL_POSTID_KEY],o.jvuePostid=I[oe.JVUE_POSTID_KEY],o.confPostid=I[oe.CONFLUENCE_POSTID_KEY],o.cnblogsPostid=I[oe.CNBLOGS_POSTID_KEY],o.wordpressPostid=I[oe.WORDPRESS_POSTID_KEY],o.liandiPostid=I[oe.LIANDI_POSTID_KEY],o.yuquePostid=I[oe.YUQUE_POSTID_KEY],o.kmsPostid=I[oe.KMS_POSTID_KEY];const K=B.dynamicConfigArray;B.dynamicConfigArray=[],K.forEach(H=>{const q=nt(H.platformKey);H.posid=I[q]||"",B.dynamicConfigArray.push(H)})}const f=(F,T,I,K)=>{F&&!He(K)?Object.assign(T,{[I]:K}):Object.assign(T,{[I]:""})},P=async F=>{if(!(!F||!await F.validate((I,K)=>{I?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(n("main.opt.failure"),K)})))try{const I={};f(b.value,I,oe.VUEPRESS_POSTID_KEY,o.vuepressSlug),f(r.value,I,oe.HUGO_POSTID_KEY,o.hugoSlug),f(k.value,I,oe.HEXO_POSTID_KEY,o.hexoSlug),f(E.value,I,oe.JEKYLL_POSTID_KEY,o.jekyllSlug),f(y.value,I,oe.JVUE_POSTID_KEY,o.jvuePostid),f(M.value,I,oe.CONFLUENCE_POSTID_KEY,o.confPostid),f(A.value,I,oe.CNBLOGS_POSTID_KEY,o.cnblogsPostid),f(D.value,I,oe.WORDPRESS_POSTID_KEY,o.wordpressPostid),f($.value,I,oe.LIANDI_POSTID_KEY,o.liandiPostid),f(U.value,I,oe.YUQUE_POSTID_KEY,o.yuquePostid),f(V.value,I,oe.KMS_POSTID_KEY,o.kmsPostid),B.dynamicConfigArray.forEach(H=>{const q=nt(H.platformKey);f(H.modelValue,I,q,H.posid)}),l.debug("PostBind\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",I),await new Oe().setBlockAttrs(d.pageId,I),Y.success(n("main.opt.success"))}catch(I){l.error("\u4FDD\u5B58\u5F02\u5E38",I);let K="\u4FDD\u5B58\u5F02\u5E38";I&&(K=I.toString()),Y.error({dangerouslyUseHTMLString:!0,message:n("main.opt.failure")+"=>"+K})}},J=F=>{!F||F.resetFields()};return(F,T)=>{const I=Je,K=je,H=qe,q=We,Z=Ye;return s(i).tabCount>0?(u(),g(q,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:m,model:o,rules:C,"status-icon":""},{default:a(()=>[s(b)?(u(),g(K,{key:0,label:F.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:a(()=>[t(I,{modelValue:o.vuepressSlug,"onUpdate:modelValue":T[0]||(T[0]=Q=>o.vuepressSlug=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(K,{key:1,label:F.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:a(()=>[t(I,{modelValue:o.hugoSlug,"onUpdate:modelValue":T[1]||(T[1]=Q=>o.hugoSlug=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(K,{key:2,label:F.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:a(()=>[t(I,{modelValue:o.hexoSlug,"onUpdate:modelValue":T[2]||(T[2]=Q=>o.hexoSlug=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(E)?(u(),g(K,{key:3,label:F.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:a(()=>[t(I,{modelValue:o.jekyllSlug,"onUpdate:modelValue":T[3]||(T[3]=Q=>o.jekyllSlug=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(K,{key:4,label:F.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:a(()=>[t(I,{modelValue:o.jvuePostid,"onUpdate:modelValue":T[4]||(T[4]=Q=>o.jvuePostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(M)?(u(),g(K,{key:5,label:F.$t("post.bind.conf.postid"),prop:"confPostid"},{default:a(()=>[t(I,{modelValue:o.confPostid,"onUpdate:modelValue":T[5]||(T[5]=Q=>o.confPostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(K,{key:6,label:F.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:a(()=>[t(I,{modelValue:o.cnblogsPostid,"onUpdate:modelValue":T[6]||(T[6]=Q=>o.cnblogsPostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(K,{key:7,label:F.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:a(()=>[t(I,{modelValue:o.wordpressPostid,"onUpdate:modelValue":T[7]||(T[7]=Q=>o.wordpressPostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s($)?(u(),g(K,{key:8,label:F.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:a(()=>[t(I,{modelValue:o.liandiPostid,"onUpdate:modelValue":T[8]||(T[8]=Q=>o.liandiPostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(U)?(u(),g(K,{key:9,label:F.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:a(()=>[t(I,{modelValue:o.yuquePostid,"onUpdate:modelValue":T[9]||(T[9]=Q=>o.yuquePostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(V)?(u(),g(K,{key:10,label:F.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:a(()=>[t(I,{modelValue:o.kmsPostid,"onUpdate:modelValue":T[10]||(T[10]=Q=>o.kmsPostid=Q)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),(u(!0),te(Ae,null,$e(B.dynamicConfigArray,(Q,re)=>Wa((u(),g(K,{key:re,label:Q.platformName},{default:a(()=>[t(I,{modelValue:Q.posid,"onUpdate:modelValue":X=>Q.posid=X},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])),[[qa,Q.modelValue]])),128)),t(K,null,{default:a(()=>[t(H,{type:"primary",onClick:T[11]||(T[11]=Q=>P(m.value))},{default:a(()=>[N(L(F.$t("post.bind.conf.save")),1)]),_:1}),t(H,{onClick:T[12]||(T[12]=Q=>J(m.value))},{default:a(()=>[N(L(F.$t("post.bind.conf.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):(u(),te("div",bl,[t(Z,{class:"top-version-tip",title:F.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});const vl=Ze(_l,[["__scopeId","data-v-1e3d85a4"]]);class Cl extends dt{constructor(e){switch(super("","","","",""),this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.posidKey=nt(e.platformKey),this.blogName=e.subPlatformType,e.subPlatformType){case Te.Github_Vuepress:this.defaultPath="docs",this.mdFilenameRule="[filename].md";break;case Te.Github_Hugo:this.defaultPath="content/post",this.mdFilenameRule="[slug].md";break;case Te.Github_Hexo:this.defaultPath="source/_posts",this.mdFilenameRule="[slug].md";break;case Te.Github_Jekyll:this.defaultPath="_posts",this.mdFilenameRule="[yyyy]-[mm]-[dd]-[slug].md";break;case Te.Github_Vitepress:this.defaultPath="docs",this.previewUrl="/[docpath].html",this.mdFilenameRule="[slug].md";break;case Te.Github_Nuxt:this.defaultPath="content",this.previewUrl="/[docpath]",this.mdFilenameRule="[slug].md";break;case Te.Github_Next:this.defaultPath="pages",this.previewUrl="/[docpath]",this.mdFilenameRule="[slug].md";break}}}var Pe=(p=>(p[p.Markdown=0]="Markdown",p[p.Html=1]="Html",p))(Pe||{});class xe{constructor(e,l,n,i){ie(this,"home");ie(this,"apiUrl");ie(this,"username");ie(this,"password");ie(this,"apiStatus");ie(this,"blogName");ie(this,"posidKey");ie(this,"previewUrl");ie(this,"pageType");this.home=e,this.apiUrl=l,this.username=n,this.password=i,this.apiStatus=!1,this.blogName="",this.posidKey="",this.previewUrl="",this.pageType=Pe.Markdown}}class wl extends xe{constructor(e){super("","","",""),this.posidKey=e,this.previewUrl="/p/[postid].html",this.pageType=Pe.Html}}class El extends xe{constructor(e){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=e,this.previewUrl="/?p=[postid]",this.pageType=Pe.Html}}const Tl={class:"github-setting-basic"},Sl={href:"https://github.com/settings/tokens/new",target:"_blank"},kl={key:0,class:"github-setting-advanced"},ct=ae({__name:"GithubSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:dt,default:null}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/setting/GithubSetting.vue"),{t:n}=De(),i=v(!1),b=v(!1),r=v(!1),k=v(!0),E=v(),y=ce({githubUser:"",githubRepo:"",githubToken:"",defaultBranch:"main",defaultPath:"docs/_posts",msg:"auto published by sy-post-publisher",author:"terwer",email:"youweics@163.com",home:"",baseUrl:"",previewMdUrl:"",previewUrl:"",mdFilenameRule:"[filename]"}),M=ce({githubUser:[{required:!0,message:()=>n("form.validate.name.required")}],githubRepo:[{required:!0,message:()=>n("form.validate.name.required")}],githubToken:[{required:!0,message:()=>n("form.validate.name.required")}],defaultBranch:[{required:!0,message:()=>n("form.validate.name.required")}],defaultPath:[{required:!0,message:()=>n("form.validate.name.required")}],msg:[{required:!0,message:()=>n("form.validate.name.required")}],author:[{required:!0,message:()=>n("form.validate.name.required")}],email:[{required:!0,message:()=>n("form.validate.name.required")}]}),A=()=>{i.value=!1},D=()=>{i.value=!0},$=d=>{k.value=d},U=d=>{!d||d.resetFields()},V=async d=>{!d||!await d.validate((o,C)=>{o?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(n("main.opt.failure"),C)})||B(!1)},_=async()=>{b.value=!0,B(!0);const d=fe(e.apiType);let m;try{const o=new Ge(e.apiType),C=new Yt;C.postid="content/post/test.md",C.description="# Hello world";let c;try{c=await o.newPost(C)}catch(f){m=f,d.apiStatus=!1,r.value=!1}c?(d.apiStatus=!0,r.value=!0):(d.apiStatus=!1,r.value=!1),k.value&&await o.deletePost(C.postid)}catch(o){d.apiStatus=!1,r.value=!1,l.error(o)}Qe(e.apiType,d),r.value?Y.success(n("main.opt.success")):m?Y.error(n("setting.blog.vali.error")+"=>"+m):Y.error(n("setting.blog.vali.error")),b.value=!1},B=d=>{const m=e.cfg;m.githubUser=y.githubUser,m.githubRepo=y.githubRepo,m.githubToken=y.githubToken,m.defaultPath=y.defaultPath,m.defaultBranch=y.defaultBranch,m.defaultMsg=y.msg,m.author=y.author,m.email=y.email,m.home=y.home,m.baseUrl=y.baseUrl,m.previewMdUrl=y.previewMdUrl,m.previewUrl=y.previewUrl,m.mdFilenameRule=y.mdFilenameRule,m.apiStatus=r.value,Qe(e.apiType,m),d!==!0&&Y.success(n("main.opt.success"))},h=()=>{let d=fe(e.apiType);pt(d)&&(d=e.cfg),d&&(y.githubUser=d.githubUser,y.githubRepo=d.githubRepo,y.githubToken=d.githubToken,y.defaultPath=d.defaultPath,y.defaultBranch=d.defaultBranch,y.msg=d.defaultMsg,y.author=d.author,y.email=d.email,y.home=d.home,y.baseUrl=d.baseUrl,y.previewMdUrl=d.previewMdUrl,y.previewUrl=d.previewUrl,y.mdFilenameRule=d.mdFilenameRule,r.value=d.apiStatus)};return Ke(async()=>{h()}),(d,m)=>{const o=qe,C=ut,c=je,f=Je,P=it,J=Ye,F=We;return u(),g(F,{"label-width":"120px",ref_key:"formRef",ref:E,model:y,rules:M,"status-icon":""},{default:a(()=>[t(c,{label:d.$t("main.publish.editmode")},{default:a(()=>[t(C,null,{default:a(()=>[t(o,{type:i.value?"default":"primary",onClick:A},{default:a(()=>[N(L(d.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(o,{type:i.value?"primary":"default",onClick:D},{default:a(()=>[N(L(d.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),be("div",Tl,[t(c,{label:d.$t("setting.blog.type.github.user"),prop:"githubUser"},{default:a(()=>[t(f,{modelValue:y.githubUser,"onUpdate:modelValue":m[0]||(m[0]=T=>y.githubUser=T),placeholder:d.$t("setting.blog.type.github.user.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.repo"),prop:"githubRepo"},{default:a(()=>[t(f,{modelValue:y.githubRepo,"onUpdate:modelValue":m[1]||(m[1]=T=>y.githubRepo=T),placeholder:d.$t("setting.blog.type.github.repo.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.default.branch"),prop:"defaultBranch"},{default:a(()=>[t(f,{modelValue:y.defaultBranch,"onUpdate:modelValue":m[2]||(m[2]=T=>y.defaultBranch=T),placeholder:d.$t("setting.blog.type.github.default.branch.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.token"),prop:"githubToken"},{default:a(()=>[t(f,{type:"password",modelValue:y.githubToken,"onUpdate:modelValue":m[3]||(m[3]=T=>y.githubToken=T),placeholder:d.$t("setting.blog.type.github.token.tip"),"show-password":""},null,8,["modelValue","placeholder"]),be("a",Sl,L(d.$t("setting.blog.type.github.token.gen")),1)]),_:1},8,["label"])]),i.value?(u(),te("div",kl,[t(c,{label:d.$t("setting.blog.type.github.default.path"),prop:"defaultPath"},{default:a(()=>[t(f,{modelValue:y.defaultPath,"onUpdate:modelValue":m[4]||(m[4]=T=>y.defaultPath=T),placeholder:d.$t("setting.blog.type.github.default.path.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.msg"),prop:"msg"},{default:a(()=>[t(f,{modelValue:y.msg,"onUpdate:modelValue":m[5]||(m[5]=T=>y.msg=T),placeholder:d.$t("setting.blog.type.github.msg.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.author"),prop:"author"},{default:a(()=>[t(f,{modelValue:y.author,"onUpdate:modelValue":m[6]||(m[6]=T=>y.author=T),placeholder:d.$t("setting.blog.type.github.author.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.type.github.email"),prop:"email"},{default:a(()=>[t(f,{modelValue:y.email,"onUpdate:modelValue":m[7]||(m[7]=T=>y.email=T),placeholder:d.$t("setting.blog.type.github.email.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.common.home")},{default:a(()=>[t(f,{modelValue:y.home,"onUpdate:modelValue":m[8]||(m[8]=T=>y.home=T),placeholder:d.$t("setting.common.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.github.baseUrl")},{default:a(()=>[t(f,{modelValue:y.baseUrl,"onUpdate:modelValue":m[9]||(m[9]=T=>y.baseUrl=T),placeholder:d.$t("setting.github.baseUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.previewMdUrl")},{default:a(()=>[t(f,{modelValue:y.previewMdUrl,"onUpdate:modelValue":m[10]||(m[10]=T=>y.previewMdUrl=T),placeholder:d.$t("setting.blog.previewMdUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.previewUrl")},{default:a(()=>[t(f,{modelValue:y.previewUrl,"onUpdate:modelValue":m[11]||(m[11]=T=>y.previewUrl=T),placeholder:d.$t("setting.blog.previewUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{label:d.$t("setting.blog.mdFilenameRule")},{default:a(()=>[t(f,{modelValue:y.mdFilenameRule,"onUpdate:modelValue":m[12]||(m[12]=T=>y.mdFilenameRule=T),placeholder:d.$t("setting.blog.mdFilenameRule.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])):w("",!0),t(c,{label:d.$t("form.validate.github.auto.delete")},{default:a(()=>[t(P,{modelValue:k.value,"onUpdate:modelValue":m[13]||(m[13]=T=>k.value=T),onChange:$},null,8,["modelValue"])]),_:1},8,["label"]),t(c,null,{default:a(()=>[t(o,{type:"primary",onClick:_,loading:b.value},{default:a(()=>[N(L(b.value?d.$t("setting.blog.vali.ing"):d.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),r.value?w("",!0):(u(),g(J,{key:0,title:d.$t("setting.blog.vali.tip"),type:"warning",closable:!1},null,8,["title"])),r.value?(u(),g(J,{key:1,title:d.$t("setting.blog.vali.ok"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(c,null,{default:a(()=>[t(o,{type:"primary",onClick:m[14]||(m[14]=T=>V(E.value))},{default:a(()=>[N(L(d.$t("setting.blog.save")),1)]),_:1}),t(o,{onClick:m[15]||(m[15]=T=>U(E.value))},{default:a(()=>[N(L(d.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Dl=ae({__name:"VuepressSetting",setup(p){const e=v(ye.API_TYPE_VUEPRESS),l=new Pa,n=v(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Pl extends dt{constructor(){super("",Te.Github_Hugo,"","",""),this.defaultPath="content/post",this.posidKey=oe.HUGO_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[slug].md"}}const Ml=ae({__name:"HugoSetting",setup(p){const e=v(ye.API_TYPE_HUGO),l=new Pl,n=v(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Vl extends dt{constructor(){super("",Te.Github_Hexo,"","",""),this.defaultPath="source/_posts",this.posidKey=oe.HEXO_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[slug].md"}}const $l=ae({__name:"HexoSetting",setup(p){const e=v(ye.API_TYPE_HEXO),l=new Vl,n=v(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Al extends dt{constructor(){super("",Te.Github_Jekyll,"","",""),this.defaultPath="_posts",this.posidKey=oe.JEKYLL_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[yyyy]-[mm]-[dd]-[slug].md"}}const Il=ae({__name:"JekyllSetting",setup(p){const e=v(ye.API_TYPE_JEKYLL),l=new Al,n=v(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Fl extends xe{constructor(){super("https://[your-jvue-site]","https://[your-jvue-site]/xmlrpc","",""),this.posidKey=oe.JVUE_POSTID_KEY,this.previewUrl="/post/[postid].html",this.pageType=Pe.Markdown}}const mt=ae({__name:"MetaweblogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:xe,default:null}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/setting/MetaweblogSetting.vue"),{t:n}=De(),i=parseInt(Pe.Markdown.toString()),b=v(""),r=v(""),k=v(""),E=v(""),y=v(""),M=v(i),A=v(!1),D=v(!1),$=v(""),U=v(n("setting.blog.platform.support.metaweblog")+e.apiType+" "),V=async()=>{A.value=!0;try{_(!0);const h=fe(e.apiType),m=await new Ge(e.apiType).getUsersBlogs();if(m&&m.length>0){const o=m[0];h.blogName=o.blogName,$.value=o.blogName,h.apiStatus=!0,D.value=!0}else h.apiStatus=!1,D.value=!1;Qe(e.apiType,h)}catch(h){console.error(h)}D.value?Y.success(n("main.opt.success")):Y.error(n("setting.blog.vali.error")),A.value=!1,l.debug("Metaweblog\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},_=h=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const d=e.cfg;d.home=b.value,d.username=E.value,d.password=y.value,d.apiUrl=r.value,d.previewUrl=k.value,d.blogName=$.value,d.pageType=M.value,d.apiStatus=D.value,Qe(e.apiType,d),h!==!0&&Y.success(n("main.opt.success"))},B=()=>{l.debug("Metaweblog\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=fe(e.apiType);pt(h)&&(h=e.cfg),h&&(l.debug("get setting conf=>",h),b.value=h.home,r.value=h.apiUrl,k.value=h.previewUrl,E.value=h.username,y.value=h.password,$.value=h.blogName,M.value=h.pageType,D.value=h.apiStatus)};return Ke(async()=>{B()}),(h,d)=>{const m=Ye,o=Je,C=je,c=Ca,f=wa,P=qe,J=We;return u(),g(J,{"label-width":"120px"},{default:a(()=>[t(m,{class:"top-version-tip",title:U.value+$.value,type:"info",closable:!1},null,8,["title"]),t(C,{label:h.$t("setting.blog.url")},{default:a(()=>[t(o,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=F=>b.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.username")},{default:a(()=>[t(o,{modelValue:E.value,"onUpdate:modelValue":d[1]||(d[1]=F=>E.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.password")},{default:a(()=>[t(o,{type:"password",modelValue:y.value,"onUpdate:modelValue":d[2]||(d[2]=F=>y.value=F),"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.apiurl")},{default:a(()=>[t(o,{modelValue:r.value,"onUpdate:modelValue":d[3]||(d[3]=F=>r.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.previewUrl")},{default:a(()=>[t(o,{modelValue:k.value,"onUpdate:modelValue":d[4]||(d[4]=F=>k.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.pageType")},{default:a(()=>[t(f,{modelValue:M.value,"onUpdate:modelValue":d[5]||(d[5]=F=>M.value=F),class:"ml-4"},{default:a(()=>[t(c,{label:0,size:"large"},{default:a(()=>[N("Markdown")]),_:1}),t(c,{label:1,size:"large"},{default:a(()=>[N("HTML")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(C,null,{default:a(()=>[t(P,{type:"primary",onClick:V,loading:A.value},{default:a(()=>[N(L(A.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),D.value?w("",!0):(u(),g(m,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),D.value?(u(),g(m,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(C,null,{default:a(()=>[t(P,{type:"primary",onClick:_},{default:a(()=>[N(L(h.$t("setting.blog.save")),1)]),_:1}),t(P,null,{default:a(()=>[N(L(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Bl=ae({__name:"JVueSetting",setup(p){const e=v(ye.API_TYPE_JVUE),l=v(new Fl);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Ul extends xe{constructor(){super("https://youweics.atlassian.net/wiki/spaces/[spaceKey]","http://localhost:3000/api/xmlrpc","",""),this.posidKey=oe.CONFLUENCE_POSTID_KEY,this.previewUrl="pages/[postid]",this.pageType=Pe.Html}}const Yl=ae({__name:"ConfluenceSetting",setup(p){const e=v(ye.API_TYPE_CONFLUENCE),l=v(new Ul);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Kl extends xe{constructor(){super("https://www.cnblogs.com/[yourblog]","https://rpc.cnblogs.com/metaweblog/[yourblog]","",""),this.posidKey=oe.CNBLOGS_POSTID_KEY,this.previewUrl="/p/[postid].html",this.pageType=Pe.Markdown}}const Ol=ae({__name:"CnblogsSetting",setup(p){const e=v(ye.API_TYPE_CNBLOGS),l=new Kl,n=v(l);return(i,b)=>(u(),g(mt,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Rl extends xe{constructor(){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=oe.WORDPRESS_POSTID_KEY,this.previewUrl="/?p=[postid]",this.pageType=Pe.Markdown}}const ta=ae({__name:"WordpressSetting",setup(p){const e=v(ye.API_TYPE_WORDPRESS),l=v(new Rl);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class gt{constructor(){ie(this,"home");ie(this,"apiUrl");ie(this,"username");ie(this,"password");ie(this,"token");ie(this,"apiStatus");ie(this,"blogName");ie(this,"blogid");ie(this,"posidKey");ie(this,"previewUrl");ie(this,"pageType");ie(this,"tokenSettingUrl");this.home="",this.apiUrl="",this.username="",this.password="",this.token="",this.apiStatus=!1,this.blogName="",this.blogid="",this.posidKey="",this.previewUrl="",this.pageType=Pe.Markdown,this.tokenSettingUrl=""}}class Ll extends gt{constructor(){super(),this.home="https://ld246.com/",this.apiUrl="https://ld246.com/api/v2",this.tokenSettingUrl="https://ld246.com/settings/account",this.posidKey=oe.LIANDI_POSTID_KEY,this.previewUrl="/article/[postid]",this.pageType=Pe.Markdown}}const Nl=["href"],Hl=["href"],Qt=ae({__name:"CommonBlogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},usernameEnabled:{type:Boolean,default:!1},passwordEnabled:{type:Boolean,default:!1},tokenEnabled:{type:Boolean,default:!1}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/setting/CommonBlogSetting.vue"),{t:n}=De(),i=v(""),b=v(""),r=v(""),k=v(""),E=v(""),y=v(!1),M=v(!1),A=v(""),D=v(""),$=v(""),U=v(n("setting.blog.platform.support.common")+e.apiType+" "),V=async()=>{y.value=!0;try{_(!0);const h=fe(e.apiType),m=await new Ge(e.apiType).getUsersBlogs();if(m&&m.length>0){const o=m[0];h.apiStatus=!0,M.value=!0,h.blogName=o.blogName,A.value=o.blogName,h.blogid=o.blogid,D.value=o.blogid,Qe(e.apiType,h)}else h.apiStatus=!1,M.value=!1,Qe(e.apiType,h)}catch(h){console.error(h)}M.value?Y.success(n("main.opt.success")):Y.error(n("setting.blog.vali.error")),y.value=!1,l.debug("\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},_=h=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const d=e.cfg;d.home=i.value,d.username=r.value,d.password=k.value,d.token=E.value,d.apiUrl=b.value,d.apiStatus=M.value,d.blogName=A.value,d.blogid=D.value,Qe(e.apiType,d),h!==!0&&Y.success(n("main.opt.success"))},B=()=>{l.debug("\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=fe(e.apiType);pt(h)&&(h=e.cfg),h&&(l.debug("get setting conf=>",h),i.value=h.home||"",b.value=h.apiUrl||"",r.value=h.username||"",k.value=h.password||"",E.value=h.token||"",M.value=h.apiStatus||!1,A.value=h.blogName||"",D.value=h.blogid||"",$.value=h.tokenSettingUrl||"")};return Ke(async()=>{B()}),(h,d)=>{const m=Ye,o=Je,C=je,c=qe,f=We;return u(),g(f,{"label-width":"120px"},{default:a(()=>[t(m,{class:"top-version-tip",title:U.value+A.value,type:"info",closable:!1},null,8,["title"]),t(C,{label:h.$t("setting.common.home")},{default:a(()=>[t(o,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=P=>i.value=P)},null,8,["modelValue"])]),_:1},8,["label"]),e.usernameEnabled?(u(),g(C,{key:0,label:h.$t("setting.common.username")},{default:a(()=>[t(o,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=P=>r.value=P)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),e.passwordEnabled?(u(),g(C,{key:1,label:h.$t("setting.common.password")},{default:a(()=>[t(o,{type:"password",modelValue:k.value,"onUpdate:modelValue":d[2]||(d[2]=P=>k.value=P),"show-password":""},null,8,["modelValue"]),be("a",{href:$.value,target:"_blank"},L(h.$t("setting.common.username.gen"))+"\uFF1A"+L($.value),9,Nl)]),_:1},8,["label"])):w("",!0),e.tokenEnabled?(u(),g(C,{key:2,label:h.$t("setting.common.token")},{default:a(()=>[t(o,{type:"password",modelValue:E.value,"onUpdate:modelValue":d[3]||(d[3]=P=>E.value=P),"show-password":""},null,8,["modelValue"]),be("a",{href:$.value,target:"_blank"},L(h.$t("setting.common.token.gen"))+"\uFF1A"+L($.value),9,Hl)]),_:1},8,["label"])):w("",!0),t(C,{label:h.$t("setting.common.apiurl")},{default:a(()=>[t(o,{modelValue:b.value,"onUpdate:modelValue":d[4]||(d[4]=P=>b.value=P)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,null,{default:a(()=>[t(c,{type:"primary",onClick:V,loading:y.value},{default:a(()=>[N(L(y.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),M.value?w("",!0):(u(),g(m,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),M.value?(u(),g(m,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(C,null,{default:a(()=>[t(c,{type:"primary",onClick:_},{default:a(()=>[N(L(h.$t("setting.blog.save")),1)]),_:1}),t(c,null,{default:a(()=>[N(L(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Gl=ae({__name:"LiandiSetting",setup(p){const e=v(ye.API_TYPE_LIANDI),l=new Ll,n=v(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}});class jl extends gt{constructor(){super(),this.home="https://www.yuque.com/",this.apiUrl="https://www.yuque.com/api/v2",this.tokenSettingUrl="https://www.yuque.com/settings/tokens",this.posidKey=oe.YUQUE_POSTID_KEY,this.previewUrl="/[notebook]/[postid]",this.pageType=Pe.Markdown}}const Wl=ae({__name:"YuqueSetting",setup(p){const e=v(ye.API_TYPE_YUQUE),l=new jl,n=v(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}});class ql extends gt{constructor(){super(),this.home="http://localhost:9564/kms16_release/kms/multidoc",this.apiUrl="http://localhost:9564/kms16_release/api/kms-multidoc/kmsMultidocKnowledgeRestService",this.tokenSettingUrl="http://localhost:9564/kms16_release/sys/profile/index.jsp#integrate/RestService/",this.posidKey=oe.KMS_POSTID_KEY,this.previewUrl="/kms_multidoc_knowledge/kmsMultidocKnowledge.do?method=view&fdId=[postid]",this.pageType=Pe.Html}}const Jl=ae({__name:"KmsSetting",setup(p){const e=v(ye.API_TYPE_KMS),l=new ql,n=v(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"password-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}}),zl={key:1},Ql=ae({__name:"PlatformSetting",props:{isReload:{type:Boolean,default:!1}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/PlatformSetting.vue"),{tabCountStore:n,vuepressEnabled:i,hugoEnabled:b,hexoEnabled:r,jekyllEnabled:k,jvueEnabled:E,confEnabled:y,cnblogsEnabled:M,wordpressEnabled:A,liandiEnabled:D,yuqueEnabled:$,kmsEnabled:U,doCount:V}=Ct(),_=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),B=v(C=>new Cl(C)),h=v(C=>new wl(nt(C.platformKey))),d=v(C=>new El(nt(C.platformKey))),m=C=>{const c=[];return C.forEach(f=>{const P=new lt(f.platformType,f.platformKey,f.platformName);P.subPlatformType=f.subPlatformType;const J=Ut(f.platformKey),F=Se(J);P.modelValue=F,F&&c.push(P)}),c},o=()=>{V();const C=st();_.dynamicConfigArray=m(C.totalCfg||[]),_.githubArray=m(C.githubCfg||[]),_.metaweblogArray=m(C.metaweblogCfg||[]),_.wordpressArray=m(C.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(C))};return Re(()=>e.isReload,(C,c)=>{o(),l.debug("platform-setting\u521D\u59CB\u5316")}),Ke(()=>{o()}),(C,c)=>{const f=$t,P=At,J=Ye;return s(n).tabCount>0?(u(),g(P,{key:0,type:"border-card"},{default:a(()=>[s(i)?(u(),g(f,{key:0,label:C.$t("setting.vuepress")+C.$t("setting.blog.setting")},{default:a(()=>[t(Dl)]),_:1},8,["label"])):w("",!0),s(b)?(u(),g(f,{key:1,label:C.$t("setting.hugo")+C.$t("setting.blog.setting")},{default:a(()=>[t(Ml)]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(f,{key:2,label:C.$t("setting.hexo")+C.$t("setting.blog.setting")},{default:a(()=>[t($l)]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(f,{key:3,label:C.$t("setting.jekyll")+C.$t("setting.blog.setting")},{default:a(()=>[t(Il)]),_:1},8,["label"])):w("",!0),s(E)?(u(),g(f,{key:4,label:C.$t("setting.jvue")+C.$t("setting.blog.setting")},{default:a(()=>[t(Bl)]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(f,{key:5,label:C.$t("setting.conf")+C.$t("setting.blog.setting")},{default:a(()=>[t(Yl)]),_:1},8,["label"])):w("",!0),s(M)?(u(),g(f,{key:6,label:C.$t("setting.cnblogs")+C.$t("setting.blog.setting")},{default:a(()=>[t(Ol)]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(f,{key:7,label:C.$t("setting.wordpress")+C.$t("setting.blog.setting")},{default:a(()=>[t(ta)]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(f,{key:8,label:C.$t("setting.liandi")+C.$t("setting.blog.setting")},{default:a(()=>[t(Gl)]),_:1},8,["label"])):w("",!0),s($)?(u(),g(f,{key:9,label:C.$t("setting.yuque")+C.$t("setting.blog.setting")},{default:a(()=>[t(Wl)]),_:1},8,["label"])):w("",!0),s(U)?(u(),g(f,{key:10,label:C.$t("setting.kms")+C.$t("setting.blog.setting")},{default:a(()=>[t(Jl)]),_:1},8,["label"])):w("",!0),(u(!0),te(Ae,null,$e(_.githubArray,F=>(u(),g(f,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(ct,{"api-type":F.platformKey,cfg:B.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),te(Ae,null,$e(_.metaweblogArray,F=>(u(),g(f,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(mt,{"api-type":F.platformKey,cfg:h.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),te(Ae,null,$e(_.wordpressArray,F=>(u(),g(f,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(ta,{"api-type":F.platformKey,cfg:d.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),te("div",zl,[t(J,{class:"top-version-tip",title:C.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),Xl="custom-slug",Zl="custom-desc",Ve={SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY:Xl,SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY:Zl},Dt={VITE_LOG_INFO_ENABLED:"false",VITE_SIYUAN_API_URL:"http://127.0.0.1:6806",VITE_SIYUAN_CONFIG_TOKEN:"",VITE_MIDDLEWARE_URL:"https://publish.terwer.space/api/middleware"}.TEST==="true",xl="test-data-siyuanPage",eo={CONSTANTS_SIYUAN_PAGE:xl},to=(p,e)=>{const l=_e.getLogger("composables/publish/makeSlugCom.ts"),{t:n}=De(),i=new Oe,b=Ue(),r=ce({isSlugLoading:!1,forceRefresh:!1,title:"",customSlug:"",slugHashEnabled:!0}),k=e.siyuanPageMethods,E=()=>He(r.customSlug)?!0:r.forceRefresh;return{slugData:r,slugMethods:{makeSlug:async M=>{if(!E()){M!==!0&&Y.warning(n("main.force.refresh.tip")),l.debug(n("main.force.refresh.tip"));return}r.isSlugLoading=!0,l.debug("\u5F00\u59CB\u751F\u6210\u522B\u540D...");try{const A=await k.getPageId();if(Dt){const V=ia(eo.CONSTANTS_SIYUAN_PAGE),_=JSON.parse(JSON.parse(V));vi.spyOn(i,"getBlockByID").mockResolvedValue(_)}const D=await i.getBlockByID(A);l.debug("\u83B7\u53D6\u5230\u601D\u6E90\u9875\u9762\u6570\u636E=>",D);const $=r.title;if(b.useGoogleTranslate)try{let V;Dt?V=await vi.fn().mockImplementation(B=>tt(B))($):V=await Kt($),l.debug("\u4F7F\u7528\u8C37\u6B4C\u7FFB\u8BD1"),V?r.customSlug=V:(r.customSlug=tt($),Y.success(n("main.opt.failure")))}catch{r.customSlug=tt($)}else r.customSlug=tt($);if(l.debug("\u5B8C\u6210\u522B\u540D\u7FFB\u8BD1"),r.slugHashEnabled){const V=D.content+new Date().toISOString(),_=ke("-",zt(V).toLowerCase());r.customSlug+=_,l.debug("\u4E3A\u522B\u540D\u6DFB\u52A0hash")}const U={[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:r.customSlug};Dt&&vi.spyOn(i,"setBlockAttrs").mockResolvedValue(void 0),await i.setBlockAttrs(A,U),M!==!0&&Y.success(n("main.opt.success")),l.info("\u751F\u6210\u522B\u540D\u6B63\u5E38\u5B8C\u6210,slugData=>",r)}catch(A){const D=ke(n("main.opt.failure"),"=>",A);M!==!0&&Y.error(D),l.error(D)}r.isSlugLoading=!1,l.debug("\u751F\u6210\u522B\u540D\u7ED3\u675F.")},getSlugData:()=>r,initSlug:M=>{let A=M.page.content;b.fixTitle&&(A=ra(A)),l.debug("\u6807\u9898\u5904\u7406\u5B8C\u6BD5"),r.title=A;const D=Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY;r.customSlug=M.meta[D],l.debug("initSlug=>",r)},syncSlug:M=>{r.title=M.formData.title,r.customSlug=M.formData.customSlug}}}},ao=()=>{const p=_e.getLogger("composables/publish/makeYamlCom.ts"),{t:e}=De(),l=ce({yamlObj:{},readMode:!0,yamlPreviewContent:"",yamlContent:"",isSaved:!0,formatter:"",mdContent:"",mdFullContent:"",htmlContent:""});return{yamlData:l,yamlMethods:{onYamlContentFocus:i=>{i.preventDefault(),i.target.select(),Ma()&&navigator.clipboard.writeText(l.yamlContent).then(function(){Y.success(e("main.opt.success"))},function(r){Y.error(e("main.opt.failure")+r)})},onYamlContentInput:()=>{l.isSaved=!1},onYamlContextMenu:i=>{i.preventDefault()},doConvertAttrToYAML:(i,b,r)=>{i||(i=new Mt,p.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const k=i.convertToYaml(b,r);l.yamlObj=k.yamlObj,l.formatter=k.formatter,l.mdContent=k.mdContent,l.mdFullContent=k.formatter+`

`+k.mdContent,l.htmlContent=k.htmlContent},doConvertYAMLToAttr:(i,b,r)=>{i||(i=new Mt,p.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const k=i.convertToAttr(b,r);return p.debug("doConvertYAMLToAttr\u8F6C\u6362\u4E2D\u8F6C\u6570\u636EpostForm=>",k),k},copyYamlToClipboard:()=>{za(l.yamlContent),Y.success(e("main.opt.success"))},getYamlData:()=>l,initYaml:i=>{l.yamlContent=i,l.yamlPreviewContent=ke(i)}}}},lo=(p,e)=>{const l=_e.getLogger("composables/publish/publishActionCom.ts"),{t:n}=De(),i=new Oe,b=ce({isPublishLoading:!1,isCancelLoading:!1}),r=e.siyuanPageMethods,k=e.yamlMethods,E=e.githubPagesMethods,y=e.quickMethods,M=e.initPublishMethods,A={doPublish:async()=>{var D;l.debug("\u51C6\u5907\u53D1\u5E03\u6587\u7AE0..."),b.isPublishLoading=!0;try{const $=fe(p.apiType),U=new Vt($);if(M.getInitPublishData().isPublished)try{await A.doCancel(!1)}catch(h){l.error("\u5F3A\u5236\u5220\u9664\u5F02\u5E38\uFF0C\u4E0D\u5F71\u54CD\u53D1\u5E03=>",h)}const V=E.getGithubPagesData().mdTitle;let _=Ot(V);if(_=_.replace(/\.md/g,""),/[\s*|\\.]/g.test(_)){l.debug("fmtTitle=>",_),Y.error("\u6587\u4EF6\u540D\u4E0D\u80FD\u5305\u542B\u7A7A\u683C\u6216\u8005\u7279\u6B8A\u5B57\u7B26"),b.isPublishLoading=!1;return}M.getInitPublishData().isPublished?await y.saveAttrToSiyuan(!0):y.getQuickData().onclickFlag?await y.saveAttrToSiyuan(!0):await y.doOneclickAttr();const B=$.apiStatus;if(!B&&E.getGithubPagesData().githubEnabled){b.isPublishLoading=!1,Y.error("\u68C0\u6D4B\u5230api\u4E0D\u53EF\u7528\u6216\u8005\u914D\u7F6E\u9519\u8BEF\uFF0C\u65E0\u6CD5\u53D1\u5E03\u5230Github\uFF0C\u8BF7\u8F6C\u5230\u6E90\u7801\u6A21\u5F0F\u81EA\u884C\u590D\u5236\u6587\u672C");return}else if(B&&E.getGithubPagesData().githubEnabled){l.debug("\u5F00\u59CB\u771F\u6B63\u8C03\u7528api\u53D1\u5E03\u5230Github");let h=E.getGithubPagesData().customPath;const d=(D=$.defaultPath)!=null?D:"\u5C1A\u672A\u914D\u7F6E",m=E.getGithubPagesData().mdTitle;E.initGithubPages({cpath:h,defpath:d,fname:m}),M.convertAttrToYAML(!0);const o=k.getYamlData().mdFullContent;l.debug("\u5373\u5C06\u53D1\u5E03\u7684\u5185\u5BB9\uFF0CmdContent=>",{mdFullContent:o});const C=E.getGithubPagesData().publishPath;if(!await U.publishGithubPage(C,o)){b.isPublishLoading=!1,Y.error(n("main.publish.vuepress.failure"));return}const f={[$.posidKey]:C},P=await r.getPageId();await i.setBlockAttrs(P,f),l.debug("VuepressMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58\u8DEF\u5F84,meta=>",f),await M.initPage(),b.isPublishLoading=!1}l.debug("\u6587\u7AE0\u53D1\u5E03\u5B8C\u6210."),M.getInitPublishData().isPublished?Y.success(n("main.opt.status.updated")):Y.success(n("main.opt.status.publish"))}catch($){const U=ke(n("main.opt.failure"),"=>",$);Y.error(U),l.error(U)}b.isPublishLoading=!1},cancelPublish:async()=>{l.debug("\u51C6\u5907\u53D6\u6D88\u6587\u7AE0\u53D1\u5E03..."),b.isCancelLoading=!0,Xe.confirm(n("main.opt.warning.tip"),n("main.opt.warning"),{confirmButtonText:n("main.opt.ok"),cancelButtonText:n("main.opt.cancel"),type:"warning"}).then(async()=>{await A.doCancel(!0),b.isCancelLoading=!1,Y.warning(n("main.opt.status.cancel"))}).catch(D=>{D.toString().indexOf("cancel")<=-1&&(Y({type:"error",message:n("main.opt.failure")+"=>"+D}),l.error(n("main.opt.failure")+"=>"+D)),b.isCancelLoading=!1})},doCancel:async D=>{const $=fe(p.apiType),U=new Vt($),V=E.getGithubPagesData().publishPath;l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0CdocPath=>",V),await U.deleteGithubPage(V);const _={[$.posidKey]:""},B=await r.getPageId();await i.setBlockAttrs(B,_),l.debug(p.apiType+"_Main\u53D6\u6D88\u53D1\u5E03,meta=>",_),D&&await M.initPage()}};return{publishData:b,publishMethods:A}},oo=(p,e)=>{const l=_e.getLogger("composables/publish/publishQuickCom.ts"),{t:n}=De(),i=new Oe,b=ce({isGenLoading:!1,onclickFlag:!1}),r=e.siyuanPageMethods,k=e.slugMethods,E=e.descMethods,y=e.tagMethods,M={oneclickAttr:async A=>{Xe.confirm(n("main.opt.onclick.confirm.tip"),n("main.opt.warning"),{confirmButtonText:n("main.opt.ok"),cancelButtonText:n("main.opt.cancel"),type:"warning"}).then(async()=>{b.isGenLoading=!0,await M.doOneclickAttr(),b.isGenLoading=!1,l.debug("\u4E00\u952E\u751F\u6210\u5C5E\u6027\u5B8C\u6210."),A!==!0&&Y.success(n("main.publish.oneclick.attr.finish"))}).catch(D=>{b.isGenLoading=!1,D.toString().indexOf("cancel")<=-1&&(Y({type:"error",message:n("main.opt.failure")+"=>"+D}),l.error(n("main.opt.failure")+"=>"+D))})},doOneclickAttr:async()=>{await k.makeSlug(!0),await E.makeDesc(!0),await y.fetchTag(!0),await M.saveAttrToSiyuan(!0),b.onclickFlag=!0,l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210")},saveAttrToSiyuan:async A=>{try{const D=k.getSlugData(),$=E.getDescData(),U=y.getTagData(),V={[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:D.customSlug,[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:$.desc,tags:U.join(",")},_=await r.getPageId();await i.setBlockAttrs(_,V),A!==!0&&Y.success(n("main.opt.success"))}catch(D){const $=ke(n("main.opt.failure"),"=>",D);A!==!0&&Y.error(ke(n("main.opt.failure"),"=>",D)),l.error($)}},getQuickData:()=>b};return{quickData:b,quickMethods:M}},so=(p,e)=>{const l=_e.getLogger("composables/publish/makeDescCom.ts"),{t:n}=De(),i=new Oe,b=ce({isDescLoading:!1,desc:""}),r=e.siyuanPageMethods;return{descData:b,descMethods:{makeDesc:async E=>{l.debug("\u51C6\u5907\u751F\u6210\u6458\u8981..."),b.isDescLoading=!0;try{const y=Ue(),M=await r.getPageId(),D=(await i.exportMdContent(M)).content;let $=_t(D);y.removeH1&&($=vt($)),b.desc=Rt($,Lt.MAX_PREVIEW_LENGTH,!0);const U={[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:b.desc};await i.setBlockAttrs(M,U),E!==!0&&Y.success(n("main.opt.success"))}catch(y){E!==!0&&Y.error(ke(n("main.opt.failure"),"=>",y))}b.isDescLoading=!1,l.debug("\u6458\u8981\u751F\u6210\u5B8C\u6BD5.")},getDescData:()=>b,initDesc:E=>{const y=Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY;b.desc=E.meta[y]},syncDesc:E=>{b.desc=E.formData.desc}}}},no=()=>{const p=ce({created:""});return{publishTimeData:p,publishTimeMethods:{getPublishTime:()=>p,initPublishTime:l=>{p.created=Nt(l.page.created)},syncPublishTime:l=>{p.created=l.formData.created}}}};class uo{constructor(){ie(this,"pageId");ie(this,"meta");ie(this,"page");ie(this,"content")}}const ma=p=>{const e=_e.getLogger("composables/publish/siyuanPageCom.ts"),{t:l}=De(),n=new Oe,i=ce({dataObj:new uo});return{siyuanPageData:i,siyuanPageMethods:{getPageId:async()=>{const r=await rt(!0,p.pageId);if(!r||r==="")throw e.error(l("page.no.id")),new Error("page.no.id");return e.debug("\u5F53\u524D\u9875\u9762ID\u4E3A=>",r),r},getSiyuanPageData:()=>i,initSiyuanPage:async r=>{i.dataObj.pageId=r,i.dataObj.meta=await n.getBlockAttrs(r),i.dataObj.page=await n.getBlockByID(r),i.dataObj.content=await n.exportMdContent(r)}}}},io=p=>{const e=_e.getLogger("composables/publish/makeTagCom.ts"),{t:l}=De(),n=new Oe,i=ce({isTagLoading:!1,tagSwitch:!1,tag:{inputValue:"",dynamicTags:[],inputVisible:!1}}),{siyuanPageMethods:b}=ma(p);return{tagData:i,tagMethods:{tagHandleClose:k=>{i.tag.dynamicTags.splice(i.tag.dynamicTags.indexOf(k),1)},tagShowInput:()=>{i.tag.inputVisible=!0},tagHandleInputConfirm:()=>{i.tag.inputValue&&i.tag.dynamicTags.push(i.tag.inputValue),i.tag.inputVisible=!1,i.tag.inputValue=""},fetchTag:async k=>{try{if(!i.tagSwitch){Y.warning(l("main.tag.auto.switch.no.tip"));return}i.isTagLoading=!0;const E=await b.getPageId(),M=(await n.exportMdContent(E)).content,A=await Ht(M);e.debug("genTags=>",A);const D=Gt(A,5);e.debug("hotTags=>",D);for(let U=0;U<D.length;U++)i.tag.dynamicTags.includes(D[U])||i.tag.dynamicTags.push(D[U]);const $={tags:i.tag.dynamicTags.join(",")};await n.setBlockAttrs(E,$),k!==!0&&Y.success(l("main.opt.success"))}catch(E){const y=ke(l("main.opt.failure"),"=>",E);k!==!0&&Y.error(y),e.error(y)}i.isTagLoading=!1,k!==!0&&Y.success(l("main.opt.success"))},getTagData:()=>i.tag.dynamicTags,initTag:k=>{const E=Ue();i.tag.dynamicTags=[];const M=(k.meta.tags||"").split(",");for(let A=0;A<M.length;A++)M[A]!==""&&i.tag.dynamicTags.push(M[A]);E.autoTag&&i.tag.dynamicTags.length===0&&(i.tagSwitch=!0)},syncTag:k=>{for(let E=0;E<k.formData.tag.dynamicTags.length;E++){const y=k.formData.tag.dynamicTags[E];!i.tag.dynamicTags.includes(y)&&y!==""&&i.tag.dynamicTags.push(y)}}}}},ro=(p,e)=>{const l=_e.getLogger("composables/publish/githubPagesCom.ts"),n=ce({githubEnabled:!1,useDefaultPath:!1,currentDefaultPath:"",customPath:"",mdTitle:"",path:{customProps:{label:"label",children:"children",isLeaf:"isLeaf"}},publishPath:""}),i=e.siyuanPageMethods,b=e.slugMethods,r={githubOnChange:k=>{n.githubEnabled=k},defaultPathOnChange:k=>{var E;if(n.useDefaultPath=k,k==!0){const y=fe(p.apiType);r.initGithubPages({cpath:(E=y.defaultPath)!=null?E:"",defpath:n.currentDefaultPath,fname:n.mdTitle})}},customLoad:async(k,E)=>{if(k.isLeaf)return E([]);l.debug("\u76EE\u524D\u5DF2\u4FDD\u5B58\u8DEF\u5F84=>",n.customPath),l.debug("\u5F53\u524D\u8282\u70B9=>",k.data);const y=fe(p.apiType),M=new Vt(y);let A,D=k.data.value||"";D===""&&n.customPath!==""?A="":(D===""&&(D=""),A=D);const $=await M.getGithubPageTreeNode(A);E($)},onSelectChange:k=>{if(l.debug("onSelectChange=>",k),k.isLeaf){Y.error("\u60A8\u5F53\u524D\u9009\u62E9\u7684\u662F\u9875\u9762\uFF0C\u8BF7\u6CE8\u610F\uFF0C\u9875\u9762\u5FC5\u987B\u53D1\u5E03\u5728\u76EE\u5F55\u4E0B");return}r.initGithubPages({cpath:k.value,defpath:n.currentDefaultPath,fname:n.mdTitle})},getGithubPagesData:()=>n,getDocPath:()=>{const k=Va(p.apiType).posidKey;return i.getSiyuanPageData().dataObj.meta[k]||""},getMdFilename:()=>{var $,U,V;const k=fe(p.apiType),E=b.getSlugData(),y=i.getSiyuanPageData().dataObj,M=k.mdFilenameRule;let A;const D="[dynamic-generated-on-publish]";if(He(M))A=(U=($=y.page.content)!=null?$:E.customSlug)!=null?U:D;else{A=M,M.indexOf("filename")>-1&&(A=A.replace(/\[filename]/g,y.page.content)),M.indexOf("slug")>-1&&(A=A.replace(/\[slug]/g,(V=E.customSlug)!=null?V:D));let _=new Date;if(M.indexOf("yyyy")>-1){const B=_.getFullYear();A=A.replace(/\[yyyy]/g,B.toString())}if(M.indexOf("MM")>-1||M.indexOf("mm")>-1){let B,h=_.getMonth()+1;B=h.toString(),h<10&&(B=ke("0",B)),A=A.replace(/\[MM]/g,B),A=A.replace(/\[mm]/g,B)}if(M.indexOf("dd")>-1){let B,h=_.getDate();B=h.toString(),h<10&&(B=ke("0",B)),A=A.replace(/\[dd]/g,B)}}return A},initGithubPages:k=>{let E,y,M;k&&(E=k.cpath,y=k.defpath,M=k.fname),l.debug("paths=>",k),n.customPath=E,n.currentDefaultPath=y,n.mdTitle=M.indexOf(".md")>-1?M:M+".md",n.customPath.indexOf(".md")>-1?n.publishPath=n.customPath:n.publishPath=ze(n.customPath,"/"+n.mdTitle)}};return{githubPagesData:n,githubPagesMethods:r}},po=(p,e,l)=>{const n=_e.getLogger("composables/publish/initPublishCom.ts"),{t:i}=De(),b=ce({isInitLoading:!1,apiStatus:!1,apiTypeInfo:v(ke(i("setting.blog.platform.support.github"),p.apiType)),isPublished:!1,previewMdUrl:"",previewUrl:"",mdStatusUrl:""}),r=e.pageModeMethods,k=e.siyuanPageMethods,E=e.slugMethods,y=e.descMethods,M=e.publishTimeMethods,A=e.tagMethods,D=e.githubPagesMethods,$=e.yamlMethods,U={onEditModeChange:V=>{const _=r.getPageModeData();V===pe.EditMode_source?(U.convertAttrToYAML(!0),_.etype=V):$.getYamlData().isSaved?_.etype=V:Xe.confirm(i("main.yaml.no.save"),i("main.opt.warning"),{confirmButtonText:i("main.opt.ok"),cancelButtonText:i("main.opt.cancel"),type:"warning"}).then(async()=>{U.convertYAMLToAttr(!0),_.etype=V}).catch(()=>{_.etype=V})},onYamlShowTypeChange:V=>{const _=r.getPageModeData();switch(_.stype=V,V){case Me.YAML:$.initYaml($.getYamlData().formatter);break;case Me.CONTENT:$.initYaml($.getYamlData().mdContent);break;case Me.YAML_CONTENT:$.initYaml($.getYamlData().mdFullContent);break;case Me.HTML_CONTENT:$.initYaml($.getYamlData().htmlContent);break}},convertDocPathToCategories:V=>{const _=Ue();n.debug("docPath=>",V);const B=V.split("/");let h=[];if(B.length>1)for(let d=1;d<B.length-1;d++){let m;_.fixTitle?m=ra(B[d]):m=B[d],h.push(m)}return h},composableDataToForm:()=>{const V=Ue(),_=new Ia;_.formData.title=E.getSlugData().title,_.formData.customSlug=E.getSlugData().customSlug,_.formData.desc=y.getDescData().desc,_.formData.created=M.getPublishTime().created,_.formData.tag.dynamicTags=A.getTagData();const B=D.getGithubPagesData().customPath;_.formData.categories=U.convertDocPathToCategories(B);let h=k.getSiyuanPageData().dataObj.content.content,d=_t(h);return h=jt(h),V.removeH1&&(h=Wt(h),d=vt(d)),_.formData.mdContent=h,_.formData.htmlContent=d,_},convertAttrToYAML:V=>{const _=Ue(),B=fe(p.apiType),h=U.composableDataToForm();$.doConvertAttrToYAML(p.yamlConverter,h,B),U.onYamlShowTypeChange(_.contentShowType),V!==!0&&Y.success(i("main.opt.success"))},formToComposableData:V=>{E.syncSlug(V),y.syncDesc(V),M.syncPublishTime(V),A.syncTag(V)},convertYAMLToAttr:V=>{if(r.getPageModeData().stype!==Me.YAML){const _="\u53EA\u80FD\u8F6C\u6362YAML\uFF0C\u8BF7\u5207\u6362\u663E\u793A\u6A21\u5F0F";throw Y.error(_),$.getYamlData().isSaved=!0,new Error(_)}try{const _=fe(p.apiType),B=$.getYamlData().yamlContent,h=$a(B),d=new Aa;d.yamlObj=h,n.debug("\u51C6\u5907\u5C06YAML\u8F6C\u6362\u4E3A\u6587\u7AE0\u5C5E\u6027\uFF0CyamlFormatObj=>",d);const m=$.doConvertYAMLToAttr(p.yamlConverter,d,_);U.formToComposableData(m),$.getYamlData().isSaved=!0,V!==!0&&Y.success(i("main.opt.success"))}catch(_){V!==!0&&Y.error(ke(i("main.opt.failure"),"=>",_))}},getInitPublishData:()=>b,initPage:async V=>{var _,B,h,d,m;b.isInitLoading=V!=!0;try{const o=Ue(),C=r.getPageModeData();C.etype=o.editMode,C.stype=o.contentShowType;const c=fe(p.apiType);b.apiStatus=c.apiStatus;const f=await rt(!0,p.pageId);if(!f||f===""){b.isInitLoading=!1,n.error(i("page.no.id")),Y.error(i("page.no.id"));return}await k.initSiyuanPage(f);const P=k.getSiyuanPageData().dataObj;b.isPublished=qt(p.apiType,k.getSiyuanPageData().dataObj.meta),E.initSlug(P),y.initDesc(P),M.initPublishTime(P),A.initTag(P);const J=D.getGithubPagesData();J.githubEnabled=b.apiStatus;let F;b.isPublished?(J.useDefaultPath=!1,F=D.getDocPath()):F=(_=c.defaultPath)!=null?_:"";const T=(B=c.defaultPath)!=null?B:"\u5C1A\u672A\u914D\u7F6E",I=D.getMdFilename();if(D.initGithubPages({cpath:F,defpath:T,fname:I}),U.convertAttrToYAML(!0),b.isPublished){const K=(h=c.baseUrl)!=null?h:"https://terwer.space/",H=(d=c.home)!=null?d:"https://terwer.space/";let q;q=ze(c.githubUser,"/"+c.githubRepo),q=ze(q,"/blob/"),q=ze(q,"/"+c.defaultBranch),q=ze(q,"/"+F),He(c.previewMdUrl)||(q=c.previewMdUrl,q=q.replace(/\[user]/,c.githubUser),q=q.replace(/\[repo]/,c.githubRepo),q=q.replace(/\[branch]/,c.defaultBranch),q=q.replace(/\[docpath]/,F)),q=ze(K,q),b.previewMdUrl=q,b.mdStatusUrl=ke("https://img.shields.io/github/checks-status/",c.githubUser,"/",c.githubRepo,"/",c.defaultBranch,"?label=build");let Z=$.getYamlData().yamlObj.permalink;if(!He(c.previewUrl))if(c.previewUrl.indexOf("[docpath]")>-1){const Q=(m=c.defaultPath)!=null?m:"docs",re=F.replace(Q,"").replace(".md","");Z=c.previewUrl.replace("/[docpath]",re)}else{Z=c.previewUrl.replace(/\[postid]/g,E.getSlugData().customSlug);const X=M.getPublishTime().created.split(" ")[0].split("-");n.debug("created numarr=>",X);const Fe=X[0],Le=X[1],j=X[2];Z=Z.replace(/\[yyyy]/g,Fe),Z=Z.replace(/\[MM]/g,Le),Z=Z.replace(/\[mm]/g,Le),Z=Z.replace(/\[dd]/g,j);const et=D.getGithubPagesData().publishPath,O=U.convertDocPathToCategories(et);O.length>0?Z=Z.replace(/\[cats]/,O.join("/")):Z=Z.replace(/\/\[cats]/,"")}b.previewUrl=ze(H,Z)}}catch(o){const C=ke(i("main.opt.failure"),"=>",o);n.error(C)}b.isInitLoading=!1}};return{initPublishData:b,initPublishMethods:U}},co=()=>{const p=ce({etype:pe.EditMode_simple,stype:Me.YAML_CONTENT});return{pageModeData:p,pageModeMethods:{getPageModeData:()=>p}}},mo={class:"github-tips"},go={class:"github-form"},fo={key:0,class:"form-post-title"},yo={class:"form-edit-mode"},bo={key:1,class:"normal-mode"},ho={key:0,class:"form-slug"},_o={class:"form-desc"},vo={class:"form-publish-time"},Co={class:"form-tags"},wo={class:"form-github-pages"},Eo={key:0,class:"form-github-pages-items"},To={key:2,class:"convert-option"},So={key:3,class:"publish-action"},ko={key:4,class:"publish-status"},Do=["href","title"],Po=["src"],Mo=["href","title"],Vo={key:5,class:"source-mode"},$o={class:"source-opt"},Ao={key:1,id:"yaml-detail-content"},Io={key:2,id:"yaml-edit-content"},Fo={key:3,id:"yaml-action"},Bo={id:"yaml-read-mode-tip"},Uo=ae({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0},yamlConverter:{type:Mt}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/main/GithubMain.vue"),{pageModeData:n,pageModeMethods:i}=co(),{siyuanPageMethods:b}=ma(e),{slugData:r,slugMethods:k}=to(e,{siyuanPageMethods:b}),{descData:E,descMethods:y}=so(e,{siyuanPageMethods:b}),{publishTimeData:M,publishTimeMethods:A}=no(),{tagData:D,tagMethods:$}=io(e),{githubPagesData:U,githubPagesMethods:V}=ro(e,{siyuanPageMethods:b,slugMethods:k}),{yamlData:_,yamlMethods:B}=ao(),{quickData:h,quickMethods:d}=oo(e,{siyuanPageMethods:b,slugMethods:k,descMethods:y,tagMethods:$}),{initPublishData:m,initPublishMethods:o}=po(e,{pageModeMethods:i,siyuanPageMethods:b,slugMethods:k,descMethods:y,publishTimeMethods:A,tagMethods:$,githubPagesMethods:V,yamlMethods:B}),{publishData:C,publishMethods:c}=lo(e,{siyuanPageMethods:b,yamlMethods:B,githubPagesMethods:V,quickMethods:d,initPublishMethods:o});return Re(()=>e.isReload,async()=>{await o.initPage(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await o.initPage(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),Ke(async()=>{await o.initPage()}),(f,P)=>{const J=Ye,F=Je,T=je,I=qe,K=ut,H=it,q=It,Z=Ft,Q=oa,re=We,X=bt,Fe=ht,Le=Bt;return u(),te("div",null,[s(m).isInitLoading?w("",!0):(u(),g(Fe,{key:0},{default:a(()=>[t(X,{class:"github-main"},{default:a(()=>[be("div",mo,[s(n).etype!==s(pe).EditMode_source?(u(),g(J,{key:0,closable:!1,title:s(m).apiTypeInfo,class:"top-version-tip",type:"info"},null,8,["title"])):w("",!0),!s(m).apiStatus&&s(n).etype!==s(pe).EditMode_source?(u(),g(J,{key:1,closable:!1,title:f.$t("main.publish.github.error.tip"),class:"top-version-tip",type:"error"},null,8,["title"])):w("",!0)]),be("div",go,[t(re,{"label-width":"100px"},{default:a(()=>[s(n).etype!==s(pe).EditMode_source?(u(),te("div",fo,[t(T,{label:f.$t("main.title")},{default:a(()=>[t(F,{modelValue:s(r).title,"onUpdate:modelValue":P[0]||(P[0]=j=>s(r).title=j),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])])):w("",!0),be("div",yo,[t(T,{label:f.$t("main.publish.editmode")},{default:a(()=>[t(K,null,{default:a(()=>[t(I,{type:s(n).etype===s(pe).EditMode_simple?"primary":"default",onClick:P[1]||(P[1]=j=>s(o).onEditModeChange(s(pe).EditMode_simple))},{default:a(()=>[N(L(f.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(I,{type:s(n).etype===s(pe).EditMode_complex?"primary":"default",onClick:P[2]||(P[2]=j=>s(o).onEditModeChange(s(pe).EditMode_complex))},{default:a(()=>[N(L(f.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"]),t(I,{type:s(n).etype===s(pe).EditMode_source?"primary":"default",onClick:P[3]||(P[3]=j=>s(o).onEditModeChange(s(pe).EditMode_source))},{default:a(()=>[N(L(f.$t("main.publish.editmode.source")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"])]),s(n).etype!==s(pe).EditMode_source?(u(),te("div",bo,[s(n).etype!==s(pe).EditMode_simple?(u(),te("div",ho,[t(T,{label:f.$t("main.force.refresh")},{default:a(()=>[t(H,{modelValue:s(r).forceRefresh,"onUpdate:modelValue":P[4]||(P[4]=j=>s(r).forceRefresh=j)},null,8,["modelValue"])]),_:1},8,["label"]),t(T,{label:f.$t("main.use.hash")},{default:a(()=>[t(H,{modelValue:s(r).slugHashEnabled,"onUpdate:modelValue":P[5]||(P[5]=j=>s(r).slugHashEnabled=j)},null,8,["modelValue"]),s(r).slugHashEnabled?w("",!0):(u(),g(J,{key:0,closable:!1,title:f.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),t(T,{label:f.$t("main.slug")},{default:a(()=>[t(F,{modelValue:s(r).customSlug,"onUpdate:modelValue":P[6]||(P[6]=j=>s(r).customSlug=j)},null,8,["modelValue"])]),_:1},8,["label"]),t(T,null,{default:a(()=>[t(I,{loading:s(r).isSlugLoading,class:"make-slug-btn",type:"primary",onClick:s(k).makeSlug},{default:a(()=>[N(L(s(r).isSlugLoading?f.$t("main.opt.loading"):f.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading","onClick"])]),_:1})])):w("",!0),be("div",_o,[s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:0,label:f.$t("main.desc")},{default:a(()=>[t(F,{modelValue:s(E).desc,"onUpdate:modelValue":P[7]||(P[7]=j=>s(E).desc=j),autosize:{minRows:3,maxRows:16},type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:1},{default:a(()=>[t(I,{loading:s(E).isDescLoading,type:"primary",onClick:s(y).makeDesc},{default:a(()=>[N(L(s(E).isDescLoading?f.$t("main.opt.loading"):f.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading","onClick"])]),_:1})):w("",!0)]),be("div",vo,[s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:0,label:f.$t("main.create.time")},{default:a(()=>[t(q,{modelValue:s(M).created,"onUpdate:modelValue":P[8]||(P[8]=j=>s(M).created=j),placeholder:f.$t("main.create.time.placeholder"),format:"YYYY-MM-DD HH:mm:ss",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0)]),be("div",Co,[t(T,{label:f.$t("main.tag.auto.switch")},{default:a(()=>[t(H,{modelValue:s(D).tagSwitch,"onUpdate:modelValue":P[9]||(P[9]=j=>s(D).tagSwitch=j)},null,8,["modelValue"])]),_:1},8,["label"]),t(T,{label:f.$t("main.tag")},{default:a(()=>[(u(!0),te(Ae,null,$e(s(D).tag.dynamicTags,j=>(u(),g(Z,{key:j,"disable-transitions":!1,class:"mx-1",closable:"",onClose:et=>s($).tagHandleClose(j)},{default:a(()=>[N(L(j),1)]),_:2},1032,["onClose"]))),128)),s(D).tag.inputVisible?(u(),g(F,{key:0,ref:"tagRefInput",modelValue:s(D).tag.inputValue,"onUpdate:modelValue":P[10]||(P[10]=j=>s(D).tag.inputValue=j),class:"ml-1 w-20",size:"small",onBlur:s($).tagHandleInputConfirm,onKeyup:Jt(s($).tagHandleInputConfirm,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(u(),g(I,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:s($).tagShowInput},{default:a(()=>[N(L(f.$t("main.tag.new")),1)]),_:1},8,["onClick"]))]),_:1},8,["label"]),s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:0},{default:a(()=>[t(I,{loading:s(D).isTagLoading,type:"primary",onClick:s($).fetchTag},{default:a(()=>[N(L(s(D).isTagLoading?f.$t("main.opt.loading"):f.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading","onClick"])]),_:1})):w("",!0)]),be("div",wo,[t(T,{label:f.$t("main.publish.github")},{default:a(()=>[t(H,{modelValue:s(U).githubEnabled,"onUpdate:modelValue":P[11]||(P[11]=j=>s(U).githubEnabled=j),onChange:s(V).githubOnChange},null,8,["modelValue","onChange"]),s(U).githubEnabled?w("",!0):(u(),g(J,{key:0,closable:!1,title:f.$t("main.publish.github.no.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),s(U).githubEnabled?(u(),te("div",Eo,[s(m).isPublished?w("",!0):(u(),g(T,{key:0,label:f.$t("main.publish.github.choose.path.use.default")},{default:a(()=>[t(H,{modelValue:s(U).useDefaultPath,"onUpdate:modelValue":P[12]||(P[12]=j=>s(U).useDefaultPath=j),onChange:s(V).defaultPathOnChange},null,8,["modelValue","onChange"]),s(U).useDefaultPath?(u(),g(J,{key:0,closable:!1,title:f.$t("main.publish.github.choose.path.use.default.tip")+s(U).currentDefaultPath,type:"info"},null,8,["title"])):w("",!0)]),_:1},8,["label"])),!s(U).useDefaultPath&&!s(m).isPublished?(u(),g(T,{key:1,label:f.$t("main.publish.github.choose.path")},{default:a(()=>[t(Q,{modelValue:s(U).customPath,"onUpdate:modelValue":P[13]||(P[13]=j=>s(U).customPath=j),"check-strictly":!0,"empty-text":f.$t("main.cat.empty"),load:s(V).customLoad,"no-data-text":f.$t("main.cat.empty"),placeholder:f.$t("main.cat.select"),props:s(U).path.customProps,lazy:"",style:{width:"100%"},onNodeClick:s(V).onSelectChange},null,8,["modelValue","empty-text","load","no-data-text","placeholder","props","onNodeClick"])]),_:1},8,["label"])):w("",!0),s(m).isPublished?w("",!0):(u(),g(T,{key:2,label:f.$t("main.publish.github.choose.title")},{default:a(()=>[t(F,{modelValue:s(U).mdTitle,"onUpdate:modelValue":P[14]||(P[14]=j=>s(U).mdTitle=j)},null,8,["modelValue"])]),_:1},8,["label"])),t(T,{label:f.$t("main.publish.github.published.path")},{default:a(()=>[t(F,{modelValue:s(U).publishPath,"onUpdate:modelValue":P[15]||(P[15]=j=>s(U).publishPath=j),disabled:s(m).isPublished},null,8,["modelValue","disabled"])]),_:1},8,["label"])])):w("",!0)])])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),te("div",To,[t(T,{label:f.$t("main.opt.quick")},{default:a(()=>[t(I,{loading:s(h).isGenLoading,type:"primary",onClick:s(d).oneclickAttr},{default:a(()=>[N(L(s(h).isGenLoading?f.$t("main.opt.loading"):f.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["label"]),s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:0},{default:a(()=>[t(I,{type:"primary",onClick:s(d).saveAttrToSiyuan},{default:a(()=>[N(L(f.$t("main.save.attr.to.siyuan")),1)]),_:1},8,["onClick"])]),_:1})):w("",!0),s(n).etype!==s(pe).EditMode_simple?(u(),g(T,{key:1},{default:a(()=>[t(I,{type:"primary",onClick:P[16]||(P[16]=j=>s(o).onEditModeChange(s(pe).EditMode_source))},{default:a(()=>[N(L(f.$t("main.siyuan.to.yaml")),1)]),_:1})]),_:1})):w("",!0)])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),te("div",So,[t(T,null,{default:a(()=>[t(I,{loading:s(C).isPublishLoading,type:"primary",onClick:s(c).doPublish},{default:a(()=>[N(L(s(C).isPublishLoading?f.$t("main.publish.loading"):s(m).isPublished?f.$t("main.update"):f.$t("main.publish")),1)]),_:1},8,["loading","onClick"]),s(m).isPublished?(u(),g(I,{key:0,loading:s(C).isCancelLoading,onClick:s(c).cancelPublish},{default:a(()=>[N(L(f.$t("main.cancel")),1)]),_:1},8,["loading","onClick"])):w("",!0)]),_:1})])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),te("div",ko,[t(T,{class:"publish-status-box"},{default:a(()=>[t(I,{class:"publish-text-btn",disabled:"",text:"",type:"danger"},{default:a(()=>[N(L(s(m).isPublished?f.$t("main.publish.status.published"):f.$t("main.publish.status.unpublish")),1)]),_:1}),s(m).isPublished?(u(),te("a",{key:0,href:s(m).previewMdUrl,title:s(m).previewMdUrl,target:"_blank"},L(f.$t("main.publish.see.md.preview")),9,Do)):w("",!0)]),_:1}),s(m).isPublished?(u(),g(T,{key:0,class:"publish-status-box"},{default:a(()=>[be("img",{src:s(m).mdStatusUrl,alt:"md-build-status",class:"publish-build-status-icon"},null,8,Po),be("a",{href:s(m).previewUrl,title:s(m).previewUrl,target:"_blank"},L(f.$t("main.publish.see.real.preview")),9,Mo)]),_:1})):w("",!0)])):w("",!0),s(n).etype===s(pe).EditMode_source?(u(),te("div",Vo,[t(T,null,{default:a(()=>[t(J,{closable:!1,title:s(Fa)(e.apiType)+" "+f.$t("main.yaml.formatter"),class:"top-yaml-tip",type:"info"},null,8,["title"])]),_:1}),s(n).etype.toString()!==s(pe).EditMode_simple.toString()?(u(),g(T,{key:0,label:s(_).readMode?f.$t("main.read.mode"):f.$t("main.edit.mode")},{default:a(()=>[t(H,{modelValue:s(_).readMode,"onUpdate:modelValue":P[17]||(P[17]=j=>s(_).readMode=j)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),be("div",$o,[t(T,null,{default:a(()=>[be("a",{class:yt({current:s(n).stype===s(Me).YAML}),onClick:P[18]||(P[18]=j=>s(o).onYamlShowTypeChange(s(Me).YAML))},L(f.$t("yaml.show.type.yaml")),3),be("a",{class:yt({current:s(n).stype===s(Me).CONTENT,middle:!0}),onClick:P[19]||(P[19]=j=>s(o).onYamlShowTypeChange(s(Me).CONTENT))},L(f.$t("yaml.show.type.md")),3),be("a",{class:yt({current:s(n).stype===s(Me).YAML_CONTENT,middle:!0}),onClick:P[20]||(P[20]=j=>s(o).onYamlShowTypeChange(s(Me).YAML_CONTENT))},L(f.$t("yaml.show.type.yamlmd")),3),be("a",{class:yt({current:s(n).stype===s(Me).HTML_CONTENT}),onClick:P[21]||(P[21]=j=>s(o).onYamlShowTypeChange(s(Me).HTML_CONTENT))},L(f.$t("yaml.show.type.html")),3)]),_:1})]),s(_).readMode?(u(),te("div",Ao,[t(T,null,{default:a(()=>[t(F,{id:"yaml-detail-preview",modelValue:s(_).yamlPreviewContent,"onUpdate:modelValue":P[22]||(P[22]=j=>s(_).yamlPreviewContent=j),autosize:{minRows:4,maxRows:16},readonly:"",type:"textarea",onClick:s(B).onYamlContentFocus,onContextmenu:s(B).onYamlContextMenu},null,8,["modelValue","onClick","onContextmenu"])]),_:1})])):w("",!0),s(_).readMode?w("",!0):(u(),te("div",Io,[t(T,null,{default:a(()=>[t(F,{modelValue:s(_).yamlContent,"onUpdate:modelValue":P[23]||(P[23]=j=>s(_).yamlContent=j),autosize:{minRows:4,maxRows:16},type:"textarea",onInput:s(B).onYamlContentInput},null,8,["modelValue","onInput"])]),_:1})])),s(_).readMode?w("",!0):(u(),te("div",Fo,[t(T,null,{default:a(()=>[t(I,{type:"primary",onClick:s(o).convertYAMLToAttr},{default:a(()=>[N(L(f.$t("main.yaml.to.siyuan")),1)]),_:1},8,["onClick"]),t(I,{type:"primary",onClick:P[24]||(P[24]=j=>s(B).copyYamlToClipboard())},{default:a(()=>[N(L(f.$t("main.copy")),1)]),_:1})]),_:1})])),be("div",Bo,[t(T,null,{default:a(()=>[t(J,{closable:!1,title:f.$t("main.read.mode.tip"),type:"info"},null,8,["title"])]),_:1})])])):w("",!0)]),_:1})])]),_:1})]),_:1})),t(Le,{loading:s(m).isInitLoading,rows:5,animated:""},null,8,["loading"])])}}});const ft=Ze(Uo,[["__scopeId","data-v-39956fcc"]]),Yo=ae({__name:"VuepressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_VUEPRESS),n=new Ba,i=v(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":l.value,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Ko=ae({__name:"HugoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_HUGO),n=new Ua,i=v(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":l.value,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Oo=ae({__name:"HexoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_HEXO),n=new Ya,i=v(n);return(b,r)=>(u(),g(ft,{"api-type":l.value,"is-reload":e.isReload,"is-main-reload":e.isMainReload,"page-id":e.pageId,"yaml-converter":i.value},null,8,["api-type","is-reload","is-main-reload","page-id","yaml-converter"]))}}),Ro=ae({__name:"JekyllMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_JEKYLL),n=new Ka,i=v(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"api-type":l.value,"is-main-reload":e.isMainReload,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","api-type","is-main-reload","page-id","yaml-converter"]))}}),Lo={class:"form-post-title"},No=["href","title"],Ho=ae({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/main/MetaweblogMain.vue"),n=new Oe,{t:i}=De(),b=v(""),r=v(i("setting.blog.platform.support.metaweblog")+e.apiType+" "),k=v(!1),E=v(!1),y=v(!1),M=v(!1),A=v(!1),D=v(!1),$=v(!1),U=v(!1),V=v(!1),_=v(!1),B=v(!1),h=v(!1),d=v(""),m=v(!1),o=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),C=ce({pageId:"",meta:{tags:""}}),c=()=>{V.value=!1},f=()=>{V.value=!0},P=async()=>{U.value=!0;const O=await rt(!0,e.pageId);if(!O||O==="")return;const z=fe(e.apiType);pt(z)||(b.value=z.blogName);const se=Ue();B.value=!0,C.pageId=O,C.meta=await n.getBlockAttrs(O);const S=await n.getBlockByID(O);if(!S)throw U.value=!1,Y.error(i("config.error.msg")+"_"+e.apiType),new Error(i("config.error.msg")+"_"+e.apiType);l.debug("MetaweblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",C.meta);let R=S.content;se.fixTitle&&(R=Ot(S.content)),o.title=R,o.customSlug=C.meta[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],o.desc=C.meta[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],o.created=Nt(S.created),o.tag.dynamicTags=[];const W=(C.meta.tags||"").split(",");for(let me=0;me<W.length;me++)W[me]!==""&&o.tag.dynamicTags.push(W[me]);se.autoTag&&o.tag.dynamicTags.length===0&&(m.value=!0),h.value=qt(e.apiType,C.meta);const x=fe(e.apiType),ee=new Ge(e.apiType);let Ce=[];if(h.value){const me=C.meta;o.postid=me[x.posidKey],d.value=await ee.getPreviewUrl(o.postid.toString());try{const de=await ee.getPost(o.postid.toString());Ce=de.categories,l.debug("postid=>",o.postid),l.debug("post=>",de),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",Ce)}catch(de){Y.error(i("post.delete.by.platform")),U.value=!1,l.error("\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",de)}}let ve=[];try{ve=await ee.getCategories()}catch(me){U.value=!1,l.error(i("main.cat.list.error"),me)}const ge=[];ve&&ve.length&&ve.length>0&&(ve.forEach(me=>{const de={value:me.description,label:me.description};ge.push(de)}),o.cat.categoryList=ge),o.cat.categorySelected=Ce,o.categories=Ce,k.value=z.apiStatus,U.value=!1};Ke(async()=>{await P()});function J(){return He(o.customSlug)||_.value?!0:(l.debug(i("main.force.refresh.tip")),!1)}const F=async O=>{if(!J())return;E.value=!0;const z=await n.getBlockByID(C.pageId);l.debug("page=>",z);let se=z.content;if(se.indexOf(".")>-1&&(se=se.replace(/\d*\./g,"")),l.debug("fmtTitle=>",se),o.checkList.length>0){const S=await Kt(se);l.debug("result=>",S),S?o.customSlug=S:Y.success(i("main.opt.failure"))}else o.customSlug=tt(se);if(B.value){const S=z.content+new Date().toISOString(),R="-"+zt(S).toLowerCase();o.customSlug+=R}E.value=!1,O!==!0&&Y.success(i("main.opt.success"))},T=async O=>{y.value=!0;const se=(await n.exportMdContent(C.pageId)).content,S=da(se);o.desc=Rt(S,Lt.MAX_PREVIEW_LENGTH,!0),y.value=!1,O!==!0&&Y.success(i("main.opt.success"))},I=O=>{o.tag.dynamicTags.splice(o.tag.dynamicTags.indexOf(O),1)},K=v(),H=()=>{o.tag.inputVisible=!0,ca(()=>{K.value.focus()})},q=()=>{o.tag.inputValue&&o.tag.dynamicTags.push(o.tag.inputValue),o.tag.inputVisible=!1,o.tag.inputValue=""};async function Z(O){if(!m.value){Y.warning(i("main.tag.auto.switch.no.tip"));return}M.value=!0;const se=(await n.exportMdContent(C.pageId)).content,S=await Ht(se);l.debug("genTags=>",S);const R=Gt(S,5);l.debug("hotTags=>",R);for(let G=0;G<R.length;G++)o.tag.dynamicTags.includes(R[G])||o.tag.dynamicTags.push(R[G]);M.value=!1,O!==!0&&Y.success(i("main.opt.success"))}const Q=async O=>{const z={[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:o.customSlug,[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:o.desc,tags:o.tag.dynamicTags.join(",")};await n.setBlockAttrs(C.pageId,z),l.debug("MetaweblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",z),O!==!0&&(await P(),Y.success(i("main.opt.success")))},re=(O,z,se,S)=>{},X=(O,z)=>{console.log("data=>",O),console.log("status=>",z);const se=[];z.checkedKeys.forEach(R=>{se.push(R.toString())}),o.categories=se,l.debug(" formData.categories=>",o.categories)},Fe=async O=>{A.value=!0,await F(!0),await T(!0),await Z(!0),await Q(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),A.value=!1,O!==!0&&Y.success(i("main.publish.oneclick.attr.finish"))},Le=async()=>{if(!k.value){Y.error(i("setting.blog.vali.tip.metaweblog"));return}D.value=!0;try{await Fe(!0);const O=fe(e.apiType),z=new Ge(e.apiType),se=Ue();let S;const G=(await n.exportMdContent(C.pageId)).content;if(Pe.Html===O.pageType){const Ce=_t(G);S=pa(Ce),se.removeH1&&(S=vt(S))}else S=jt(G),se.removeH1&&(S=Wt(S));const W=new Yt;W.title=o.title,W.wp_slug=o.customSlug,W.description=S,W.categories=o.categories,W.mt_keywords=o.tag.dynamicTags.join(","),e.apiType===ye.API_TYPE_CNBLOGS&&W.categories.push("[Markdown]"),W.dateCreated=new Date;const x=!0;let ee;if(h.value){if(ee=o.postid,!await z.editPost(ee,W,!0))throw Y.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+ee);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",ee)}else{ee=await z.newPost(W,x),l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",O.posidKey);const Ce={[O.posidKey]:ee};await n.setBlockAttrs(C.pageId,Ce),l.debug("MetaweblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",Ce),l.info("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",ee)}await P(),Y.success(i("main.opt.success"))}catch(O){throw l.error("\u53D1\u5E03\u5F02\u5E38"),Y.error(i("main.opt.failure")),O}D.value=!1},j=async()=>{$.value=!0,Xe.confirm(i("main.opt.warning.tip"),i("main.opt.warning"),{confirmButtonText:i("main.opt.ok"),cancelButtonText:i("main.opt.cancel"),type:"warning"}).then(async()=>{await et(!0),$.value=!1,Y.warning(i("main.opt.status.cancel"))}).catch(O=>{throw Y({type:"error",message:i("main.opt.failure")}),$.value=!1,new Error(O)})},et=async O=>{const z=fe(e.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",o.postid);const se={[z.posidKey]:""};await n.setBlockAttrs(C.pageId,se),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",se);try{await new Ge(e.apiType).deletePost(o.postid)||Y.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(S){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",S)}O&&await P()};return Re(()=>e.isReload,async()=>{await P(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await P(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(O,z)=>{const se=Ye,S=Je,R=je,G=qe,W=ut,x=it,ee=sa,Ce=na,ve=It,ge=Ft,me=oa,de=We,ne=bt,we=Bt,Ne=ht;return u(),g(Ne,null,{default:a(()=>[U.value?w("",!0):(u(),g(ne,{key:0,class:"blog-main"},{default:a(()=>[t(se,{class:"top-version-tip",title:r.value+b.value,type:"info",closable:!1},null,8,["title"]),k.value?w("",!0):(u(),g(se,{key:0,class:"top-version-tip",title:O.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),p.useAdaptor?(u(),g(se,{key:1,class:"top-version-tip",title:O.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):w("",!0),t(de,{"label-width":"120px"},{default:a(()=>[be("div",Lo,[t(R,{label:O.$t("main.title")},{default:a(()=>[t(S,{modelValue:o.title,"onUpdate:modelValue":z[0]||(z[0]=ue=>o.title=ue),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(R,{label:O.$t("main.publish.editmode")},{default:a(()=>[t(W,null,{default:a(()=>[t(G,{type:V.value?"default":"primary",onClick:c},{default:a(()=>[N(L(O.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(G,{type:V.value?"primary":"default",onClick:f},{default:a(()=>[N(L(O.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),V.value?(u(),g(R,{key:0,label:O.$t("main.force.refresh")},{default:a(()=>[t(x,{modelValue:_.value,"onUpdate:modelValue":z[1]||(z[1]=ue=>_.value=ue)},null,8,["modelValue"]),_.value?w("",!0):(u(),g(se,{key:0,title:O.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),V.value?(u(),g(R,{key:1,label:O.$t("main.slug")},{default:a(()=>[t(S,{modelValue:o.customSlug,"onUpdate:modelValue":z[2]||(z[2]=ue=>o.customSlug=ue)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),V.value?(u(),g(R,{key:2},{default:a(()=>[t(Ce,{modelValue:o.checkList,"onUpdate:modelValue":z[3]||(z[3]=ue=>o.checkList=ue)},{default:a(()=>[t(ee,{label:"1"},{default:a(()=>[N(L(O.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),V.value?(u(),g(R,{key:3},{default:a(()=>[t(G,{type:"primary",class:"make-slug-btn",onClick:F,loading:E.value},{default:a(()=>[N(L(E.value?O.$t("main.opt.loading"):O.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),V.value?(u(),g(R,{key:4,label:O.$t("main.use.hash")},{default:a(()=>[t(x,{modelValue:B.value,"onUpdate:modelValue":z[4]||(z[4]=ue=>B.value=ue)},null,8,["modelValue"]),B.value?w("",!0):(u(),g(se,{key:0,title:O.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),V.value?(u(),g(R,{key:5,label:O.$t("main.desc")},{default:a(()=>[t(S,{type:"textarea",modelValue:o.desc,"onUpdate:modelValue":z[5]||(z[5]=ue=>o.desc=ue)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),V.value?(u(),g(R,{key:6},{default:a(()=>[t(G,{type:"primary",onClick:T,loading:y.value},{default:a(()=>[N(L(y.value?O.$t("main.opt.loading"):O.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),V.value?(u(),g(R,{key:7,label:O.$t("main.create.time")},{default:a(()=>[t(ve,{type:"datetime",modelValue:o.created,"onUpdate:modelValue":z[6]||(z[6]=ue=>o.created=ue),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:O.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),t(R,{label:O.$t("main.tag")},{default:a(()=>[(u(!0),te(Ae,null,$e(o.tag.dynamicTags,ue=>(u(),g(ge,{key:ue,class:"mx-1",closable:"","disable-transitions":!1,onClose:Zt=>I(ue)},{default:a(()=>[N(L(ue),1)]),_:2},1032,["onClose"]))),128)),o.tag.inputVisible?(u(),g(S,{key:0,ref_key:"tagRefInput",ref:K,modelValue:o.tag.inputValue,"onUpdate:modelValue":z[7]||(z[7]=ue=>o.tag.inputValue=ue),class:"ml-1 w-20",size:"small",onKeyup:Jt(q,["enter"]),onBlur:q},null,8,["modelValue","onKeyup"])):(u(),g(G,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:H},{default:a(()=>[N(L(O.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),V.value?(u(),g(R,{key:8},{default:a(()=>[t(G,{type:"primary",onClick:Z,loading:M.value},{default:a(()=>[N(L(M.value?O.$t("main.opt.loading"):O.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),t(R,{label:O.$t("main.tag.auto.switch")},{default:a(()=>[t(x,{modelValue:m.value,"onUpdate:modelValue":z[8]||(z[8]=ue=>m.value=ue)},null,8,["modelValue"])]),_:1},8,["label"]),t(R,{label:O.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[t(me,{style:{width:"100%"},modelValue:o.cat.categorySelected,"onUpdate:modelValue":z[9]||(z[9]=ue=>o.cat.categorySelected=ue),data:o.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:O.$t("main.cat.select"),"empty-text":O.$t("main.cat.empty"),"no-data-text":O.$t("main.cat.empty"),onNodeClick:re,onCheck:X},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])]),_:1},8,["label"]),t(R,{label:O.$t("main.opt.quick")},{default:a(()=>[t(G,{type:"primary",onClick:Fe,loading:A.value},{default:a(()=>[N(L(A.value?O.$t("main.opt.loading"):O.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),V.value?(u(),g(G,{key:0,type:"primary",onClick:Q},{default:a(()=>[N(L(O.$t("main.save.attr.to.siyuan")),1)]),_:1})):w("",!0)]),_:1},8,["label"]),t(R,{label:""},{default:a(()=>[t(G,{type:"primary",onClick:Le,loading:D.value},{default:a(()=>[N(L(D.value?O.$t("main.publish.loading"):h.value?O.$t("main.update"):O.$t("main.publish")),1)]),_:1},8,["loading"]),h.value?(u(),g(G,{key:0,loading:$.value,onClick:j},{default:a(()=>[N(L(O.$t("main.cancel")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),t(R,null,{default:a(()=>[t(G,{type:"danger",text:"",disabled:""},{default:a(()=>[N(L(h.value?O.$t("main.publish.status.published"):O.$t("main.publish.status.unpublish")),1)]),_:1}),h.value?(u(),te("a",{key:0,href:d.value,title:d.value,target:"_blank"},L(O.$t("main.publish.see.preview")),9,No)):w("",!0)]),_:1})]),_:1})]),_:1})),t(we,{loading:U.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const ot=Ze(Ho,[["__scopeId","data-v-a0321823"]]),Go=ae({__name:"JVueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_JVUE);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),jo=ae({__name:"ConfluenceMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_CONFLUENCE);return(n,i)=>(u(),g(ot,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":l.value,"use-adaptor":!0,"page-id":e.pageId},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),Wo=ae({__name:"CnblogsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_CNBLOGS);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),qo=ae({__name:"WordpressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_WORDPRESS);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Jo=/.(gif|jpe?g|tiff?|png|webp|bmp|ico)$/i;async function zo(p){let e="";if(p.uri){const l=new URL(p.uri);e=(await(await Xa(l)).buffer()).toString("base64")}else if(p.path&&Jo.test(p.path))(await(void 0)(p.path)).isFile()&&(e=(await(void 0)(Qa(p.path))).toString("base64"));else throw new Error("Didn't get an image or a good uri for the appropriate param");return{base64:e}}class Qo{constructor(){ie(this,"logger",_e.getLogger("utils/parser/imageParser.ts"))}hasExternalImages(e){const n=/!\[.*]\((http|https):\/.*\/.*\)/g,i=e.match(n);if(i!=null&&i.length>0)return!0;const b=/!\[.*]\((data:image):\/.*\/.*\)/g,r=e.match(b);return r!=null&&r.length>0}removeImages(e){let l=e;return l=l.replace(/!\[.*]\((http|https):\/.*\/.*\)/g,""),l}async replaceImagesWithBase64(e){var b,r,k;let l=e;const n=/!\[.*]\((http|https):\/.*\/.*\)/g,i=l.match(n);if(i==null||i.length===0)return l;for(let E=0;E<i.length;E++){const y=i[E];this.logger.debug("img=>",y);const M=y.replace(/!\[]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",M);let A;if(Oa()){const D=await zo({uri:M});A=(b=D==null?void 0:D.base64)!=null?b:"no pic"}else{const $=Ra("VITE_MIDDLEWARE_URL","/api/middleware")+"/imageToBase64",U={fetchParams:{imgUrl:M}},V={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)};this.logger.debug("middleApiUrl=>",$),this.logger.debug("middleFetchOption=>",V);const B=await(await fetch($,V)).json();this.logger.debug("resJson=>",B),A=(k=(r=B==null?void 0:B.body)==null?void 0:r.base64str)!=null?k:"parse error"}A=ke('<img src="data:image/png;base64,',A,'"  alt="base64Image"/>'),l=l.replace(y,A)}return l}replaceImagesWithAscii(e){return e}replaceImagesWithColorAscii(e){return e}async uploadImageToBeds(e){return e}async downloadMdWithImages(){}async downloadImagesToSiyuan(){throw new Error("\u601D\u6E90\u7B14\u8BB0\u5DF2\u7ECF\u6709\u6B64\u529F\u80FD\uFF0C\u65E0\u9700\u91CD\u65B0\u5B9E\u73B0")}}const Xo={class:"form-post-title"},Zo=["href","title"],xo=ae({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/main/CommonBlogMain.vue"),n=new Oe,i=new Qo,{t:b}=De(),r=v(""),k=v(b("setting.blog.platform.support.common")+e.apiType+" "),E=v(!1),y=v(!1),M=v(!1),A=v(!1),D=v(!1),$=v(!1),U=v(!1),V=v(!1),_=v(!1),B=v(!1),h=v(!1),d=v(!1),m=v(""),o=v(!1),C=v(!1),c=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"],cat_slugs:[]}),f=ce({pageId:"",meta:{tags:""}}),P=()=>{_.value=!1},J=()=>{_.value=!0},F=async()=>{V.value=!0;const S=await rt(!0,e.pageId);if(!S||S==="")return;const R=fe(e.apiType);pt(R)||(r.value=R.blogName||"");const G=Ue();h.value=!0,f.pageId=S,f.meta=await n.getBlockAttrs(S);let W;try{W=await n.getBlockByID(S)}catch(ne){throw V.value=!1,l.error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25",ne),new Error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}if(!W)throw V.value=!1,Y.error(b("config.error.msg")+"_"+e.apiType),new Error(b("config.error.msg")+"_"+e.apiType);l.debug("CommonblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",f.meta);let x=W.content;G.fixTitle&&(x=Ot(W.content)),c.title=x,c.customSlug=f.meta[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],c.desc=f.meta[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],c.created=Nt(W.created),c.tag.dynamicTags=[];const Ce=(f.meta.tags||"").split(",");for(let ne=0;ne<Ce.length;ne++)Ce[ne]!==""&&c.tag.dynamicTags.push(Ce[ne]);G.autoTag&&c.tag.dynamicTags.length===0&&(o.value=!0),d.value=qt(e.apiType,f.meta),C.value=!d.value;const ve=fe(e.apiType),ge=new Ge(e.apiType);let me=[],de=[];if(d.value){const ne=f.meta;if(c.postid=ne[ve.posidKey||""],m.value=await ge.getPreviewUrl(c.postid.toString()),e.useCat)try{const we=await ge.getPost(c.postid.toString());me=we.categories,de=we.cate_slugs,l.debug("postid=>",c.postid),l.debug("post=>",we),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",me)}catch(we){Y.error(b("post.delete.by.platform")),V.value=!1,l.error("\u5E73\u53F0\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",we)}}else if(e.useCat&&!He(ve.blogName)){const ne=[],we=[];ne.push(ve.blogName),me=ne,we.push(ve.blogid),de=we}if(e.useCat){let ne=[];try{ne=await ge.getCategories()}catch(Ne){V.value=!1,l.error(b("main.cat.list.error"),Ne)}const we=[];ne&&ne.length&&ne.length>0&&(ne.forEach(Ne=>{const ue={value:Ne.categoryId,label:Ne.description};we.push(ue)}),c.cat.categoryList=we),c.cat.categorySelected=me.length>0?me[0]:"",r.value=c.cat.categorySelected,c.categories=me,c.cat_slugs=de}E.value=R.apiStatus||!1,V.value=!1};Ke(async()=>{await F()});function T(){return He(c.customSlug)||B.value?!0:(l.debug(b("main.force.refresh.tip")),!1)}const I=async S=>{if(!T())return;y.value=!0;const R=await n.getBlockByID(f.pageId);l.debug("page=>",R);let G=R.content;if(G.indexOf(".")>-1&&(G=G.replace(/\d*\./g,"")),l.debug("fmtTitle=>",G),c.checkList.length>0){const W=await Kt(G);l.debug("result=>",W),W?c.customSlug=W:Y.success(b("main.opt.failure"))}else c.customSlug=tt(G);if(h.value){const W=R.content+new Date().toISOString(),x="-"+zt(W).toLowerCase();c.customSlug+=x}y.value=!1,S!==!0&&Y.success(b("main.opt.success"))},K=async S=>{M.value=!0;const G=(await n.exportMdContent(f.pageId)).content,W=da(G);c.desc=Rt(W,Lt.MAX_PREVIEW_LENGTH,!0),M.value=!1,S!==!0&&Y.success(b("main.opt.success"))},H=S=>{c.tag.dynamicTags.splice(c.tag.dynamicTags.indexOf(S),1)},q=v(),Z=()=>{c.tag.inputVisible=!0,ca(()=>{q.value.focus()})},Q=()=>{c.tag.inputValue&&c.tag.dynamicTags.push(c.tag.inputValue),c.tag.inputVisible=!1,c.tag.inputValue=""};async function re(S){if(!o.value){Y.warning(b("main.tag.auto.switch.no.tip"));return}A.value=!0;const G=(await n.exportMdContent(f.pageId)).content,W=await Ht(G);l.debug("genTags=>",W);const x=Gt(W,5);l.debug("hotTags=>",x);for(let ee=0;ee<x.length;ee++)c.tag.dynamicTags.includes(x[ee])||c.tag.dynamicTags.push(x[ee]);A.value=!1,S!==!0&&Y.success(b("main.opt.success"))}const X=S=>{l.debug("val=>",S);const R=fe(e.apiType),G=[],W=[];G.push(S.label),c.categories=G,W.push(R.username+"/"+S.value),c.cat_slugs=W,r.value=S.label,l.debug(" formData.categories=>",c.categories),l.debug(" formData.cat_slugs=>",c.cat_slugs)},Fe=async S=>{const R={[Ve.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:c.customSlug,[Ve.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:c.desc,tags:c.tag.dynamicTags.join(",")};await n.setBlockAttrs(f.pageId,R),l.debug("CommonblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",R),S!==!0&&(await F(),Y.success(b("main.opt.success")))},Le=async S=>{D.value=!0,await I(!0),await K(!0),await re(!0),await Fe(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),D.value=!1,S!==!0&&Y.success(b("main.publish.oneclick.attr.finish"))},j=S=>{const G=ia(S);if(He(G))return!1;l.debug("checkLimit lastmodKey=>",S),l.debug("checkLimit lastmodDate=>",G);const W=Na(G);return W<=e.limitSeconds?(Y.error("\u7531\u4E8E\u3010"+e.apiType+"\u3011\u5E73\u53F0\u7684\u9650\u5236\uFF0C\u6BCF6\u5206\u949F\u4E4B\u5185\u53EA\u80FD\u53D1\u5E03\u6216\u8005\u66F4\u65B0\u4E00\u6B21\u6587\u7AE0\uFF0C\u8DDD\u79BB\u4E0A\u4E00\u6B21\u53D1\u5E03\u65F6\u95F4\u4E3A\uFF1A"+W+"\u79D2\uFF0C\u4ECD\u9700\u7B49\u5F85\uFF1A"+(e.limitSeconds-W)+"\u79D2"),!0):!1},et=async()=>{const R=(await n.exportMdContent(f.pageId)).content;e.removeImage&&i.hasExternalImages(R)?Xe.confirm("\u68C0\u6D4B\u5230\u5916\u94FE\u56FE\u7247\uFF0C\u7531\u4E8E\u5E73\u53F0\u9650\u5236\uFF0C\u7EE7\u7EED\u53D1\u5E03\u5C06\u5254\u9664\u8FD9\u4E9B\u56FE\u7247\uFF0C\u4EE5\u7EAF\u6587\u672C\u53D1\u5E03\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await O()}).catch(()=>{}):await O()},O=async()=>{if(!E.value){Y.error(b("setting.blog.vali.tip.metaweblog"));return}$.value=!0;try{const S=e.apiType+"_PUBLISH_LIMIT";if(j(S)){$.value=!1;return}l.debug("\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u66F4\u65B0\u53D1\u5E03\u65F6\u95F4");const R=new Date().toISOString();La(S,R),await Le(!0);const G=fe(e.apiType),W=new Ge(e.apiType),x=Ue();let ee,ve=(await n.exportMdContent(f.pageId)).content;if(e.removeImage&&(ve=i.removeImages(ve)),Pe.Html===G.pageType){const ne=_t(ve);ee=pa(ne),x.removeH1&&(ee=vt(ee))}else ee=jt(ve),x.removeH1&&(ee=Wt(ee));const ge=new Yt;ge.title=c.title,ge.wp_slug=c.customSlug,ge.description=ee,ge.categories=c.categories,ge.cate_slugs=c.cat_slugs,ge.mt_keywords=c.tag.dynamicTags.join(","),ge.dateCreated=new Date;const me=!0;let de;if(d.value){if(de=c.postid,!await W.editPost(de,ge,!0))throw Y.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+de);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",de)}else{if(de=await W.newPost(ge,me),ge.cate_slugs&&ge.cate_slugs.length>0){const we=ge.cate_slugs[0];de=de+"_"+we}l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",G.posidKey);const ne={[G.posidKey||""]:de};await n.setBlockAttrs(f.pageId,ne),l.debug("CommonblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",ne),l.debug("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",de)}await F(),Y.success(b("main.opt.success"))}catch(S){$.value=!1,l.error("\u53D1\u5E03\u5F02\u5E38",S),Y.error({dangerouslyUseHTMLString:!0,message:b("main.opt.failure")+"=>"+S})}$.value=!1},z=async()=>{U.value=!0,Xe.confirm(b("main.opt.warning.tip"),b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await se(!0),U.value=!1,Y.warning(b("main.opt.status.cancel"))}).catch(S=>{throw Y({type:"error",message:b("main.opt.failure")}),U.value=!1,new Error(S)})},se=async S=>{const R=fe(e.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",c.postid);const G={[R.posidKey||""]:""};await n.setBlockAttrs(f.pageId,G),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",G);try{if(!await new Ge(e.apiType).deletePost(c.postid))throw Y.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25"),new Error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(W){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",W)}S&&await F()};return Re(()=>e.isReload,async()=>{await F(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await F(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(S,R)=>{const G=Ye,W=Je,x=je,ee=qe,Ce=ut,ve=it,ge=sa,me=na,de=It,ne=Ft,we=aa,Ne=la,ue=We,Zt=bt,ga=Bt,fa=ht;return u(),g(fa,null,{default:a(()=>[V.value?w("",!0):(u(),g(Zt,{key:0,class:"common-main"},{default:a(()=>[t(G,{class:"top-version-tip",title:k.value+r.value,type:"info",closable:!1},null,8,["title"]),p.useCat&&d.value?(u(),g(G,{key:0,class:"top-version-tip",title:"\u4EC5\u652F\u6301\u65B0\u5EFA\u4FEE\u6539\uFF0C\u6682\u65F6\u4E0D\u652F\u6301\u7F16\u8F91\u6240\u5C5E\u77E5\u8BC6\u5E93\u3002\u5982\u679C\u60A8\u60F3\u79FB\u52A8\u6587\u6863\uFF0C\u8BF7\u5148\u70B9\u51FB\u53D6\u6D88\u5220\u9664\u8BE5\u6587\u6863\uFF0C\u7136\u540E\u91CD\u65B0\u9009\u62E9\u65B0\u7684\u77E5\u8BC6\u5E93\u53D1\u5E03\u3002",type:"warning",closable:!1})):w("",!0),E.value?w("",!0):(u(),g(G,{key:1,class:"top-version-tip",title:S.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),t(ue,{"label-width":"120px"},{default:a(()=>[be("div",Xo,[t(x,{label:S.$t("main.title")},{default:a(()=>[t(W,{modelValue:c.title,"onUpdate:modelValue":R[0]||(R[0]=le=>c.title=le),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(x,{label:S.$t("main.publish.editmode")},{default:a(()=>[t(Ce,null,{default:a(()=>[t(ee,{type:_.value?"default":"primary",onClick:P},{default:a(()=>[N(L(S.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(ee,{type:_.value?"primary":"default",onClick:J},{default:a(()=>[N(L(S.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),_.value?(u(),g(x,{key:0,label:S.$t("main.force.refresh")},{default:a(()=>[t(ve,{modelValue:B.value,"onUpdate:modelValue":R[1]||(R[1]=le=>B.value=le)},null,8,["modelValue"]),B.value?w("",!0):(u(),g(G,{key:0,title:S.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),_.value?(u(),g(x,{key:1,label:S.$t("main.slug")},{default:a(()=>[t(W,{modelValue:c.customSlug,"onUpdate:modelValue":R[2]||(R[2]=le=>c.customSlug=le)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),_.value?(u(),g(x,{key:2},{default:a(()=>[t(me,{modelValue:c.checkList,"onUpdate:modelValue":R[3]||(R[3]=le=>c.checkList=le)},{default:a(()=>[t(ge,{label:"1"},{default:a(()=>[N(L(S.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),_.value?(u(),g(x,{key:3},{default:a(()=>[t(ee,{type:"primary",class:"make-slug-btn",onClick:I,loading:y.value},{default:a(()=>[N(L(y.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),_.value?(u(),g(x,{key:4,label:S.$t("main.use.hash")},{default:a(()=>[t(ve,{modelValue:h.value,"onUpdate:modelValue":R[4]||(R[4]=le=>h.value=le)},null,8,["modelValue"]),h.value?w("",!0):(u(),g(G,{key:0,title:S.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),_.value?(u(),g(x,{key:5,label:S.$t("main.desc")},{default:a(()=>[t(W,{type:"textarea",modelValue:c.desc,"onUpdate:modelValue":R[5]||(R[5]=le=>c.desc=le)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),_.value?(u(),g(x,{key:6},{default:a(()=>[t(ee,{type:"primary",onClick:K,loading:M.value},{default:a(()=>[N(L(M.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),_.value?(u(),g(x,{key:7,label:S.$t("main.create.time")},{default:a(()=>[t(de,{type:"datetime",modelValue:c.created,"onUpdate:modelValue":R[6]||(R[6]=le=>c.created=le),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:S.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),t(x,{label:S.$t("main.tag")},{default:a(()=>[(u(!0),te(Ae,null,$e(c.tag.dynamicTags,le=>(u(),g(ne,{key:le,class:"mx-1",closable:"","disable-transitions":!1,onClose:ns=>H(le)},{default:a(()=>[N(L(le),1)]),_:2},1032,["onClose"]))),128)),c.tag.inputVisible?(u(),g(W,{key:0,ref_key:"tagRefInput",ref:q,modelValue:c.tag.inputValue,"onUpdate:modelValue":R[7]||(R[7]=le=>c.tag.inputValue=le),class:"ml-1 w-20",size:"small",onKeyup:Jt(Q,["enter"]),onBlur:Q},null,8,["modelValue","onKeyup"])):(u(),g(ee,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Z},{default:a(()=>[N(L(S.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),_.value?(u(),g(x,{key:8},{default:a(()=>[t(ee,{type:"primary",onClick:re,loading:A.value},{default:a(()=>[N(L(A.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),t(x,{label:S.$t("main.tag.auto.switch")},{default:a(()=>[t(ve,{modelValue:o.value,"onUpdate:modelValue":R[8]||(R[8]=le=>o.value=le)},null,8,["modelValue"])]),_:1},8,["label"]),e.useCat?(u(),g(x,{key:9,label:S.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[C.value?(u(),g(Ne,{key:0,modelValue:c.cat.categorySelected,"onUpdate:modelValue":R[9]||(R[9]=le=>c.cat.categorySelected=le),placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:X},{default:a(()=>[(u(!0),te(Ae,null,$e(c.cat.categoryList,le=>(u(),g(we,{key:le.value,label:le.label,value:le},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(u(),g(Ne,{key:1,modelValue:c.cat.categorySelected,"onUpdate:modelValue":R[10]||(R[10]=le=>c.cat.categorySelected=le),disabled:"",placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:X},{default:a(()=>[(u(!0),te(Ae,null,$e(c.cat.categoryList,le=>(u(),g(we,{key:le.value,label:le.label,value:le},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])):w("",!0),t(x,{label:S.$t("main.opt.quick")},{default:a(()=>[t(ee,{type:"primary",onClick:Le,loading:D.value},{default:a(()=>[N(L(D.value?S.$t("main.opt.loading"):S.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),_.value?(u(),g(ee,{key:0,type:"primary",onClick:Fe},{default:a(()=>[N(L(S.$t("main.save.attr.to.siyuan")),1)]),_:1})):w("",!0)]),_:1},8,["label"]),t(x,{label:""},{default:a(()=>[t(ee,{type:"primary",onClick:et,loading:$.value},{default:a(()=>[N(L($.value?S.$t("main.publish.loading"):d.value?S.$t("main.update"):S.$t("main.publish")),1)]),_:1},8,["loading"]),d.value?(u(),g(ee,{key:0,loading:U.value,onClick:z},{default:a(()=>[N(L(S.$t("main.cancel")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),t(x,null,{default:a(()=>[t(ee,{type:"danger",text:"",disabled:""},{default:a(()=>[N(L(d.value?S.$t("main.publish.status.published"):S.$t("main.publish.status.unpublish")),1)]),_:1}),d.value?(u(),te("a",{key:0,href:m.value,title:m.value,target:"_blank"},L(S.$t("main.publish.see.preview")),9,Zo)):w("",!0)]),_:1})]),_:1})]),_:1})),t(ga,{loading:V.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Xt=Ze(xo,[["__scopeId","data-v-2fa41586"]]),es=ae({__name:"LiandiMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_LIANDI);return(n,i)=>(u(),g(Xt,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":l.value,"page-id":e.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),ts=ae({__name:"YuqueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_YUQUE);return(n,i)=>(u(),g(Xt,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId,"use-cat":!0},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),as=ae({__name:"KmsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=v(ye.API_TYPE_KMS);return(n,i)=>(u(),g(Xt,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),ls={key:1},os=ae({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=_e.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:n,vuepressEnabled:i,hugoEnabled:b,hexoEnabled:r,jekyllEnabled:k,jvueEnabled:E,confEnabled:y,cnblogsEnabled:M,wordpressEnabled:A,liandiEnabled:D,yuqueEnabled:$,kmsEnabled:U,doCount:V}=Ct(),_=v(!1),B=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),h=o=>{const C=[];return o.forEach(c=>{const f=new lt(c.platformType,c.platformKey,c.platformName),P="switch-"+c.platformKey,J=Se(P);f.modelValue=J,J&&C.push(f),f.yamlConverter=Ha(c.platformKey)}),C},d=()=>{V();const o=st();B.dynamicConfigArray=h(o.totalCfg||[]),B.githubArray=h(o.githubCfg||[]),B.metaweblogArray=h(o.metaweblogCfg||[]),B.wordpressArray=h(o.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(o)),l.debug("\u5E73\u53F0\u8BBE\u7F6E\u521D\u59CB\u5316")},m=()=>{_.value=!_.value};return Re(()=>e.isReload,(o,C)=>{d()}),Ke(()=>{d()}),(o,C)=>{const c=$t,f=At,P=Ye;return s(n).tabCount>0?(u(),g(f,{key:0,type:"border-card",onTabChange:m},{default:a(()=>[s(i)?(u(),g(c,{key:0,label:o.$t("main.publish.to.vuepress")},{default:a(()=>[t(Yo,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(b)?(u(),g(c,{key:1,label:o.$t("main.publish.to.hugo")},{default:a(()=>[t(Ko,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(c,{key:2,label:o.$t("main.publish.to.hexo")},{default:a(()=>[t(Oo,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(c,{key:3,label:o.$t("main.publish.to.jekyll")},{default:a(()=>[t(Ro,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(E)?(u(),g(c,{key:4,label:o.$t("main.publish.to.jvue")},{default:a(()=>[t(Go,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(c,{key:5,label:o.$t("main.publish.to.conf")},{default:a(()=>[t(jo,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(M)?(u(),g(c,{key:6,label:o.$t("main.publish.to.cnblogs")},{default:a(()=>[t(Wo,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(c,{key:7,label:o.$t("main.publish.to.wordpress")},{default:a(()=>[t(qo,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(c,{key:8,label:o.$t("main.publish.to.liandi")},{default:a(()=>[t(es,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s($)?(u(),g(c,{key:9,label:o.$t("main.publish.to.yuque")},{default:a(()=>[t(ts,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(U)?(u(),g(c,{key:10,label:o.$t("main.publish.to.kms")},{default:a(()=>[t(as,{"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),(u(!0),te(Ae,null,$e(B.githubArray,J=>(u(),g(c,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ft,{"is-main-reload":_.value,"is-reload":e.isReload,"api-type":J.platformKey,"page-id":e.pageId,"yaml-converter":J.yamlConverter},null,8,["is-main-reload","is-reload","api-type","page-id","yaml-converter"])]),_:2},1032,["label"]))),128)),(u(!0),te(Ae,null,$e(B.metaweblogArray,J=>(u(),g(c,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ot,{"api-type":J.platformKey,"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128)),(u(!0),te(Ae,null,$e(B.wordpressArray,J=>(u(),g(c,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ot,{"api-type":J.platformKey,"is-main-reload":_.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),te("div",ls,[t(P,{class:"top-version-tip",title:o.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),ss=ae({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(p){const e=p,l=_e.getLogger("components/publish/PublishService.vue"),n=v("platform-main"),i=v(!1),b=r=>{const k=r.paneName;l.debug("serviceTabChange=>",k),i.value=!i.value};return(r,k)=>{const E=$t,y=At;return u(),g(y,{"model-value":n.value,"tab-position":"left",onTabClick:b},{default:a(()=>[t(E,{class:"pane-platform-main-body",name:"platform-main",label:r.$t("service.tab.publish.service")},{default:a(()=>[t(os,{"is-reload":i.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(E,{name:"platform-setting",label:r.$t("service.tab.publish.setting")},{default:a(()=>[t(Ql,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"]),t(E,{name:"post-bind",label:r.$t("service.tab.post.bind")},{default:a(()=>[t(vl,{"is-reload":i.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(E,{name:"service-switch",label:r.$t("service.tab.service.switch")},{default:a(()=>[t(yl,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"]),t(E,{name:"dynamic-platform",label:r.$t("dynamic.platform.new")},{default:a(()=>[t(tl)]),_:1},8,["label"]),t(E,{label:r.$t("service.tab.change.local"),name:"general-setting"},{default:a(()=>[t(Ga,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"])]),_:1},8,["model-value"])}}});const bs=Ze(ss,[["__scopeId","data-v-988c3419"]]);export{bs as P};

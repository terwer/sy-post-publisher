import{B as k,c as b,d as z,e as D,b as R}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{l as N}from"./vendor_xmlbuilder-c2ddcc20.js";import{s as I}from"./vendor_sax-0603144b.js";var m={},o=function(e){this.opts={},this.setOpts(e)};o.DEFAULT_OPTIONS={colons:!0,hyphens:!1,local:!0,ms:!1,offset:!1};o.ISO8601=new RegExp("([0-9]{4})([-]?([0-9]{2}))([-]?([0-9]{2}))(T([0-9]{2})(((:?([0-9]{2}))?((:?([0-9]{2}))?(.([0-9]+))?))?)(Z|([+-]([0-9]{2}(:?([0-9]{2}))?)))?)?");o.prototype.setOpts=function(e){e||(e=o.DEFAULT_OPTIONS);var t=this;Object.keys(o.DEFAULT_OPTIONS).forEach(function(r){t.opts[r]=e.hasOwnProperty(r)?e[r]:o.DEFAULT_OPTIONS[r]})};o.prototype.decodeIso8601=function(e){var t=e.toString().match(o.ISO8601);if(!t)throw new Error("Expected a ISO8601 datetime but got '"+e+"'");var r=[[t[1],t[3]||"01",t[5]||"01"].join("-"),"T",[t[7]||"00",t[11]||"00",t[14]||"00"].join(":"),".",t[16]||"000"].join("");return r+=t[17]!==void 0?t[17]+(t[19]&&t[20]===void 0?"00":""):o.formatCurrentOffset(new Date(r)),new Date(r)};o.prototype.encodeIso8601=function(e){var t=this.opts.local?o.getLocalDateParts(e):o.getUTCDateParts(e);return[[t[0],t[1],t[2]].join(this.opts.hyphens?"-":""),"T",[t[3],t[4],t[5]].join(this.opts.colons?":":""),this.opts.ms?"."+t[6]:"",this.opts.local?this.opts.offset?o.formatCurrentOffset(e):"":"Z"].join("")};o.getUTCDateParts=function(e){return[e.getUTCFullYear(),o.zeroPad(e.getUTCMonth()+1,2),o.zeroPad(e.getUTCDate(),2),o.zeroPad(e.getUTCHours(),2),o.zeroPad(e.getUTCMinutes(),2),o.zeroPad(e.getUTCSeconds(),2),o.zeroPad(e.getUTCMilliseconds(),3)]};o.getLocalDateParts=function(e){return[e.getFullYear(),o.zeroPad(e.getMonth()+1,2),o.zeroPad(e.getDate(),2),o.zeroPad(e.getHours(),2),o.zeroPad(e.getMinutes(),2),o.zeroPad(e.getSeconds(),2),o.zeroPad(e.getMilliseconds(),3)]};o.zeroPad=function(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r};o.formatCurrentOffset=function(e){var t=(e||new Date).getTimezoneOffset();return t===0?"Z":[t<0?"+":"-",o.zeroPad(Math.abs(Math.floor(t/60)),2),":",o.zeroPad(Math.abs(t%60),2)].join("")};var x=new o,C={exports:{}},M=C.exports=function(e){this.raw=e};M.prototype.serialize=function(e){return e.ele(this.tagName).txt(this.raw)};M.prototype.tagName="customType";var E=N,F=x,j=C.exports,ue=m.serializeMethodCall=function(e,s,r){var s=s||[],i={version:"1.0",allowSurrogateChars:!0};r&&(i.encoding=r);var n=E.create("methodCall",i).ele("methodName").txt(e).up().ele("params");return s.forEach(function(h){w(h,n.ele("param"))}),n.doc().toString()};m.serializeMethodResponse=function(e){var t=E.create("methodResponse",{version:"1.0",allowSurrogateChars:!0}).ele("params").ele("param");return w(e,t),t.doc().toString()};m.serializeFault=function(e){var t=E.create("methodResponse",{version:"1.0",allowSurrogateChars:!0}).ele("fault");return w(e,t),t.doc().toString()};function w(e,t){for(var r=[{value:e,xml:t}],s=null,i=null,n=null;r.length>0;)if(s=r[r.length-1],s.index!==void 0)n=S(s),n?r.push(n):r.pop();else switch(i=s.xml.ele("value"),typeof s.value){case"boolean":U(s.value,i),r.pop();break;case"string":$(s.value,i),r.pop();break;case"number":_(s.value,i),r.pop();break;case"object":s.value===null?(i.ele("nil"),r.pop()):s.value instanceof Date?(B(s.value,i),r.pop()):k.isBuffer(s.value)?(q(s.value,i),r.pop()):s.value instanceof j?(s.value.serialize(i),r.pop()):(Array.isArray(s.value)?s.xml=i.ele("array").ele("data"):(s.xml=i.ele("struct"),s.keys=Object.keys(s.value)),s.index=0,n=S(s),n?r.push(n):r.pop());break;default:r.pop();break}}function S(e){var t=null;if(e.keys){if(e.index<e.keys.length){var r=e.keys[e.index++],s=e.xml.ele("member").ele("name").text(r).up();t={value:e.value[r],xml:s}}}else e.index<e.value.length&&(t={value:e.value[e.index],xml:e.xml},e.index++);return t}function U(e,t){t.ele("boolean").txt(e?1:0)}var L=/^(?![^<&]*]]>[^<&]*)[^<&]*$/;function $(e,t){e.length===0?t.ele("string"):L.test(e)?t.ele("string").txt(e):t.ele("string").d(e)}function _(e,t){e%1==0?t.ele("int").txt(e):t.ele("double").txt(e)}function B(e,t){t.ele("dateTime.iso8601").txt(F.encodeIso8601(e))}function q(e,t){t.ele("base64").txt(e.toString("base64"))}var H={},V=I,X=x,a=function(e){this.type=null,this.responseType=null,this.stack=[],this.marks=[],this.data=[],this.methodname=null,this.encoding=e||"utf8",this.value=!1,this.callback=null,this.error=null,this.parser=V.createStream(),this.parser.on("opentag",this.onOpentag.bind(this)),this.parser.on("closetag",this.onClosetag.bind(this)),this.parser.on("text",this.onText.bind(this)),this.parser.on("cdata",this.onCDATA.bind(this)),this.parser.on("end",this.onDone.bind(this)),this.parser.on("error",this.onError.bind(this))};a.prototype.deserializeMethodResponse=function(e,t){var r=this;this.callback=function(s,i){s?t(s):i.length>1?t(new Error("Response has more than one param")):r.type!=="methodresponse"?t(new Error("Not a method response")):r.responseType?t(null,i[0]):t(new Error("Invalid method response"))},e.setEncoding(this.encoding),e.on("error",this.onError.bind(this)),e.pipe(this.parser)};a.prototype.deserializeMethodCall=function(e,t){var r=this;this.callback=function(s,i){s?t(s):r.type!=="methodcall"?t(new Error("Not a method call")):r.methodname?t(null,r.methodname,i):t(new Error("Method call did not contain a method name"))},e.setEncoding(this.encoding),e.on("error",this.onError.bind(this)),e.pipe(this.parser)};a.prototype.onDone=function(){if(!this.error)if(this.type===null||this.marks.length)this.callback(new Error("Invalid XML-RPC message"));else if(this.responseType==="fault"){var e=function(t){var r=new Error("XML-RPC fault"+(t.faultString?": "+t.faultString:""));return r.code=t.faultCode,r.faultCode=t.faultCode,r.faultString=t.faultString,r};this.callback(e(this.stack[0]))}else this.callback(void 0,this.stack)};a.prototype.onError=function(e){this.error||(typeof e=="string"?this.error=new Error(e):this.error=e,this.callback(this.error))};a.prototype.push=function(e){this.stack.push(e)};a.prototype.onOpentag=function(e){(e.name==="ARRAY"||e.name==="STRUCT")&&this.marks.push(this.stack.length),this.data=[],this.value=e.name==="VALUE"};a.prototype.onText=function(e){this.data.push(e)};a.prototype.onCDATA=function(e){this.data.push(e)};a.prototype.onClosetag=function(e){var t=this.data.join("");try{switch(e){case"BOOLEAN":this.endBoolean(t);break;case"INT":case"I4":this.endInt(t);break;case"I8":this.endI8(t);break;case"DOUBLE":this.endDouble(t);break;case"STRING":case"NAME":this.endString(t);break;case"ARRAY":this.endArray(t);break;case"STRUCT":this.endStruct(t);break;case"BASE64":this.endBase64(t);break;case"DATETIME.ISO8601":this.endDateTime(t);break;case"VALUE":this.endValue(t);break;case"PARAMS":this.endParams(t);break;case"FAULT":this.endFault(t);break;case"METHODRESPONSE":this.endMethodResponse(t);break;case"METHODNAME":this.endMethodName(t);break;case"METHODCALL":this.endMethodCall(t);break;case"NIL":this.endNil(t);break;case"DATA":case"PARAM":case"MEMBER":break;default:this.onError("Unknown XML-RPC tag '"+e+"'");break}}catch(r){this.onError(r)}};a.prototype.endNil=function(e){this.push(null),this.value=!1};a.prototype.endBoolean=function(e){if(e==="1")this.push(!0);else if(e==="0")this.push(!1);else throw new Error("Illegal boolean value '"+e+"'");this.value=!1};a.prototype.endInt=function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error("Expected an integer but got '"+e+"'");this.push(t),this.value=!1};a.prototype.endDouble=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("Expected a double but got '"+e+"'");this.push(t),this.value=!1};a.prototype.endString=function(e){this.push(e),this.value=!1};a.prototype.endArray=function(e){var t=this.marks.pop();this.stack.splice(t,this.stack.length-t,this.stack.slice(t)),this.value=!1};a.prototype.endStruct=function(e){for(var t=this.marks.pop(),r={},s=this.stack.slice(t),i=0;i<s.length;i+=2)r[s[i]]=s[i+1];this.stack.splice(t,this.stack.length-t,r),this.value=!1};a.prototype.endBase64=function(e){var t=new k(e,"base64");this.push(t),this.value=!1};a.prototype.endDateTime=function(e){var t=X.decodeIso8601(e);this.push(t),this.value=!1};var Y=/^-?\d+$/;a.prototype.endI8=function(e){if(Y.test(e))this.endString(e);else throw new Error("Expected integer (I8) value but got '"+e+"'")};a.prototype.endValue=function(e){this.value&&this.endString(e)};a.prototype.endParams=function(e){this.responseType="params"};a.prototype.endFault=function(e){this.responseType="fault"};a.prototype.endMethodResponse=function(e){this.type="methodresponse"};a.prototype.endMethodName=function(e){this.methodname=e};a.prototype.endMethodCall=function(e){this.type="methodcall"};var O=a;function A(){this.cookies={}}A.prototype={get:function(e){var t=this.cookies[e];return t&&this.checkNotExpired(e)?this.cookies[e].value:null},set:function(e,t,r){var s=typeof r=="object"?{value:t,expires:r.expires,secure:r.secure||!1,new:r.new||!1}:{value:t};this.checkNotExpired(e,s)&&(this.cookies[e]=s)},getExpirationDate:function(e){return this.cookies[e]?this.cookies[e].expires:null},checkNotExpired:function(e,t){typeof t>"u"&&(t=this.cookies[e]);var r=new Date;return t&&t.expires&&r>t.expires?(delete this.cookies[e],!1):!0},parseResponse:function(e){var t=e["set-cookie"];t&&t.forEach(function(r){var s=r.split(";"),i=s.shift().split("="),n={};s.forEach(function(h){if(h=h.trim(),h.toLowerCase().indexOf("expires")==0){var l=h.split("=")[1].trim();n.expires=new Date(l)}}),this.set(i[0].trim(),i[1].trim(),n)}.bind(this))},composeRequest:function(e){Object.keys(this.cookies).length!=0&&(e.Cookie=this.toString())},toString:function(){return Object.keys(this.cookies).filter(this.checkNotExpired.bind(this)).map(function(e){return e+"="+this.cookies[e].value}.bind(this)).join(";")}};var Z=A,G=b,J=b,T=z,K=m,Q=O,W=Z;function f(e,t){if(!(this instanceof f))return new f(e,t);if(typeof e=="string"&&(e=T.parse(e),e.host=e.hostname,e.path=e.pathname),typeof e.url<"u"){var r=T.parse(e.url);e.host=r.hostname,e.path=r.pathname,e.port=r.port}var s={"User-Agent":"NodeJS XML-RPC Client","Content-Type":"text/xml",Accept:"text/xml","Accept-Charset":"UTF8",Connection:"Keep-Alive"};if(e.headers=e.headers||{},e.headers.Authorization==null&&e.basic_auth!=null&&e.basic_auth.user!=null&&e.basic_auth.pass!=null){var i=e.basic_auth.user+":"+e.basic_auth.pass;e.headers.Authorization="Basic "+new k(i).toString("base64")}for(var n in s)e.headers[n]===void 0&&(e.headers[n]=s[n]);e.method="POST",this.options=e,this.isSecure=t,this.headersProcessors={processors:[],composeRequest:function(h){this.processors.forEach(function(l){l.composeRequest(h)})},parseResponse:function(h){this.processors.forEach(function(l){l.parseResponse(h)})}},e.cookies&&(this.cookies=new W,this.headersProcessors.processors.unshift(this.cookies))}f.prototype.methodCall=function(t,r,s){var i=this.options,n=K.serializeMethodCall(t,r,i.encoding),h=this.isSecure?J:G;i.headers["Content-Length"]=k.byteLength(n,"utf8"),this.headersProcessors.composeRequest(i.headers);var l=h.request(i,function(c){var p=[];c.on("data",function(u){p.push(u)});function d(u){return Object.defineProperty(u,"req",{value:l}),Object.defineProperty(u,"res",{value:c}),Object.defineProperty(u,"body",{value:p.join("")}),u}if(c.statusCode==404)s(d(new Error("Not Found")));else{this.headersProcessors.parseResponse(c.headers);var g=new Q(i.responseEncoding);g.deserializeMethodResponse(c,function(u,v){u&&(u=d(u)),s(u,v)})}}.bind(this));l.on("error",s),l.write(n,"utf8"),l.end()};f.prototype.getCookie=function(t){if(!this.cookies)throw"Cookies support is not turned on for this client instance";return this.cookies.get(t)};f.prototype.setCookie=function(t,r){if(!this.cookies)throw"Cookies support is not turned on for this client instance";return this.cookies.set(t,r),this};var ee=f,te=b,re=b,se=z,ie=D.EventEmitter,P=m,oe=O;function y(e,t,r){if(!(this instanceof y))return new y(e,t);r=r||function(){};var s=this;typeof e=="string"&&(e=se.parse(e),e.host=e.hostname,e.path=e.pathname);function i(n,h){var l=new oe;l.deserializeMethodCall(n,function(c,p,d){Object.prototype.hasOwnProperty.call(s._events,p)?s.emit(p,null,d,function(g,u){var v=null;g!==null?v=P.serializeFault(g):v=P.serializeMethodResponse(u),h.writeHead(200,{"Content-Type":"text/xml"}),h.end(v)}):(s.emit("NotFound",p,d),h.writeHead(404),h.end())})}this.httpServer=t?re.createServer(e,i):te.createServer(i),R.nextTick(function(){this.httpServer.listen(e.port,e.host,r)}.bind(this)),this.close=function(n){this.httpServer.once("close",n),this.httpServer.close()}.bind(this)}y.prototype.__proto__=ie.prototype;var ne=y;(function(e){var t=ee,r=ne,s=C.exports,i=x,n=e;n.createClient=function(h){return new t(h,!1)},n.createSecureClient=function(h){return new t(h,!0)},n.createServer=function(h,l){return new r(h,!1,l)},n.createSecureServer=function(h,l){return new r(h,!0,l)},n.CustomType=s,n.dateFormatter=i})(H);export{ue as s,H as x};

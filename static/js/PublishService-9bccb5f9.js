var ya=Object.defineProperty;var ba=(c,e,l)=>e in c?ya(c,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[e]=l;var ie=(c,e,l)=>(ba(c,typeof e!="symbol"?e+"":e,l),l);import{k as Ye,a as qe,s as ut,e as Ge,c as aa,d as la,j as Je,f as je,b as ha,n as _a,o as va,q as bt,r as ht,E as U,h as Xe,g as it,t as Ca,u as wa,v as At,w as $t,x as It,y as Ft,z as oa,A as Bt,B as sa,C as na}from"./vendor_element-plus-9af6f16a.js";import{L as _e,o as st,q as Te,s as Ee,t as Pt,u as ua,v as at,D as lt,w as xt,x as ea,y as Ea,j as Ze,z as Se,A as Ut,B as Ta,E as Fe,F as Sa,G as ka,H as Da,b as rt,I as le,J as nt,K as Oe,l as Ne,M as dt,N as fe,O as He,P as Yt,Q as Qe,R as pt,V as Pa,T as ye,e as Ue,U as ia,W as tt,X as Kt,Y as ke,Z as ra,$ as Ma,a0 as Mt,a1 as Vt,r as Ot,m as _t,a2 as vt,a3 as Rt,C as Lt,a4 as Nt,a5 as Ht,a6 as Gt,a7 as Va,a8 as ze,a9 as pe,aa as Ve,ab as jt,ac as Wt,ad as Aa,ae as $a,af as qt,ag as Ia,ah as Fa,ai as Ba,aj as Ua,ak as Ya,al as Ka,am as da,an as pa,k as Oa,ao as Ra,ap as La,aq as Na,ar as Ha,as as Ga}from"./api-00ff88c5.js";import{u as De}from"./vendor_vue-i18n-116fde2e.js";import{M as te,u as _,ac as ce,A as Ke,O as u,T as g,U as a,a1 as t,y as s,_ as N,$ as L,Z as w,P as ee,ao as $e,a0 as Ie,z as Re,F as Be,W as be,K as ja,V as Wa,a2 as qa,ap as Jt,X as yt,a8 as ca}from"./vendor-685d44de.js";import{d as Ja}from"./vendor_pinia-a5e71ca6.js";import{d as zt}from"./vendor_shorthash2-e60185c0.js";import{c as za}from"./vendor_copy-to-clipboard-a51858f9.js";import{f as Qa}from"./vendor_rollup-plugin-node-polyfills-2747d496.js";import{f as Xa}from"./vendor_cross-fetch-e4e57030.js";const wt=[{platformType:"Github",subPlatformType:"Github_Vitepress",platformKey:"githubVitepress-mhxj3",platformName:"Vitepress"},{platformType:"Github",subPlatformType:"Github_Nuxt",platformKey:"githubNuxt-z1xcb7x",platformName:"Nuxt content"},{platformType:"Github",subPlatformType:"Github_Next",platformKey:"githubNext-ziz9v8",platformName:"Nextra"}],Et=[{platformType:"Metaweblog",subPlatformType:"none",platformKey:"metaweblog-zahrlw",platformName:"\u5F00\u6E90\u4E2D\u56FD"},{platformType:"Metaweblog",subPlatformType:"none",platformKey:"metaweblog-22pamt",platformName:"Typeecho"}],Tt=[],Za=_e.getLogger("utils/import/importUtil.ts"),St=(c,e)=>{if(ua(e,c))return!1;const l="switch-"+c,n="custom-"+c+"-post-id";return!(at(c)||at(l)||at(n))},kt=(c,e,l,n)=>{const i=new lt(c,e,l);return i.subPlatformType=n,i},xa=()=>{const c=st().totalCfg||[];wt&&wt.length>0&&wt.forEach(e=>{if(St(e.platformKey,c)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te[e.subPlatformType]);c.push(l)}}),Et&&Et.length>0&&Et.forEach(e=>{if(St(e.platformKey,c)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te.NONE);c.push(l)}}),Tt&&Tt.length>0&&Tt.forEach(e=>{if(St(e.platformKey,c)){const l=kt(Ee[e.platformType],e.platformKey,e.platformName,Te.NONE);c.push(l)}}),Za.debug("\u5C06\u8981\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0\uFF1A",c),Pt(c)},el=te({__name:"DynamicPlatform",setup(c){const e=_e.getLogger("components/publish/tab/DynamicPlatform.vue"),{t:l}=De(),n=_(!0),i=Te.Github_Jekyll,b=_(),r=ce({subtype:i,ptype:Ee.Github,dynCfg:new lt(Ee.Github,xt(Ee.Github,i),"Jekyll-1"),subtypeOptions:[],dynamicConfigArray:[]}),k=ce({platformName:[{required:!0,message:()=>l("form.validate.name.required")}]}),T=p=>{r.subtype=p,e.debug(r.subtype),y(r.ptype)},y=p=>{r.ptype=p,r.subtypeOptions=ea(p);const o=Ea(p,r.subtype,r.subtypeOptions.length>0&&r.subtype!==Te.NONE);r.dynCfg=new lt(p,xt(p,r.subtypeOptions.length>0?r.subtype:Te.NONE),o),n.value=r.ptype!==Ee.Custom,e.debug(r.ptype)},V=p=>{if(r.ptype===Ee.Custom)return U.error(l("dynamic.platform.opt.noselect")),!1;const o=r.dynCfg.platformKey;if(e.debug("\u5C06\u8981\u4FDD\u5B58\u7684\u5E73\u53F0key",o),ua(r.dynamicConfigArray,o))return U.error(l("dynamic.platform.opt.key.exist")),!1;const C="switch-"+o,f="custom-"+o+"-post-id";return at(o)||at(C)||at(f)?(U.error(l("dynamic.platform.opt.key.exist")),!1):!0},$=async p=>{if(!p||!V()||!await p.validate((f,m)=>{f?e.debug("\u6821\u9A8C\u6210\u529F"):e.error(l("main.opt.failure"),m)}))return;const C=new lt(r.ptype,r.dynCfg.platformKey,r.dynCfg.platformName);r.ptype===Ee.Github?C.subPlatformType=r.subtype:C.subPlatformType=Te.NONE,r.dynamicConfigArray.push(C),Pt(r.dynamicConfigArray),h(),U.success(l("main.opt.success"))},D=[],A=_(0),Y=_(),B=_(l("dynamic.platform.opt.item.select")),v=p=>{Y.value=p,B.value=l("dynamic.platform.opt.item.select.tip")+Y.value.platformName,e.debug(Y.value)},P=async()=>{Xe.confirm(l("dynamic.platform.opt.del.confirm"),l("main.opt.warning"),{confirmButtonText:l("main.opt.ok"),cancelButtonText:l("main.opt.cancel"),type:"warning"}).then(async()=>{if(!Y.value||!Y.value.platformKey){U.error(l("dynamic.platform.opt.item.no.select.tip"));return}for(let p=0;p<r.dynamicConfigArray.length;p++)Y.value.platformKey===r.dynamicConfigArray[p].platformKey&&r.dynamicConfigArray.splice(p,1);Pt(r.dynamicConfigArray),h(),U.success(l("main.opt.success"))}).catch(()=>{})},h=()=>{D.length=0;for(let p=0;p<r.dynamicConfigArray.length;p++)D.push(r.dynamicConfigArray[p]);A.value=r.dynamicConfigArray.length},d=async()=>{r.subtypeOptions=ea(Ee.Github),r.dynamicConfigArray=st().totalCfg||[],h(),e.debug("dynamic init page=>",r.dynamicConfigArray)};return Ke(async()=>{e.info("\u5F00\u59CB\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0..."),xa(),e.info("\u5BFC\u5165\u9884\u5B9A\u4E49\u5E73\u53F0\u6210\u529F."),await d()}),(p,o)=>{const C=Ye,f=qe,m=ut,M=Ge,J=aa,F=la,E=Je,I=je,K=ha,G=_a,se=va,Q=bt,H=ht;return u(),g(H,null,{default:a(()=>[t(K,{height:"300px",class:"publish-dyn-header"},{default:a(()=>[t(I,{"label-width":"165px",ref_key:"formRef",ref:b,model:r.dynCfg,rules:k},{default:a(()=>[t(C,{class:"top-version-tip",title:p.$t("dynamic.platform.tip"),type:"info",closable:!1},null,8,["title"]),t(M,{label:p.$t("dynamic.platform.type")},{default:a(()=>[t(m,null,{default:a(()=>[t(f,{type:r.ptype===s(Ee).Github?"primary":"",onClick:o[0]||(o[0]=re=>y(s(Ee).Github))},{default:a(()=>[N(L(p.$t("dynamic.platform.type.github")),1)]),_:1},8,["type"]),t(f,{type:r.ptype===s(Ee).Metaweblog?"primary":"",onClick:o[1]||(o[1]=re=>y(s(Ee).Metaweblog))},{default:a(()=>[N(L(p.$t("dynamic.platform.type.metaweblog")),1)]),_:1},8,["type"]),t(f,{type:r.ptype===s(Ee).Wordpress?"primary":"",onClick:o[2]||(o[2]=re=>y(s(Ee).Wordpress))},{default:a(()=>[N(L(p.$t("dynamic.platform.type.wordpress")),1)]),_:1},8,["type"]),t(f,{type:r.ptype===s(Ee).Custom?"primary":"",onClick:o[3]||(o[3]=re=>y(s(Ee).Custom))},{default:a(()=>[N(L(p.$t("dynamic.platform.type.custom")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),n.value?w("",!0):(u(),g(M,{key:0},{default:a(()=>[t(C,{title:"\u656C\u8BF7\u671F\u5F85",type:"info",closable:!1})]),_:1})),r.subtypeOptions.length>0&&n.value?(u(),g(M,{key:1},{default:a(()=>[t(F,{modelValue:r.subtype,"onUpdate:modelValue":o[4]||(o[4]=re=>r.subtype=re),class:"m-2",placeholder:"Select",onChange:T},{default:a(()=>[(u(!0),ee(Ie,null,$e(r.subtypeOptions,re=>(u(),g(J,{key:re,label:re,value:re},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):w("",!0),n.value?(u(),g(M,{key:2,label:r.ptype+p.$t("dynamic.platform.name"),prop:"platformName"},{default:a(()=>[t(E,{modelValue:r.dynCfg.platformName,"onUpdate:modelValue":o[5]||(o[5]=re=>r.dynCfg.platformName=re),placeholder:p.$t("dynamic.platform.name.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),w("",!0),n.value?(u(),g(M,{key:4},{default:a(()=>[t(f,{type:"primary",onClick:o[6]||(o[6]=re=>$(b.value))},{default:a(()=>[N(L(p.$t("dynamic.platform.opt.add")),1)]),_:1})]),_:1})):w("",!0)]),_:1},8,["model","rules"])]),_:1}),t(Q,{class:"dyn-table-list"},{default:a(()=>[t(M,null,{default:a(()=>[(u(),g(se,{data:D,key:A.value,border:"",stripe:"","highlight-current-row":"","empty-text":"\u6682\u65E0\u6570\u636E",onCurrentChange:v},{default:a(()=>[t(G,{prop:"platformType",label:p.$t("dynamic.platform.type")},null,8,["label"]),t(G,{prop:"subPlatformType",label:p.$t("dynamic.platform.subtype")},null,8,["label"]),t(G,{prop:"platformKey",label:p.$t("dynamic.platform.key")},null,8,["label"]),t(G,{prop:"platformName",label:p.$t("dynamic.platform.name")},null,8,["label"])]),_:1}))]),_:1}),t(M,null,{default:a(()=>[Y.value?(u(),g(C,{key:0,class:"top-version-tip",title:B.value,type:"info",closable:!1},null,8,["title"])):w("",!0),t(f,{type:"danger",onClick:P},{default:a(()=>[N(L(p.$t("dynamic.platform.opt.del.select")),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const tl=Ze(el,[["__scopeId","data-v-bc346138"]]),al=Ja("tabCount",()=>{const c=_(0);function e(){c.value=0}function l(n){n&&c.value++}return{tabCount:c,resetCount:e,incrementIf:l}}),ll="switch-vuepress",ol="switch-hugo",sl="switch-hexo",nl="switch-jekyll",ul="switch-jvue",il="switch-conf",rl="switch-cnblogs",dl="switch-wordpress",pl="switch-liandi",cl="switch-yuque",ml="switch-kms",he={SWITCH_VUEPRESS_KEY:ll,SWITCH_HUGO_KEY:ol,SWITCH_HEXO_KEY:sl,SWITCH_JEKYLL_KEY:nl,SWITCH_JVUE_KEY:ul,SWITCH_CONF_KEY:il,SWITCH_CNBLOGS_KEY:rl,SWITCH_WORDPRESS_KEY:dl,SWITCH_LIANDI_KEY:pl,SWITCH_YUQUE_KEY:cl,SWITCH_KMS_KEY:ml},Ct=()=>{const c=al(),e=_(!1),l=_(!1),n=_(!1),i=_(!1),b=_(!1),r=_(!1),k=_(!1),T=_(!1),y=_(!1),V=_(!1),$=_(!1),D=ce({dynamicConfigArray:[]});function A(){c.resetCount(),e.value=Se(he.SWITCH_VUEPRESS_KEY),c.incrementIf(e.value),l.value=Se(he.SWITCH_HUGO_KEY),c.incrementIf(l.value),n.value=Se(he.SWITCH_HEXO_KEY),c.incrementIf(n.value),i.value=Se(he.SWITCH_JEKYLL_KEY),c.incrementIf(i.value),b.value=Se(he.SWITCH_JVUE_KEY),c.incrementIf(b.value),r.value=Se(he.SWITCH_CONF_KEY),c.incrementIf(r.value),k.value=Se(he.SWITCH_CNBLOGS_KEY),c.incrementIf(k.value),T.value=Se(he.SWITCH_WORDPRESS_KEY),c.incrementIf(T.value),y.value=Se(he.SWITCH_LIANDI_KEY),c.incrementIf(y.value),V.value=Se(he.SWITCH_YUQUE_KEY),c.incrementIf(V.value),$.value=Se(he.SWITCH_KMS_KEY),c.incrementIf($.value);const B=st().totalCfg||[];D.dynamicConfigArray=[],B.forEach(v=>{const P=Ut(v.platformKey),h=Se(P);v.modelValue=Ta({switchKey:v.platformKey,switchValue:h}),c.incrementIf(h),D.dynamicConfigArray.push(v)})}return{tabCountStore:c,vuepressEnabled:e,hugoEnabled:l,hexoEnabled:n,jekyllEnabled:i,jvueEnabled:b,confEnabled:r,cnblogsEnabled:k,wordpressEnabled:T,liandiEnabled:y,yuqueEnabled:V,kmsEnabled:$,switchFormData:D,doCount:A}},gl={key:0},fl=te({__name:"ServiceSwitch",props:{isReload:{type:Boolean,default:!1}},setup(c){const e=c,{tabCountStore:l,vuepressEnabled:n,hugoEnabled:i,hexoEnabled:b,jekyllEnabled:r,jvueEnabled:k,confEnabled:T,cnblogsEnabled:y,wordpressEnabled:V,liandiEnabled:$,yuqueEnabled:D,kmsEnabled:A,switchFormData:Y,doCount:B}=Ct(),v=_(!1),P=K=>{Fe(he.SWITCH_VUEPRESS_KEY,K),I()},h=K=>{Fe(he.SWITCH_HUGO_KEY,K),I()},d=K=>{Fe(he.SWITCH_HEXO_KEY,K),I()},p=K=>{Fe(he.SWITCH_JEKYLL_KEY,K),I()},o=K=>{Fe(he.SWITCH_JVUE_KEY,K),I()},C=K=>{Fe(he.SWITCH_CONF_KEY,K),I()},f=K=>{Fe(he.SWITCH_CNBLOGS_KEY,K),I()},m=K=>{Fe(he.SWITCH_WORDPRESS_KEY,K),I()},M=K=>{Fe(he.SWITCH_LIANDI_KEY,K),I()},J=K=>{Fe(he.SWITCH_YUQUE_KEY,K),I()},F=K=>{Fe(he.SWITCH_KMS_KEY,K),I()},E=K=>{const G=Da(K);Fe(G.switchKey,G.switchValue),I()},I=()=>{B(),l.tabCount===0?v.value=!0:v.value=!1};return Re(()=>e.isReload,async(K,G)=>{I()}),Ke(()=>{I()}),(K,G)=>{const se=it,Q=Ge,H=Ye,re=je;return u(),g(re,{class:"switch-form",inline:""},{default:a(()=>[t(Q,{label:K.$t("service.switch.vuepress")},{default:a(()=>[t(se,{modelValue:s(n),"onUpdate:modelValue":G[0]||(G[0]=X=>Be(n)?n.value=X:null),onChange:P},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.hugo")},{default:a(()=>[t(se,{modelValue:s(i),"onUpdate:modelValue":G[1]||(G[1]=X=>Be(i)?i.value=X:null),onChange:h},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.hexo")},{default:a(()=>[t(se,{modelValue:s(b),"onUpdate:modelValue":G[2]||(G[2]=X=>Be(b)?b.value=X:null),onChange:d},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.jekyll")},{default:a(()=>[t(se,{modelValue:s(r),"onUpdate:modelValue":G[3]||(G[3]=X=>Be(r)?r.value=X:null),onChange:p},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.jvue")},{default:a(()=>[t(se,{modelValue:s(k),"onUpdate:modelValue":G[4]||(G[4]=X=>Be(k)?k.value=X:null),onChange:o},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.conf")},{default:a(()=>[t(se,{modelValue:s(T),"onUpdate:modelValue":G[5]||(G[5]=X=>Be(T)?T.value=X:null),onChange:C},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.cnblogs")},{default:a(()=>[t(se,{modelValue:s(y),"onUpdate:modelValue":G[6]||(G[6]=X=>Be(y)?y.value=X:null),onChange:f},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.wordpress")},{default:a(()=>[t(se,{modelValue:s(V),"onUpdate:modelValue":G[7]||(G[7]=X=>Be(V)?V.value=X:null),onChange:m},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.liandi")},{default:a(()=>[t(se,{modelValue:s($),"onUpdate:modelValue":G[8]||(G[8]=X=>Be($)?$.value=X:null),onChange:M},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.yuque")},{default:a(()=>[t(se,{modelValue:s(D),"onUpdate:modelValue":G[9]||(G[9]=X=>Be(D)?D.value=X:null),onChange:J},null,8,["modelValue"])]),_:1},8,["label"]),t(Q,{label:K.$t("service.switch.kms")},{default:a(()=>[t(se,{modelValue:s(A),"onUpdate:modelValue":G[10]||(G[10]=X=>Be(A)?A.value=X:null),onChange:F},null,8,["modelValue"])]),_:1},8,["label"]),(u(!0),ee(Ie,null,$e(s(Y).dynamicConfigArray,X=>(u(),g(Q,{key:X.posid,label:X.platformName},{default:a(()=>[t(se,{modelValue:X.modelValue,"onUpdate:modelValue":Me=>X.modelValue=Me,"active-value":s(Sa)(X.platformKey),"inactive-value":s(ka)(X.platformKey),onChange:E},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value"])]),_:2},1032,["label"]))),128)),v.value?(u(),ee("div",gl,[be("p",null,[t(H,{title:K.$t("platform.must.select.one"),type:"error",closable:!1},null,8,["title"])])])):w("",!0)]),_:1})}}});const yl=Ze(fl,[["__scopeId","data-v-aa0af289"]]),bl={key:1},hl={name:"PostBind"},_l=te({...hl,props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/PostBind.vue"),{t:n}=De(),{tabCountStore:i,vuepressEnabled:b,hugoEnabled:r,hexoEnabled:k,jekyllEnabled:T,jvueEnabled:y,confEnabled:V,cnblogsEnabled:$,wordpressEnabled:D,liandiEnabled:A,yuqueEnabled:Y,kmsEnabled:B,doCount:v}=Ct(),P=ce({dynamicConfigArray:[]}),h=()=>{v();const E=st().totalCfg||[];P.dynamicConfigArray.length=0,E.forEach(I=>{const K=Ut(I.platformKey);I.modelValue=Se(K),P.dynamicConfigArray.push(I)}),l.debug(P.dynamicConfigArray)};Re(()=>e.isReload,async(F,E)=>{h(),await f()}),ja(async()=>{h(),await f()}),Ke(()=>{});const d={pageId:"",meta:{}},p=_(),o=ce({vuepressSlug:"",hugoSlug:"",hexoSlug:"",jekyllSlug:"",jvuePostid:"",cnblogsPostid:"",confPostid:"",wordpressPostid:"",liandiPostid:"",yuquePostid:"",kmsPostid:""}),C=ce({});async function f(){const F=await rt(!0,e.pageId);if(l.debug("PostBind pageId=>",F),!F||F==="")return;const I=await new Oe().getBlockAttrs(F);d.pageId=F,d.meta=I,o.vuepressSlug=I[le.VUEPRESS_POSTID_KEY],o.hugoSlug=I[le.HUGO_POSTID_KEY],o.hexoSlug=I[le.HEXO_POSTID_KEY],o.jekyllSlug=I[le.JEKYLL_POSTID_KEY],o.jvuePostid=I[le.JVUE_POSTID_KEY],o.confPostid=I[le.CONFLUENCE_POSTID_KEY],o.cnblogsPostid=I[le.CNBLOGS_POSTID_KEY],o.wordpressPostid=I[le.WORDPRESS_POSTID_KEY],o.liandiPostid=I[le.LIANDI_POSTID_KEY],o.yuquePostid=I[le.YUQUE_POSTID_KEY],o.kmsPostid=I[le.KMS_POSTID_KEY];const K=P.dynamicConfigArray;P.dynamicConfigArray=[],K.forEach(G=>{const se=nt(G.platformKey);G.posid=I[se]||"",P.dynamicConfigArray.push(G)})}const m=(F,E,I,K)=>{F&&!Ne(K)?Object.assign(E,{[I]:K}):Object.assign(E,{[I]:""})},M=async F=>{if(!(!F||!await F.validate((I,K)=>{I?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(n("main.opt.failure"),K)})))try{const I={};m(b.value,I,le.VUEPRESS_POSTID_KEY,o.vuepressSlug),m(r.value,I,le.HUGO_POSTID_KEY,o.hugoSlug),m(k.value,I,le.HEXO_POSTID_KEY,o.hexoSlug),m(T.value,I,le.JEKYLL_POSTID_KEY,o.jekyllSlug),m(y.value,I,le.JVUE_POSTID_KEY,o.jvuePostid),m(V.value,I,le.CONFLUENCE_POSTID_KEY,o.confPostid),m($.value,I,le.CNBLOGS_POSTID_KEY,o.cnblogsPostid),m(D.value,I,le.WORDPRESS_POSTID_KEY,o.wordpressPostid),m(A.value,I,le.LIANDI_POSTID_KEY,o.liandiPostid),m(Y.value,I,le.YUQUE_POSTID_KEY,o.yuquePostid),m(B.value,I,le.KMS_POSTID_KEY,o.kmsPostid),P.dynamicConfigArray.forEach(G=>{const se=nt(G.platformKey);m(G.modelValue,I,se,G.posid)}),l.debug("PostBind\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",I),await new Oe().setBlockAttrs(d.pageId,I),U.success(n("main.opt.success"))}catch(I){l.error("\u4FDD\u5B58\u5F02\u5E38",I);let K="\u4FDD\u5B58\u5F02\u5E38";I&&(K=I.toString()),U.error({dangerouslyUseHTMLString:!0,message:n("main.opt.failure")+"=>"+K})}},J=F=>{!F||F.resetFields()};return(F,E)=>{const I=Je,K=Ge,G=qe,se=je,Q=Ye;return s(i).tabCount>0?(u(),g(se,{key:0,"label-width":"85px",class:"post-bind-form",ref_key:"ruleFormRef",ref:p,model:o,rules:C,"status-icon":""},{default:a(()=>[s(b)?(u(),g(K,{key:0,label:F.$t("post.bind.vuepress.slug"),prop:"vuepressSlug"},{default:a(()=>[t(I,{modelValue:o.vuepressSlug,"onUpdate:modelValue":E[0]||(E[0]=H=>o.vuepressSlug=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(K,{key:1,label:F.$t("post.bind.hugo.slug"),prop:"hugoSlug"},{default:a(()=>[t(I,{modelValue:o.hugoSlug,"onUpdate:modelValue":E[1]||(E[1]=H=>o.hugoSlug=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(K,{key:2,label:F.$t("post.bind.hexo.slug"),prop:"hexosSlug"},{default:a(()=>[t(I,{modelValue:o.hexoSlug,"onUpdate:modelValue":E[2]||(E[2]=H=>o.hexoSlug=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(T)?(u(),g(K,{key:3,label:F.$t("post.bind.jekyll.slug"),prop:"jekyllSlug"},{default:a(()=>[t(I,{modelValue:o.jekyllSlug,"onUpdate:modelValue":E[3]||(E[3]=H=>o.jekyllSlug=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(K,{key:4,label:F.$t("post.bind.jvue.postid"),prop:"jvuePostid"},{default:a(()=>[t(I,{modelValue:o.jvuePostid,"onUpdate:modelValue":E[4]||(E[4]=H=>o.jvuePostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(V)?(u(),g(K,{key:5,label:F.$t("post.bind.conf.postid"),prop:"confPostid"},{default:a(()=>[t(I,{modelValue:o.confPostid,"onUpdate:modelValue":E[5]||(E[5]=H=>o.confPostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s($)?(u(),g(K,{key:6,label:F.$t("post.bind.cnblogs.postid"),prop:"cnblogsPostid"},{default:a(()=>[t(I,{modelValue:o.cnblogsPostid,"onUpdate:modelValue":E[6]||(E[6]=H=>o.cnblogsPostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(K,{key:7,label:F.$t("post.bind.wordpress.postid"),prop:"wordpressPostid"},{default:a(()=>[t(I,{modelValue:o.wordpressPostid,"onUpdate:modelValue":E[7]||(E[7]=H=>o.wordpressPostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(K,{key:8,label:F.$t("post.bind.liandi.postid"),prop:"liandiPostid"},{default:a(()=>[t(I,{modelValue:o.liandiPostid,"onUpdate:modelValue":E[8]||(E[8]=H=>o.liandiPostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(Y)?(u(),g(K,{key:9,label:F.$t("post.bind.yuque.postid"),prop:"yuquePostid"},{default:a(()=>[t(I,{modelValue:o.yuquePostid,"onUpdate:modelValue":E[9]||(E[9]=H=>o.yuquePostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(B)?(u(),g(K,{key:10,label:F.$t("post.bind.kms.postid"),prop:"kmsPostid"},{default:a(()=>[t(I,{modelValue:o.kmsPostid,"onUpdate:modelValue":E[10]||(E[10]=H=>o.kmsPostid=H)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),(u(!0),ee(Ie,null,$e(P.dynamicConfigArray,(H,re)=>Wa((u(),g(K,{key:re,label:H.platformName},{default:a(()=>[t(I,{modelValue:H.posid,"onUpdate:modelValue":X=>H.posid=X},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])),[[qa,H.modelValue]])),128)),t(K,null,{default:a(()=>[t(G,{type:"primary",onClick:E[11]||(E[11]=H=>M(p.value))},{default:a(()=>[N(L(F.$t("post.bind.conf.save")),1)]),_:1}),t(G,{onClick:E[12]||(E[12]=H=>J(p.value))},{default:a(()=>[N(L(F.$t("post.bind.conf.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):(u(),ee("div",bl,[t(Q,{class:"top-version-tip",title:F.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}});const vl=Ze(_l,[["__scopeId","data-v-1e3d85a4"]]);class Cl extends dt{constructor(e){switch(super("","","","",""),this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.posidKey=nt(e.platformKey),this.blogName=e.subPlatformType,e.subPlatformType){case Te.Github_Vuepress:this.defaultPath="docs",this.mdFilenameRule="[filename].md";break;case Te.Github_Hugo:this.defaultPath="content/post",this.mdFilenameRule="[slug].md";break;case Te.Github_Hexo:this.defaultPath="source/_posts",this.mdFilenameRule="[slug].md";break;case Te.Github_Jekyll:this.defaultPath="_posts",this.mdFilenameRule="[yyyy]-[mm]-[dd]-[slug].md";break;case Te.Github_Vitepress:this.defaultPath="docs",this.previewUrl="/[docpath].html",this.mdFilenameRule="[slug].md";break;case Te.Github_Nuxt:this.defaultPath="content",this.previewUrl="/[docpath]",this.mdFilenameRule="[slug].md";break;case Te.Github_Next:this.defaultPath="pages",this.previewUrl="/[docpath]",this.mdFilenameRule="[slug].md";break}}}var Pe=(c=>(c[c.Markdown=0]="Markdown",c[c.Html=1]="Html",c))(Pe||{});class xe{constructor(e,l,n,i){ie(this,"home");ie(this,"apiUrl");ie(this,"username");ie(this,"password");ie(this,"apiStatus");ie(this,"blogName");ie(this,"posidKey");ie(this,"previewUrl");ie(this,"pageType");this.home=e,this.apiUrl=l,this.username=n,this.password=i,this.apiStatus=!1,this.blogName="",this.posidKey="",this.previewUrl="",this.pageType=Pe.Markdown}}class wl extends xe{constructor(e){super("","","",""),this.posidKey=e,this.previewUrl="/p/[postid].html",this.pageType=Pe.Html}}class El extends xe{constructor(e){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=e,this.previewUrl="/?p=[postid]",this.pageType=Pe.Html}}const Tl={class:"github-setting-basic"},Sl={href:"https://github.com/settings/tokens/new",target:"_blank"},kl={key:0,class:"github-setting-advanced"},ct=te({__name:"GithubSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:dt,default:null}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/setting/GithubSetting.vue"),{t:n}=De(),i=_(!1),b=_(!1),r=_(!1),k=_(!0),T=_(),y=ce({githubUser:"",githubRepo:"",githubToken:"",defaultBranch:"main",defaultPath:"docs/_posts",msg:"auto published by sy-post-publisher",author:"terwer",email:"youweics@163.com",home:"",baseUrl:"",previewMdUrl:"",previewUrl:"",mdFilenameRule:"[filename]"}),V=ce({githubUser:[{required:!0,message:()=>n("form.validate.name.required")}],githubRepo:[{required:!0,message:()=>n("form.validate.name.required")}],githubToken:[{required:!0,message:()=>n("form.validate.name.required")}],defaultBranch:[{required:!0,message:()=>n("form.validate.name.required")}],defaultPath:[{required:!0,message:()=>n("form.validate.name.required")}],msg:[{required:!0,message:()=>n("form.validate.name.required")}],author:[{required:!0,message:()=>n("form.validate.name.required")}],email:[{required:!0,message:()=>n("form.validate.name.required")}]}),$=()=>{i.value=!1},D=()=>{i.value=!0},A=d=>{k.value=d},Y=d=>{!d||d.resetFields()},B=async d=>{!d||!await d.validate((o,C)=>{o?l.debug("\u6821\u9A8C\u6210\u529F"):l.error(n("main.opt.failure"),C)})||P(!1)},v=async()=>{b.value=!0,P(!0);const d=fe(e.apiType);let p;try{const o=new He(e.apiType),C=new Yt;C.postid="content/post/test.md",C.description="# Hello world";let f;try{f=await o.newPost(C)}catch(m){p=m,d.apiStatus=!1,r.value=!1}f?(d.apiStatus=!0,r.value=!0):(d.apiStatus=!1,r.value=!1),k.value&&await o.deletePost(C.postid)}catch(o){d.apiStatus=!1,r.value=!1,l.error(o)}Qe(e.apiType,d),r.value?U.success(n("main.opt.success")):p?U.error(n("setting.blog.vali.error")+"=>"+p):U.error(n("setting.blog.vali.error")),b.value=!1},P=d=>{const p=e.cfg;p.githubUser=y.githubUser,p.githubRepo=y.githubRepo,p.githubToken=y.githubToken,p.defaultPath=y.defaultPath,p.defaultBranch=y.defaultBranch,p.defaultMsg=y.msg,p.author=y.author,p.email=y.email,p.home=y.home,p.baseUrl=y.baseUrl,p.previewMdUrl=y.previewMdUrl,p.previewUrl=y.previewUrl,p.mdFilenameRule=y.mdFilenameRule,p.apiStatus=r.value,Qe(e.apiType,p),d!==!0&&U.success(n("main.opt.success"))},h=()=>{let d=fe(e.apiType);pt(d)&&(d=e.cfg),d&&(y.githubUser=d.githubUser,y.githubRepo=d.githubRepo,y.githubToken=d.githubToken,y.defaultPath=d.defaultPath,y.defaultBranch=d.defaultBranch,y.msg=d.defaultMsg,y.author=d.author,y.email=d.email,y.home=d.home,y.baseUrl=d.baseUrl,y.previewMdUrl=d.previewMdUrl,y.previewUrl=d.previewUrl,y.mdFilenameRule=d.mdFilenameRule,r.value=d.apiStatus)};return Ke(async()=>{h()}),(d,p)=>{const o=qe,C=ut,f=Ge,m=Je,M=it,J=Ye,F=je;return u(),g(F,{"label-width":"120px",ref_key:"formRef",ref:T,model:y,rules:V,"status-icon":""},{default:a(()=>[t(f,{label:d.$t("main.publish.editmode")},{default:a(()=>[t(C,null,{default:a(()=>[t(o,{type:i.value?"default":"primary",onClick:$},{default:a(()=>[N(L(d.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(o,{type:i.value?"primary":"default",onClick:D},{default:a(()=>[N(L(d.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),be("div",Tl,[t(f,{label:d.$t("setting.blog.type.github.user"),prop:"githubUser"},{default:a(()=>[t(m,{modelValue:y.githubUser,"onUpdate:modelValue":p[0]||(p[0]=E=>y.githubUser=E),placeholder:d.$t("setting.blog.type.github.user.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.repo"),prop:"githubRepo"},{default:a(()=>[t(m,{modelValue:y.githubRepo,"onUpdate:modelValue":p[1]||(p[1]=E=>y.githubRepo=E),placeholder:d.$t("setting.blog.type.github.repo.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.default.branch"),prop:"defaultBranch"},{default:a(()=>[t(m,{modelValue:y.defaultBranch,"onUpdate:modelValue":p[2]||(p[2]=E=>y.defaultBranch=E),placeholder:d.$t("setting.blog.type.github.default.branch.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.token"),prop:"githubToken"},{default:a(()=>[t(m,{type:"password",modelValue:y.githubToken,"onUpdate:modelValue":p[3]||(p[3]=E=>y.githubToken=E),placeholder:d.$t("setting.blog.type.github.token.tip"),"show-password":""},null,8,["modelValue","placeholder"]),be("a",Sl,L(d.$t("setting.blog.type.github.token.gen")),1)]),_:1},8,["label"])]),i.value?(u(),ee("div",kl,[t(f,{label:d.$t("setting.blog.type.github.default.path"),prop:"defaultPath"},{default:a(()=>[t(m,{modelValue:y.defaultPath,"onUpdate:modelValue":p[4]||(p[4]=E=>y.defaultPath=E),placeholder:d.$t("setting.blog.type.github.default.path.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.msg"),prop:"msg"},{default:a(()=>[t(m,{modelValue:y.msg,"onUpdate:modelValue":p[5]||(p[5]=E=>y.msg=E),placeholder:d.$t("setting.blog.type.github.msg.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.author"),prop:"author"},{default:a(()=>[t(m,{modelValue:y.author,"onUpdate:modelValue":p[6]||(p[6]=E=>y.author=E),placeholder:d.$t("setting.blog.type.github.author.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.type.github.email"),prop:"email"},{default:a(()=>[t(m,{modelValue:y.email,"onUpdate:modelValue":p[7]||(p[7]=E=>y.email=E),placeholder:d.$t("setting.blog.type.github.email.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.common.home")},{default:a(()=>[t(m,{modelValue:y.home,"onUpdate:modelValue":p[8]||(p[8]=E=>y.home=E),placeholder:d.$t("setting.common.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.github.baseUrl")},{default:a(()=>[t(m,{modelValue:y.baseUrl,"onUpdate:modelValue":p[9]||(p[9]=E=>y.baseUrl=E),placeholder:d.$t("setting.github.baseUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.previewMdUrl")},{default:a(()=>[t(m,{modelValue:y.previewMdUrl,"onUpdate:modelValue":p[10]||(p[10]=E=>y.previewMdUrl=E),placeholder:d.$t("setting.blog.previewMdUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.previewUrl")},{default:a(()=>[t(m,{modelValue:y.previewUrl,"onUpdate:modelValue":p[11]||(p[11]=E=>y.previewUrl=E),placeholder:d.$t("setting.blog.previewUrl.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:d.$t("setting.blog.mdFilenameRule")},{default:a(()=>[t(m,{modelValue:y.mdFilenameRule,"onUpdate:modelValue":p[12]||(p[12]=E=>y.mdFilenameRule=E),placeholder:d.$t("setting.blog.mdFilenameRule.tip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])):w("",!0),t(f,{label:d.$t("form.validate.github.auto.delete")},{default:a(()=>[t(M,{modelValue:k.value,"onUpdate:modelValue":p[13]||(p[13]=E=>k.value=E),onChange:A},null,8,["modelValue"])]),_:1},8,["label"]),t(f,null,{default:a(()=>[t(o,{type:"primary",onClick:v,loading:b.value},{default:a(()=>[N(L(b.value?d.$t("setting.blog.vali.ing"):d.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),r.value?w("",!0):(u(),g(J,{key:0,title:d.$t("setting.blog.vali.tip"),type:"warning",closable:!1},null,8,["title"])),r.value?(u(),g(J,{key:1,title:d.$t("setting.blog.vali.ok"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(f,null,{default:a(()=>[t(o,{type:"primary",onClick:p[14]||(p[14]=E=>B(T.value))},{default:a(()=>[N(L(d.$t("setting.blog.save")),1)]),_:1}),t(o,{onClick:p[15]||(p[15]=E=>Y(T.value))},{default:a(()=>[N(L(d.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Dl=te({__name:"VuepressSetting",setup(c){const e=_(ye.API_TYPE_VUEPRESS),l=new Pa,n=_(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Pl extends dt{constructor(){super("",Te.Github_Hugo,"","",""),this.defaultPath="content/post",this.posidKey=le.HUGO_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[slug].md"}}const Ml=te({__name:"HugoSetting",setup(c){const e=_(ye.API_TYPE_HUGO),l=new Pl,n=_(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Vl extends dt{constructor(){super("",Te.Github_Hexo,"","",""),this.defaultPath="source/_posts",this.posidKey=le.HEXO_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[slug].md"}}const Al=te({__name:"HexoSetting",setup(c){const e=_(ye.API_TYPE_HEXO),l=new Vl,n=_(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class $l extends dt{constructor(){super("",Te.Github_Jekyll,"","",""),this.defaultPath="_posts",this.posidKey=le.JEKYLL_POSTID_KEY,this.previewMdUrl="/[user]/[repo]/blob/[branch]/[docpath]",this.previewUrl="/post/[postid].html",this.mdFilenameRule="[yyyy]-[mm]-[dd]-[slug].md"}}const Il=te({__name:"JekyllSetting",setup(c){const e=_(ye.API_TYPE_JEKYLL),l=new $l,n=_(l);return(i,b)=>(u(),g(ct,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Fl extends xe{constructor(){super("https://[your-jvue-site]","https://[your-jvue-site]/xmlrpc","",""),this.posidKey=le.JVUE_POSTID_KEY,this.previewUrl="/post/[postid].html",this.pageType=Pe.Markdown}}const mt=te({__name:"MetaweblogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:xe,default:null}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/setting/MetaweblogSetting.vue"),{t:n}=De(),i=parseInt(Pe.Markdown.toString()),b=_(""),r=_(""),k=_(""),T=_(""),y=_(""),V=_(i),$=_(!1),D=_(!1),A=_(""),Y=_(n("setting.blog.platform.support.metaweblog")+e.apiType+" "),B=async()=>{$.value=!0;try{v(!0);const h=fe(e.apiType),p=await new He(e.apiType).getUsersBlogs();if(p&&p.length>0){const o=p[0];h.blogName=o.blogName,A.value=o.blogName,h.apiStatus=!0,D.value=!0}else h.apiStatus=!1,D.value=!1;Qe(e.apiType,h)}catch(h){console.error(h)}D.value?U.success(n("main.opt.success")):U.error(n("setting.blog.vali.error")),$.value=!1,l.debug("Metaweblog\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},v=h=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const d=e.cfg;d.home=b.value,d.username=T.value,d.password=y.value,d.apiUrl=r.value,d.previewUrl=k.value,d.blogName=A.value,d.pageType=V.value,d.apiStatus=D.value,Qe(e.apiType,d),h!==!0&&U.success(n("main.opt.success"))},P=()=>{l.debug("Metaweblog\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=fe(e.apiType);pt(h)&&(h=e.cfg),h&&(l.debug("get setting conf=>",h),b.value=h.home,r.value=h.apiUrl,k.value=h.previewUrl,T.value=h.username,y.value=h.password,A.value=h.blogName,V.value=h.pageType,D.value=h.apiStatus)};return Ke(async()=>{P()}),(h,d)=>{const p=Ye,o=Je,C=Ge,f=Ca,m=wa,M=qe,J=je;return u(),g(J,{"label-width":"120px"},{default:a(()=>[t(p,{class:"top-version-tip",title:Y.value+A.value,type:"info",closable:!1},null,8,["title"]),t(C,{label:h.$t("setting.blog.url")},{default:a(()=>[t(o,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=F=>b.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.username")},{default:a(()=>[t(o,{modelValue:T.value,"onUpdate:modelValue":d[1]||(d[1]=F=>T.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.password")},{default:a(()=>[t(o,{type:"password",modelValue:y.value,"onUpdate:modelValue":d[2]||(d[2]=F=>y.value=F),"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.apiurl")},{default:a(()=>[t(o,{modelValue:r.value,"onUpdate:modelValue":d[3]||(d[3]=F=>r.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.previewUrl")},{default:a(()=>[t(o,{modelValue:k.value,"onUpdate:modelValue":d[4]||(d[4]=F=>k.value=F)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,{label:h.$t("setting.blog.pageType")},{default:a(()=>[t(m,{modelValue:V.value,"onUpdate:modelValue":d[5]||(d[5]=F=>V.value=F),class:"ml-4"},{default:a(()=>[t(f,{label:0,size:"large"},{default:a(()=>[N("Markdown")]),_:1}),t(f,{label:1,size:"large"},{default:a(()=>[N("HTML")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(C,null,{default:a(()=>[t(M,{type:"primary",onClick:B,loading:$.value},{default:a(()=>[N(L($.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),D.value?w("",!0):(u(),g(p,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),D.value?(u(),g(p,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(C,null,{default:a(()=>[t(M,{type:"primary",onClick:v},{default:a(()=>[N(L(h.$t("setting.blog.save")),1)]),_:1}),t(M,null,{default:a(()=>[N(L(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Bl=te({__name:"JVueSetting",setup(c){const e=_(ye.API_TYPE_JVUE),l=_(new Fl);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Ul extends xe{constructor(){super("https://youweics.atlassian.net/wiki/spaces/[spaceKey]","http://localhost:3000/api/xmlrpc","",""),this.posidKey=le.CONFLUENCE_POSTID_KEY,this.previewUrl="pages/[postid]",this.pageType=Pe.Html}}const Yl=te({__name:"ConfluenceSetting",setup(c){const e=_(ye.API_TYPE_CONFLUENCE),l=_(new Ul);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class Kl extends xe{constructor(){super("https://www.cnblogs.com/[yourblog]","https://rpc.cnblogs.com/metaweblog/[yourblog]","",""),this.posidKey=le.CNBLOGS_POSTID_KEY,this.previewUrl="/p/[postid].html",this.pageType=Pe.Markdown}}const Ol=te({__name:"CnblogsSetting",setup(c){const e=_(ye.API_TYPE_CNBLOGS),l=new Kl,n=_(l);return(i,b)=>(u(),g(mt,{"api-type":e.value,cfg:n.value},null,8,["api-type","cfg"]))}});class Rl extends xe{constructor(){super("http://localhost:8000","http://localhost:8000/xmlrpc.php","",""),this.posidKey=le.WORDPRESS_POSTID_KEY,this.previewUrl="/?p=[postid]",this.pageType=Pe.Markdown}}const ta=te({__name:"WordpressSetting",setup(c){const e=_(ye.API_TYPE_WORDPRESS),l=_(new Rl);return(n,i)=>(u(),g(mt,{"api-type":e.value,cfg:l.value},null,8,["api-type","cfg"]))}});class gt{constructor(){ie(this,"home");ie(this,"apiUrl");ie(this,"username");ie(this,"password");ie(this,"token");ie(this,"apiStatus");ie(this,"blogName");ie(this,"blogid");ie(this,"posidKey");ie(this,"previewUrl");ie(this,"pageType");ie(this,"tokenSettingUrl");this.home="",this.apiUrl="",this.username="",this.password="",this.token="",this.apiStatus=!1,this.blogName="",this.blogid="",this.posidKey="",this.previewUrl="",this.pageType=Pe.Markdown,this.tokenSettingUrl=""}}class Ll extends gt{constructor(){super(),this.home="https://ld246.com/",this.apiUrl="https://ld246.com/api/v2",this.tokenSettingUrl="https://ld246.com/settings/account",this.posidKey=le.LIANDI_POSTID_KEY,this.previewUrl="/article/[postid]",this.pageType=Pe.Markdown}}const Nl=["href"],Hl=["href"],Qt=te({__name:"CommonBlogSetting",props:{isReload:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},usernameEnabled:{type:Boolean,default:!1},passwordEnabled:{type:Boolean,default:!1},tokenEnabled:{type:Boolean,default:!1}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/setting/CommonBlogSetting.vue"),{t:n}=De(),i=_(""),b=_(""),r=_(""),k=_(""),T=_(""),y=_(!1),V=_(!1),$=_(""),D=_(""),A=_(""),Y=_(n("setting.blog.platform.support.common")+e.apiType+" "),B=async()=>{y.value=!0;try{v(!0);const h=fe(e.apiType),p=await new He(e.apiType).getUsersBlogs();if(p&&p.length>0){const o=p[0];h.apiStatus=!0,V.value=!0,h.blogName=o.blogName,$.value=o.blogName,h.blogid=o.blogid,D.value=o.blogid,Qe(e.apiType,h)}else h.apiStatus=!1,V.value=!1,Qe(e.apiType,h)}catch(h){console.error(h)}V.value?U.success(n("main.opt.success")):U.error(n("setting.blog.vali.error")),y.value=!1,l.debug("\u901A\u7528Setting\u9A8C\u8BC1\u5B8C\u6BD5")},v=h=>{l.debug("Metaweblog\u901A\u7528Setting\u4FDD\u5B58\u914D\u7F6E");const d=e.cfg;d.home=i.value,d.username=r.value,d.password=k.value,d.token=T.value,d.apiUrl=b.value,d.apiStatus=V.value,d.blogName=$.value,d.blogid=D.value,Qe(e.apiType,d),h!==!0&&U.success(n("main.opt.success"))},P=()=>{l.debug("\u901A\u7528Setting\u914D\u7F6E\u521D\u59CB\u5316");let h=fe(e.apiType);pt(h)&&(h=e.cfg),h&&(l.debug("get setting conf=>",h),i.value=h.home||"",b.value=h.apiUrl||"",r.value=h.username||"",k.value=h.password||"",T.value=h.token||"",V.value=h.apiStatus||!1,$.value=h.blogName||"",D.value=h.blogid||"",A.value=h.tokenSettingUrl||"")};return Ke(async()=>{P()}),(h,d)=>{const p=Ye,o=Je,C=Ge,f=qe,m=je;return u(),g(m,{"label-width":"120px"},{default:a(()=>[t(p,{class:"top-version-tip",title:Y.value+$.value,type:"info",closable:!1},null,8,["title"]),t(C,{label:h.$t("setting.common.home")},{default:a(()=>[t(o,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=M=>i.value=M)},null,8,["modelValue"])]),_:1},8,["label"]),e.usernameEnabled?(u(),g(C,{key:0,label:h.$t("setting.common.username")},{default:a(()=>[t(o,{modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=M=>r.value=M)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),e.passwordEnabled?(u(),g(C,{key:1,label:h.$t("setting.common.password")},{default:a(()=>[t(o,{type:"password",modelValue:k.value,"onUpdate:modelValue":d[2]||(d[2]=M=>k.value=M),"show-password":""},null,8,["modelValue"]),be("a",{href:A.value,target:"_blank"},L(h.$t("setting.common.username.gen"))+"\uFF1A"+L(A.value),9,Nl)]),_:1},8,["label"])):w("",!0),e.tokenEnabled?(u(),g(C,{key:2,label:h.$t("setting.common.token")},{default:a(()=>[t(o,{type:"password",modelValue:T.value,"onUpdate:modelValue":d[3]||(d[3]=M=>T.value=M),"show-password":""},null,8,["modelValue"]),be("a",{href:A.value,target:"_blank"},L(h.$t("setting.common.token.gen"))+"\uFF1A"+L(A.value),9,Hl)]),_:1},8,["label"])):w("",!0),t(C,{label:h.$t("setting.common.apiurl")},{default:a(()=>[t(o,{modelValue:b.value,"onUpdate:modelValue":d[4]||(d[4]=M=>b.value=M)},null,8,["modelValue"])]),_:1},8,["label"]),t(C,null,{default:a(()=>[t(f,{type:"primary",onClick:B,loading:y.value},{default:a(()=>[N(L(y.value?h.$t("setting.blog.vali.ing"):h.$t("setting.blog.vali")),1)]),_:1},8,["loading"]),V.value?w("",!0):(u(),g(p,{key:0,title:h.$t("setting.blog.vali.tip.metaweblog"),type:"warning",closable:!1},null,8,["title"])),V.value?(u(),g(p,{key:1,title:h.$t("setting.blog.vali.ok.metaweblog"),type:"success",closable:!1},null,8,["title"])):w("",!0)]),_:1}),t(C,null,{default:a(()=>[t(f,{type:"primary",onClick:v},{default:a(()=>[N(L(h.$t("setting.blog.save")),1)]),_:1}),t(f,null,{default:a(()=>[N(L(h.$t("setting.blog.cancel")),1)]),_:1})]),_:1})]),_:1})}}}),Gl=te({__name:"LiandiSetting",setup(c){const e=_(ye.API_TYPE_LIANDI),l=new Ll,n=_(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}});class jl extends gt{constructor(){super(),this.home="https://www.yuque.com/",this.apiUrl="https://www.yuque.com/api/v2",this.tokenSettingUrl="https://www.yuque.com/settings/tokens",this.posidKey=le.YUQUE_POSTID_KEY,this.previewUrl="/[notebook]/[postid]",this.pageType=Pe.Markdown}}const Wl=te({__name:"YuqueSetting",setup(c){const e=_(ye.API_TYPE_YUQUE),l=new jl,n=_(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"token-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}});class ql extends gt{constructor(){super(),this.home="http://localhost:9564/kms16_release/kms/multidoc",this.apiUrl="http://localhost:9564/kms16_release/api/kms-multidoc/kmsMultidocKnowledgeRestService",this.tokenSettingUrl="http://localhost:9564/kms16_release/sys/profile/index.jsp#integrate/RestService/",this.posidKey=le.KMS_POSTID_KEY,this.previewUrl="/kms_multidoc_knowledge/kmsMultidocKnowledge.do?method=view&fdId=[postid]",this.pageType=Pe.Html}}const Jl=te({__name:"KmsSetting",setup(c){const e=_(ye.API_TYPE_KMS),l=new ql,n=_(l);return(i,b)=>(u(),g(Qt,{"api-type":e.value,"username-enabled":!0,"password-enabled":!0,cfg:n.value},null,8,["api-type","cfg"]))}}),zl={key:1},Ql=te({__name:"PlatformSetting",props:{isReload:{type:Boolean,default:!1}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/PlatformSetting.vue"),{tabCountStore:n,vuepressEnabled:i,hugoEnabled:b,hexoEnabled:r,jekyllEnabled:k,jvueEnabled:T,confEnabled:y,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:D,yuqueEnabled:A,kmsEnabled:Y,doCount:B}=Ct(),v=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),P=_(C=>new Cl(C)),h=_(C=>new wl(nt(C.platformKey))),d=_(C=>new El(nt(C.platformKey))),p=C=>{const f=[];return C.forEach(m=>{const M=new lt(m.platformType,m.platformKey,m.platformName);M.subPlatformType=m.subPlatformType;const J=Ut(m.platformKey),F=Se(J);M.modelValue=F,F&&f.push(M)}),f},o=()=>{B();const C=st();v.dynamicConfigArray=p(C.totalCfg||[]),v.githubArray=p(C.githubCfg||[]),v.metaweblogArray=p(C.metaweblogCfg||[]),v.wordpressArray=p(C.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(C))};return Re(()=>e.isReload,(C,f)=>{o(),l.debug("platform-setting\u521D\u59CB\u5316")}),Ke(()=>{o()}),(C,f)=>{const m=At,M=$t,J=Ye;return s(n).tabCount>0?(u(),g(M,{key:0,type:"border-card"},{default:a(()=>[s(i)?(u(),g(m,{key:0,label:C.$t("setting.vuepress")+C.$t("setting.blog.setting")},{default:a(()=>[t(Dl)]),_:1},8,["label"])):w("",!0),s(b)?(u(),g(m,{key:1,label:C.$t("setting.hugo")+C.$t("setting.blog.setting")},{default:a(()=>[t(Ml)]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(m,{key:2,label:C.$t("setting.hexo")+C.$t("setting.blog.setting")},{default:a(()=>[t(Al)]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(m,{key:3,label:C.$t("setting.jekyll")+C.$t("setting.blog.setting")},{default:a(()=>[t(Il)]),_:1},8,["label"])):w("",!0),s(T)?(u(),g(m,{key:4,label:C.$t("setting.jvue")+C.$t("setting.blog.setting")},{default:a(()=>[t(Bl)]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(m,{key:5,label:C.$t("setting.conf")+C.$t("setting.blog.setting")},{default:a(()=>[t(Yl)]),_:1},8,["label"])):w("",!0),s(V)?(u(),g(m,{key:6,label:C.$t("setting.cnblogs")+C.$t("setting.blog.setting")},{default:a(()=>[t(Ol)]),_:1},8,["label"])):w("",!0),s($)?(u(),g(m,{key:7,label:C.$t("setting.wordpress")+C.$t("setting.blog.setting")},{default:a(()=>[t(ta)]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(m,{key:8,label:C.$t("setting.liandi")+C.$t("setting.blog.setting")},{default:a(()=>[t(Gl)]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(m,{key:9,label:C.$t("setting.yuque")+C.$t("setting.blog.setting")},{default:a(()=>[t(Wl)]),_:1},8,["label"])):w("",!0),s(Y)?(u(),g(m,{key:10,label:C.$t("setting.kms")+C.$t("setting.blog.setting")},{default:a(()=>[t(Jl)]),_:1},8,["label"])):w("",!0),(u(!0),ee(Ie,null,$e(v.githubArray,F=>(u(),g(m,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(ct,{"api-type":F.platformKey,cfg:P.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),ee(Ie,null,$e(v.metaweblogArray,F=>(u(),g(m,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(mt,{"api-type":F.platformKey,cfg:h.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128)),(u(!0),ee(Ie,null,$e(v.wordpressArray,F=>(u(),g(m,{key:F.platformKey,label:F.platformName+C.$t("setting.blog.setting")},{default:a(()=>[t(ta,{"api-type":F.platformKey,cfg:d.value(F)},null,8,["api-type","cfg"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),ee("div",zl,[t(J,{class:"top-version-tip",title:C.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),Xl="custom-slug",Zl="custom-desc",Ae={SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY:Xl,SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY:Zl},Dt={VITE_LOG_INFO_ENABLED:"false",VITE_SIYUAN_API_URL:"http://127.0.0.1:6806",VITE_SIYUAN_CONFIG_TOKEN:"",VITE_MIDDLEWARE_URL:"https://publish.terwer.space/api/middleware"}.TEST==="true",xl="test-data-siyuanPage",eo={CONSTANTS_SIYUAN_PAGE:xl},to=(c,e)=>{const l=_e.getLogger("composables/publish/makeSlugCom.ts"),{t:n}=De(),i=new Oe,b=Ue(),r=ce({isSlugLoading:!1,forceRefresh:!1,title:"",customSlug:"",slugHashEnabled:!0}),k=e.siyuanPageMethods,T=()=>Ne(r.customSlug)?!0:r.forceRefresh;return{slugData:r,slugMethods:{makeSlug:async V=>{if(!T()){V!==!0&&U.warning(n("main.force.refresh.tip")),l.debug(n("main.force.refresh.tip"));return}r.isSlugLoading=!0,l.debug("\u5F00\u59CB\u751F\u6210\u522B\u540D...");try{const $=await k.getPageId();if(Dt){const B=ia(eo.CONSTANTS_SIYUAN_PAGE),v=JSON.parse(JSON.parse(B));vi.spyOn(i,"getBlockByID").mockResolvedValue(v)}const D=await i.getBlockByID($);l.debug("\u83B7\u53D6\u5230\u601D\u6E90\u9875\u9762\u6570\u636E=>",D);const A=r.title;if(b.useGoogleTranslate)try{let B;Dt?B=await vi.fn().mockImplementation(P=>tt(P))(A):B=await Kt(A),l.debug("\u4F7F\u7528\u8C37\u6B4C\u7FFB\u8BD1"),B?r.customSlug=B:(r.customSlug=tt(A),U.success(n("main.opt.failure")))}catch{r.customSlug=tt(A)}else r.customSlug=tt(A);if(l.debug("\u5B8C\u6210\u522B\u540D\u7FFB\u8BD1"),r.slugHashEnabled){const B=D.content+new Date().toISOString(),v=ke("-",zt(B).toLowerCase());r.customSlug+=v,l.debug("\u4E3A\u522B\u540D\u6DFB\u52A0hash")}const Y={[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:r.customSlug};Dt&&vi.spyOn(i,"setBlockAttrs").mockResolvedValue(void 0),await i.setBlockAttrs($,Y),V!==!0&&U.success(n("main.opt.success")),l.info("\u751F\u6210\u522B\u540D\u6B63\u5E38\u5B8C\u6210,slugData=>",r)}catch($){const D=ke(n("main.opt.failure"),"=>",$);V!==!0&&U.error(D),l.error(D)}r.isSlugLoading=!1,l.debug("\u751F\u6210\u522B\u540D\u7ED3\u675F.")},getSlugData:()=>r,initSlug:V=>{let $=V.page.content;b.fixTitle&&($=ra($)),l.debug("\u6807\u9898\u5904\u7406\u5B8C\u6BD5"),r.title=$;const D=Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY;r.customSlug=V.meta[D],l.debug("initSlug=>",r)},syncSlug:V=>{r.title=V.formData.title,r.customSlug=V.formData.customSlug}}}},ao=()=>{const c=_e.getLogger("composables/publish/makeYamlCom.ts"),{t:e}=De(),l=ce({yamlObj:{},readMode:!0,yamlPreviewContent:"",yamlContent:"",isSaved:!0,formatter:"",mdContent:"",mdFullContent:"",htmlContent:""});return{yamlData:l,yamlMethods:{onYamlContentFocus:i=>{i.preventDefault(),i.target.select(),Ma()&&navigator.clipboard.writeText(l.yamlContent).then(function(){U.success(e("main.opt.success"))},function(r){U.error(e("main.opt.failure")+r)})},onYamlContentInput:()=>{l.isSaved=!1},onYamlContextMenu:i=>{i.preventDefault()},doConvertAttrToYAML:(i,b,r)=>{i||(i=new Mt,c.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const k=i.convertToYaml(b,r);l.yamlObj=k.yamlObj,l.formatter=k.formatter,l.mdContent=k.mdContent,l.mdFullContent=k.formatter+`

`+k.mdContent,l.htmlContent=k.htmlContent},doConvertYAMLToAttr:(i,b,r)=>{i||(i=new Mt,c.error("\u672A\u6307\u5B9AYAML\u8F6C\u6362\u5668"));const k=i.convertToAttr(b,r);return c.debug("doConvertYAMLToAttr\u8F6C\u6362\u4E2D\u8F6C\u6570\u636EpostForm=>",k),k},copyYamlToClipboard:()=>{za(l.yamlContent),U.success(e("main.opt.success"))},getYamlData:()=>l,initYaml:i=>{l.yamlContent=i,l.yamlPreviewContent=ke(i)}}}},lo=(c,e)=>{const l=_e.getLogger("composables/publish/publishActionCom.ts"),{t:n}=De(),i=new Oe,b=ce({isPublishLoading:!1,isCancelLoading:!1}),r=e.siyuanPageMethods,k=e.yamlMethods,T=e.githubPagesMethods,y=e.quickMethods,V=e.initPublishMethods,$={doPublish:async()=>{var D;l.debug("\u51C6\u5907\u53D1\u5E03\u6587\u7AE0..."),b.isPublishLoading=!0;try{const A=fe(c.apiType),Y=new Vt(A);if(V.getInitPublishData().isPublished)try{await $.doCancel(!1)}catch(h){l.error("\u5F3A\u5236\u5220\u9664\u5F02\u5E38\uFF0C\u4E0D\u5F71\u54CD\u53D1\u5E03=>",h)}const B=T.getGithubPagesData().mdTitle;let v=Ot(B);if(v=v.replace(/\.md/g,""),/[\s*|\\.]/g.test(v)){l.debug("fmtTitle=>",v),U.error("\u6587\u4EF6\u540D\u4E0D\u80FD\u5305\u542B\u7A7A\u683C\u6216\u8005\u7279\u6B8A\u5B57\u7B26"),b.isPublishLoading=!1;return}V.getInitPublishData().isPublished?await y.saveAttrToSiyuan(!0):y.getQuickData().onclickFlag?await y.saveAttrToSiyuan(!0):await y.doOneclickAttr();const P=A.apiStatus;if(!P&&T.getGithubPagesData().githubEnabled){b.isPublishLoading=!1,U.error("\u68C0\u6D4B\u5230api\u4E0D\u53EF\u7528\u6216\u8005\u914D\u7F6E\u9519\u8BEF\uFF0C\u65E0\u6CD5\u53D1\u5E03\u5230Github\uFF0C\u8BF7\u8F6C\u5230\u6E90\u7801\u6A21\u5F0F\u81EA\u884C\u590D\u5236\u6587\u672C");return}else if(P&&T.getGithubPagesData().githubEnabled){l.debug("\u5F00\u59CB\u771F\u6B63\u8C03\u7528api\u53D1\u5E03\u5230Github");let h=T.getGithubPagesData().customPath;const d=(D=A.defaultPath)!=null?D:"\u5C1A\u672A\u914D\u7F6E",p=T.getGithubPagesData().mdTitle;T.initGithubPages({cpath:h,defpath:d,fname:p}),V.convertAttrToYAML(!0);const o=k.getYamlData().mdFullContent;l.debug("\u5373\u5C06\u53D1\u5E03\u7684\u5185\u5BB9\uFF0CmdContent=>",{mdFullContent:o});const C=T.getGithubPagesData().publishPath;if(!await Y.publishGithubPage(C,o)){b.isPublishLoading=!1,U.error(n("main.publish.vuepress.failure"));return}const m={[A.posidKey]:C},M=await r.getPageId();await i.setBlockAttrs(M,m),l.debug("VuepressMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58\u8DEF\u5F84,meta=>",m),await V.initPage(),b.isPublishLoading=!1}l.debug("\u6587\u7AE0\u53D1\u5E03\u5B8C\u6210."),V.getInitPublishData().isPublished?U.success(n("main.opt.status.updated")):U.success(n("main.opt.status.publish"))}catch(A){const Y=ke(n("main.opt.failure"),"=>",A);U.error(Y),l.error(Y)}b.isPublishLoading=!1},cancelPublish:async()=>{l.debug("\u51C6\u5907\u53D6\u6D88\u6587\u7AE0\u53D1\u5E03..."),b.isCancelLoading=!0,Xe.confirm(n("main.opt.warning.tip"),n("main.opt.warning"),{confirmButtonText:n("main.opt.ok"),cancelButtonText:n("main.opt.cancel"),type:"warning"}).then(async()=>{await $.doCancel(!0),b.isCancelLoading=!1,U.warning(n("main.opt.status.cancel"))}).catch(D=>{D.toString().indexOf("cancel")<=-1&&(U({type:"error",message:n("main.opt.failure")+"=>"+D}),l.error(n("main.opt.failure")+"=>"+D)),b.isCancelLoading=!1})},doCancel:async D=>{const A=fe(c.apiType),Y=new Vt(A),B=T.getGithubPagesData().publishPath;l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0CdocPath=>",B),await Y.deleteGithubPage(B);const v={[A.posidKey]:""},P=await r.getPageId();await i.setBlockAttrs(P,v),l.debug(c.apiType+"_Main\u53D6\u6D88\u53D1\u5E03,meta=>",v),D&&await V.initPage()}};return{publishData:b,publishMethods:$}},oo=(c,e)=>{const l=_e.getLogger("composables/publish/publishQuickCom.ts"),{t:n}=De(),i=new Oe,b=ce({isGenLoading:!1,onclickFlag:!1}),r=e.siyuanPageMethods,k=e.slugMethods,T=e.descMethods,y=e.tagMethods,V={oneclickAttr:async $=>{Xe.confirm(n("main.opt.onclick.confirm.tip"),n("main.opt.warning"),{confirmButtonText:n("main.opt.ok"),cancelButtonText:n("main.opt.cancel"),type:"warning"}).then(async()=>{b.isGenLoading=!0,await V.doOneclickAttr(),b.isGenLoading=!1,l.debug("\u4E00\u952E\u751F\u6210\u5C5E\u6027\u5B8C\u6210."),$!==!0&&U.success(n("main.publish.oneclick.attr.finish"))}).catch(D=>{b.isGenLoading=!1,D.toString().indexOf("cancel")<=-1&&(U({type:"error",message:n("main.opt.failure")+"=>"+D}),l.error(n("main.opt.failure")+"=>"+D))})},doOneclickAttr:async()=>{await k.makeSlug(!0),await T.makeDesc(!0),await y.fetchTag(!0),await V.saveAttrToSiyuan(!0),b.onclickFlag=!0,l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210")},saveAttrToSiyuan:async $=>{try{const D=k.getSlugData(),A=T.getDescData(),Y=y.getTagData(),B={[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:D.customSlug,[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:A.desc,tags:Y.join(",")},v=await r.getPageId();await i.setBlockAttrs(v,B),$!==!0&&U.success(n("main.opt.success"))}catch(D){const A=ke(n("main.opt.failure"),"=>",D);$!==!0&&U.error(ke(n("main.opt.failure"),"=>",D)),l.error(A)}},getQuickData:()=>b};return{quickData:b,quickMethods:V}},so=(c,e)=>{const l=_e.getLogger("composables/publish/makeDescCom.ts"),{t:n}=De(),i=new Oe,b=ce({isDescLoading:!1,desc:""}),r=e.siyuanPageMethods;return{descData:b,descMethods:{makeDesc:async T=>{l.debug("\u51C6\u5907\u751F\u6210\u6458\u8981..."),b.isDescLoading=!0;try{const y=Ue(),V=await r.getPageId(),D=(await i.exportMdContent(V)).content;let A=_t(D);y.removeH1&&(A=vt(A)),b.desc=Rt(A,Lt.MAX_PREVIEW_LENGTH,!0);const Y={[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:b.desc};await i.setBlockAttrs(V,Y),T!==!0&&U.success(n("main.opt.success"))}catch(y){T!==!0&&U.error(ke(n("main.opt.failure"),"=>",y))}b.isDescLoading=!1,l.debug("\u6458\u8981\u751F\u6210\u5B8C\u6BD5.")},getDescData:()=>b,initDesc:T=>{const y=Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY;b.desc=T.meta[y]},syncDesc:T=>{b.desc=T.formData.desc}}}},no=()=>{const c=ce({created:""});return{publishTimeData:c,publishTimeMethods:{getPublishTime:()=>c,initPublishTime:l=>{c.created=Nt(l.page.created)},syncPublishTime:l=>{c.created=l.formData.created}}}};class uo{constructor(){ie(this,"pageId");ie(this,"meta");ie(this,"page");ie(this,"content")}}const ma=c=>{const e=_e.getLogger("composables/publish/siyuanPageCom.ts"),{t:l}=De(),n=new Oe,i=ce({dataObj:new uo});return{siyuanPageData:i,siyuanPageMethods:{getPageId:async()=>{const r=await rt(!0,c.pageId);if(!r||r==="")throw e.error(l("page.no.id")),new Error("page.no.id");return e.debug("\u5F53\u524D\u9875\u9762ID\u4E3A=>",r),r},getSiyuanPageData:()=>i,initSiyuanPage:async r=>{i.dataObj.pageId=r,i.dataObj.meta=await n.getBlockAttrs(r),i.dataObj.page=await n.getBlockByID(r),i.dataObj.content=await n.exportMdContent(r)}}}},io=c=>{const e=_e.getLogger("composables/publish/makeTagCom.ts"),{t:l}=De(),n=new Oe,i=ce({isTagLoading:!1,tagSwitch:!1,tag:{inputValue:"",dynamicTags:[],inputVisible:!1}}),{siyuanPageMethods:b}=ma(c);return{tagData:i,tagMethods:{tagHandleClose:k=>{i.tag.dynamicTags.splice(i.tag.dynamicTags.indexOf(k),1)},tagShowInput:()=>{i.tag.inputVisible=!0},tagHandleInputConfirm:()=>{i.tag.inputValue&&i.tag.dynamicTags.push(i.tag.inputValue),i.tag.inputVisible=!1,i.tag.inputValue=""},fetchTag:async k=>{try{if(!i.tagSwitch){U.warning(l("main.tag.auto.switch.no.tip"));return}i.isTagLoading=!0;const T=await b.getPageId(),V=(await n.exportMdContent(T)).content,$=await Ht(V);e.debug("genTags=>",$);const D=Gt($,5);e.debug("hotTags=>",D);for(let Y=0;Y<D.length;Y++)i.tag.dynamicTags.includes(D[Y])||i.tag.dynamicTags.push(D[Y]);const A={tags:i.tag.dynamicTags.join(",")};await n.setBlockAttrs(T,A),k!==!0&&U.success(l("main.opt.success"))}catch(T){const y=ke(l("main.opt.failure"),"=>",T);k!==!0&&U.error(y),e.error(y)}i.isTagLoading=!1,k!==!0&&U.success(l("main.opt.success"))},getTagData:()=>i.tag.dynamicTags,initTag:k=>{const T=Ue();i.tag.dynamicTags=[];const V=(k.meta.tags||"").split(",");for(let $=0;$<V.length;$++)V[$]!==""&&i.tag.dynamicTags.push(V[$]);T.autoTag&&i.tag.dynamicTags.length===0&&(i.tagSwitch=!0)},syncTag:k=>{for(let T=0;T<k.formData.tag.dynamicTags.length;T++){const y=k.formData.tag.dynamicTags[T];!i.tag.dynamicTags.includes(y)&&y!==""&&i.tag.dynamicTags.push(y)}}}}},ro=(c,e)=>{const l=_e.getLogger("composables/publish/githubPagesCom.ts"),n=ce({githubEnabled:!1,useDefaultPath:!1,currentDefaultPath:"",customPath:"",mdTitle:"",path:{customProps:{label:"label",children:"children",isLeaf:"isLeaf"}},publishPath:""}),i=e.siyuanPageMethods,b=e.slugMethods,r={githubOnChange:k=>{n.githubEnabled=k},defaultPathOnChange:k=>{var T;if(n.useDefaultPath=k,k==!0){const y=fe(c.apiType);r.initGithubPages({cpath:(T=y.defaultPath)!=null?T:"",defpath:n.currentDefaultPath,fname:n.mdTitle})}},customLoad:async(k,T)=>{if(k.isLeaf)return T([]);l.debug("\u76EE\u524D\u5DF2\u4FDD\u5B58\u8DEF\u5F84=>",n.customPath),l.debug("\u5F53\u524D\u8282\u70B9=>",k.data);const y=fe(c.apiType),V=new Vt(y);let $,D=k.data.value||"";D===""&&n.customPath!==""?$="":(D===""&&(D=""),$=D);const A=await V.getGithubPageTreeNode($);T(A)},onSelectChange:k=>{if(l.debug("onSelectChange=>",k),k.isLeaf){U.error("\u60A8\u5F53\u524D\u9009\u62E9\u7684\u662F\u9875\u9762\uFF0C\u8BF7\u6CE8\u610F\uFF0C\u9875\u9762\u5FC5\u987B\u53D1\u5E03\u5728\u76EE\u5F55\u4E0B");return}r.initGithubPages({cpath:k.value,defpath:n.currentDefaultPath,fname:n.mdTitle})},getGithubPagesData:()=>n,getDocPath:()=>{const k=Va(c.apiType).posidKey;return i.getSiyuanPageData().dataObj.meta[k]||""},getMdFilename:()=>{var A,Y,B;const k=fe(c.apiType),T=b.getSlugData(),y=i.getSiyuanPageData().dataObj,V=k.mdFilenameRule;let $;const D="[dynamic-generated-on-publish]";if(Ne(V))$=(Y=(A=y.page.content)!=null?A:T.customSlug)!=null?Y:D;else{$=V,V.indexOf("filename")>-1&&($=$.replace(/\[filename]/g,y.page.content)),V.indexOf("slug")>-1&&($=$.replace(/\[slug]/g,(B=T.customSlug)!=null?B:D));let v=new Date;if(V.indexOf("yyyy")>-1){const P=v.getFullYear();$=$.replace(/\[yyyy]/g,P.toString())}if(V.indexOf("MM")>-1||V.indexOf("mm")>-1){let P,h=v.getMonth()+1;P=h.toString(),h<10&&(P=ke("0",P)),$=$.replace(/\[MM]/g,P),$=$.replace(/\[mm]/g,P)}if(V.indexOf("dd")>-1){let P,h=v.getDate();P=h.toString(),h<10&&(P=ke("0",P)),$=$.replace(/\[dd]/g,P)}}return $},initGithubPages:k=>{let T,y,V;k&&(T=k.cpath,y=k.defpath,V=k.fname),l.debug("paths=>",k),n.customPath=T,n.currentDefaultPath=y,n.mdTitle=V.indexOf(".md")>-1?V:V+".md",n.customPath.indexOf(".md")>-1?n.publishPath=n.customPath:n.publishPath=ze(n.customPath,"/"+n.mdTitle)}};return{githubPagesData:n,githubPagesMethods:r}},po=(c,e,l)=>{const n=_e.getLogger("composables/publish/initPublishCom.ts"),{t:i}=De(),b=ce({isInitLoading:!1,apiStatus:!1,apiTypeInfo:_(ke(i("setting.blog.platform.support.github"),c.apiType)),isPublished:!1,previewMdUrl:"",previewUrl:"",mdStatusUrl:""}),r=e.pageModeMethods,k=e.siyuanPageMethods,T=e.slugMethods,y=e.descMethods,V=e.publishTimeMethods,$=e.tagMethods,D=e.githubPagesMethods,A=e.yamlMethods,Y=e.quickMethods,B={onEditModeChange:v=>{const P=r.getPageModeData();v===pe.EditMode_source?(B.convertAttrToYAML(!0),P.etype=v):A.getYamlData().isSaved?P.etype=v:Xe.confirm(i("main.yaml.no.save"),i("main.opt.warning"),{confirmButtonText:i("main.opt.ok"),cancelButtonText:i("main.opt.cancel"),type:"warning"}).then(async()=>{B.convertYAMLToAttr(!0),P.etype=v}).catch(()=>{P.etype=v})},onYamlShowTypeChange:v=>{const P=r.getPageModeData();switch(P.stype=v,v){case Ve.YAML:A.initYaml(A.getYamlData().formatter);break;case Ve.CONTENT:A.initYaml(A.getYamlData().mdContent);break;case Ve.YAML_CONTENT:A.initYaml(A.getYamlData().mdFullContent);break;case Ve.HTML_CONTENT:A.initYaml(A.getYamlData().htmlContent);break}},convertDocPathToCategories:v=>{const P=Ue();n.debug("docPath=>",v);const h=v.split("/");let d=[];if(h.length>1)for(let p=1;p<h.length-1;p++){let o;P.fixTitle?o=ra(h[p]):o=h[p],d.push(o)}return d},composableDataToForm:()=>{const v=Ue(),P=new Ia;P.formData.title=T.getSlugData().title,P.formData.customSlug=T.getSlugData().customSlug,P.formData.desc=y.getDescData().desc,P.formData.created=V.getPublishTime().created,P.formData.tag.dynamicTags=$.getTagData();const h=D.getGithubPagesData().customPath;P.formData.categories=B.convertDocPathToCategories(h);let d=k.getSiyuanPageData().dataObj.content.content,p=_t(d);return d=jt(d),v.removeH1&&(d=Wt(d),p=vt(p)),P.formData.mdContent=d,P.formData.htmlContent=p,P},convertAttrToYAML:v=>{const P=Ue(),h=fe(c.apiType),d=B.composableDataToForm();A.doConvertAttrToYAML(c.yamlConverter,d,h),B.onYamlShowTypeChange(P.contentShowType),v!==!0&&U.success(i("main.opt.success"))},formToComposableData:v=>{T.syncSlug(v),y.syncDesc(v),V.syncPublishTime(v),$.syncTag(v)},convertYAMLToAttr:v=>{if(r.getPageModeData().stype!==Ve.YAML){const P="\u53EA\u80FD\u8F6C\u6362YAML\uFF0C\u8BF7\u5207\u6362\u663E\u793A\u6A21\u5F0F";throw U.error(P),A.getYamlData().isSaved=!0,new Error(P)}try{const P=fe(c.apiType),h=A.getYamlData().yamlContent,d=Aa(h),p=new $a;p.yamlObj=d,n.debug("\u51C6\u5907\u5C06YAML\u8F6C\u6362\u4E3A\u6587\u7AE0\u5C5E\u6027\uFF0CyamlFormatObj=>",p);const o=A.doConvertYAMLToAttr(c.yamlConverter,p,P);B.formToComposableData(o),A.getYamlData().isSaved=!0,v!==!0&&U.success(i("main.opt.success"))}catch(P){v!==!0&&U.error(ke(i("main.opt.failure"),"=>",P))}},saveAttrToSiyuanWithInit:async()=>{await Y.saveAttrToSiyuan(!0),await B.initPage(!0),U.success(i("main.opt.success"))},getInitPublishData:()=>b,initPage:async v=>{var P,h,d,p,o;b.isInitLoading=v!=!0;try{const C=Ue(),f=r.getPageModeData();f.etype=C.editMode,f.stype=C.contentShowType;const m=fe(c.apiType);b.apiStatus=m.apiStatus;const M=await rt(!0,c.pageId);if(!M||M===""){b.isInitLoading=!1,n.error(i("page.no.id")),U.error(i("page.no.id"));return}await k.initSiyuanPage(M);const J=k.getSiyuanPageData().dataObj;b.isPublished=qt(c.apiType,k.getSiyuanPageData().dataObj.meta),T.initSlug(J),y.initDesc(J),V.initPublishTime(J),$.initTag(J);const F=D.getGithubPagesData();F.githubEnabled=b.apiStatus;let E;b.isPublished?(F.useDefaultPath=!1,E=D.getDocPath()):E=(P=m.defaultPath)!=null?P:"";const I=(h=m.defaultPath)!=null?h:"\u5C1A\u672A\u914D\u7F6E",K=D.getMdFilename();if(D.initGithubPages({cpath:E,defpath:I,fname:K}),B.convertAttrToYAML(!0),b.isPublished){const G=(d=m.baseUrl)!=null?d:"https://terwer.space/",se=(p=m.home)!=null?p:"https://terwer.space/";let Q;Q=ze(m.githubUser,"/"+m.githubRepo),Q=ze(Q,"/blob/"),Q=ze(Q,"/"+m.defaultBranch),Q=ze(Q,"/"+E),Ne(m.previewMdUrl)||(Q=m.previewMdUrl,Q=Q.replace(/\[user]/,m.githubUser),Q=Q.replace(/\[repo]/,m.githubRepo),Q=Q.replace(/\[branch]/,m.defaultBranch),Q=Q.replace(/\[docpath]/,E)),Q=ze(G,Q),b.previewMdUrl=Q,b.mdStatusUrl=ke("https://img.shields.io/github/checks-status/",m.githubUser,"/",m.githubRepo,"/",m.defaultBranch,"?label=build");let H=A.getYamlData().yamlObj.permalink;if(!Ne(m.previewUrl))if(m.previewUrl.indexOf("[docpath]")>-1){const re=(o=m.defaultPath)!=null?o:"docs",X=E.replace(re,"").replace(".md","");H=m.previewUrl.replace("/[docpath]",X)}else{H=m.previewUrl.replace(/\[postid]/g,T.getSlugData().customSlug);const Me=V.getPublishTime().created.split(" ")[0].split("-");n.debug("created numarr=>",Me);const We=Me[0],W=Me[1],et=Me[2];H=H.replace(/\[yyyy]/g,We),H=H.replace(/\[MM]/g,W),H=H.replace(/\[mm]/g,W),H=H.replace(/\[dd]/g,et);const R=D.getGithubPagesData().publishPath,z=B.convertDocPathToCategories(R);z.length>0?H=H.replace(/\[cats]/,z.join("/")):H=H.replace(/\/\[cats]/,"")}b.previewUrl=ze(se,H)}}catch(C){const f=ke(i("main.opt.failure"),"=>",C);n.error(f)}b.isInitLoading=!1}};return{initPublishData:b,initPublishMethods:B}},co=()=>{const c=ce({etype:pe.EditMode_simple,stype:Ve.YAML_CONTENT});return{pageModeData:c,pageModeMethods:{getPageModeData:()=>c}}},mo={class:"github-tips"},go={class:"github-form"},fo={key:0,class:"form-post-title"},yo={class:"form-edit-mode"},bo={key:1,class:"normal-mode"},ho={key:0,class:"form-slug"},_o={class:"form-desc"},vo={class:"form-publish-time"},Co={class:"form-tags"},wo={class:"form-github-pages"},Eo={key:0,class:"form-github-pages-items"},To={key:2,class:"convert-option"},So={key:3,class:"publish-action"},ko={key:4,class:"publish-status"},Do=["href","title"],Po=["src"],Mo=["href","title"],Vo={key:5,class:"source-mode"},Ao={class:"source-opt"},$o={key:1,id:"yaml-detail-content"},Io={key:2,id:"yaml-edit-content"},Fo={key:3,id:"yaml-action"},Bo={id:"yaml-read-mode-tip"},Uo=te({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0},yamlConverter:{type:Mt}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/main/GithubMain.vue"),{pageModeData:n,pageModeMethods:i}=co(),{siyuanPageMethods:b}=ma(e),{slugData:r,slugMethods:k}=to(e,{siyuanPageMethods:b}),{descData:T,descMethods:y}=so(e,{siyuanPageMethods:b}),{publishTimeData:V,publishTimeMethods:$}=no(),{tagData:D,tagMethods:A}=io(e),{githubPagesData:Y,githubPagesMethods:B}=ro(e,{siyuanPageMethods:b,slugMethods:k}),{yamlData:v,yamlMethods:P}=ao(),{quickData:h,quickMethods:d}=oo(e,{siyuanPageMethods:b,slugMethods:k,descMethods:y,tagMethods:A}),{initPublishData:p,initPublishMethods:o}=po(e,{pageModeMethods:i,siyuanPageMethods:b,slugMethods:k,descMethods:y,publishTimeMethods:$,tagMethods:A,githubPagesMethods:B,yamlMethods:P,quickMethods:d}),{publishData:C,publishMethods:f}=lo(e,{siyuanPageMethods:b,yamlMethods:P,githubPagesMethods:B,quickMethods:d,initPublishMethods:o});return Re(()=>e.isReload,async()=>{await o.initPage(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await o.initPage(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),Ke(async()=>{await o.initPage()}),(m,M)=>{const J=Ye,F=Je,E=Ge,I=qe,K=ut,G=it,se=It,Q=Ft,H=oa,re=je,X=bt,Me=ht,We=Bt;return u(),ee("div",null,[s(p).isInitLoading?w("",!0):(u(),g(Me,{key:0},{default:a(()=>[t(X,{class:"github-main"},{default:a(()=>[be("div",mo,[s(n).etype!==s(pe).EditMode_source?(u(),g(J,{key:0,closable:!1,title:s(p).apiTypeInfo,class:"top-version-tip",type:"info"},null,8,["title"])):w("",!0),!s(p).apiStatus&&s(n).etype!==s(pe).EditMode_source?(u(),g(J,{key:1,closable:!1,title:m.$t("main.publish.github.error.tip"),class:"top-version-tip",type:"error"},null,8,["title"])):w("",!0)]),be("div",go,[t(re,{"label-width":"100px"},{default:a(()=>[s(n).etype!==s(pe).EditMode_source?(u(),ee("div",fo,[t(E,{label:m.$t("main.title")},{default:a(()=>[t(F,{modelValue:s(r).title,"onUpdate:modelValue":M[0]||(M[0]=W=>s(r).title=W),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])])):w("",!0),be("div",yo,[t(E,{label:m.$t("main.publish.editmode")},{default:a(()=>[t(K,null,{default:a(()=>[t(I,{type:s(n).etype===s(pe).EditMode_simple?"primary":"default",onClick:M[1]||(M[1]=W=>s(o).onEditModeChange(s(pe).EditMode_simple))},{default:a(()=>[N(L(m.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(I,{type:s(n).etype===s(pe).EditMode_complex?"primary":"default",onClick:M[2]||(M[2]=W=>s(o).onEditModeChange(s(pe).EditMode_complex))},{default:a(()=>[N(L(m.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"]),t(I,{type:s(n).etype===s(pe).EditMode_source?"primary":"default",onClick:M[3]||(M[3]=W=>s(o).onEditModeChange(s(pe).EditMode_source))},{default:a(()=>[N(L(m.$t("main.publish.editmode.source")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"])]),s(n).etype!==s(pe).EditMode_source?(u(),ee("div",bo,[s(n).etype!==s(pe).EditMode_simple?(u(),ee("div",ho,[t(E,{label:m.$t("main.force.refresh")},{default:a(()=>[t(G,{modelValue:s(r).forceRefresh,"onUpdate:modelValue":M[4]||(M[4]=W=>s(r).forceRefresh=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(E,{label:m.$t("main.use.hash")},{default:a(()=>[t(G,{modelValue:s(r).slugHashEnabled,"onUpdate:modelValue":M[5]||(M[5]=W=>s(r).slugHashEnabled=W)},null,8,["modelValue"]),s(r).slugHashEnabled?w("",!0):(u(),g(J,{key:0,closable:!1,title:m.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),t(E,{label:m.$t("main.slug")},{default:a(()=>[t(F,{modelValue:s(r).customSlug,"onUpdate:modelValue":M[6]||(M[6]=W=>s(r).customSlug=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(E,null,{default:a(()=>[t(I,{loading:s(r).isSlugLoading,class:"make-slug-btn",type:"primary",onClick:s(k).makeSlug},{default:a(()=>[N(L(s(r).isSlugLoading?m.$t("main.opt.loading"):m.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading","onClick"])]),_:1})])):w("",!0),be("div",_o,[s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:0,label:m.$t("main.desc")},{default:a(()=>[t(F,{modelValue:s(T).desc,"onUpdate:modelValue":M[7]||(M[7]=W=>s(T).desc=W),autosize:{minRows:3,maxRows:16},type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:1},{default:a(()=>[t(I,{loading:s(T).isDescLoading,type:"primary",onClick:s(y).makeDesc},{default:a(()=>[N(L(s(T).isDescLoading?m.$t("main.opt.loading"):m.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading","onClick"])]),_:1})):w("",!0)]),be("div",vo,[s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:0,label:m.$t("main.create.time")},{default:a(()=>[t(se,{modelValue:s(V).created,"onUpdate:modelValue":M[8]||(M[8]=W=>s(V).created=W),placeholder:m.$t("main.create.time.placeholder"),format:"YYYY-MM-DD HH:mm:ss",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0)]),be("div",Co,[t(E,{label:m.$t("main.tag.auto.switch")},{default:a(()=>[t(G,{modelValue:s(D).tagSwitch,"onUpdate:modelValue":M[9]||(M[9]=W=>s(D).tagSwitch=W)},null,8,["modelValue"])]),_:1},8,["label"]),t(E,{label:m.$t("main.tag")},{default:a(()=>[(u(!0),ee(Ie,null,$e(s(D).tag.dynamicTags,W=>(u(),g(Q,{key:W,"disable-transitions":!1,class:"mx-1",closable:"",onClose:et=>s(A).tagHandleClose(W)},{default:a(()=>[N(L(W),1)]),_:2},1032,["onClose"]))),128)),s(D).tag.inputVisible?(u(),g(F,{key:0,ref:"tagRefInput",modelValue:s(D).tag.inputValue,"onUpdate:modelValue":M[10]||(M[10]=W=>s(D).tag.inputValue=W),class:"ml-1 w-20",size:"small",onBlur:s(A).tagHandleInputConfirm,onKeyup:Jt(s(A).tagHandleInputConfirm,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(u(),g(I,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:s(A).tagShowInput},{default:a(()=>[N(L(m.$t("main.tag.new")),1)]),_:1},8,["onClick"]))]),_:1},8,["label"]),s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:0},{default:a(()=>[t(I,{loading:s(D).isTagLoading,type:"primary",onClick:s(A).fetchTag},{default:a(()=>[N(L(s(D).isTagLoading?m.$t("main.opt.loading"):m.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading","onClick"])]),_:1})):w("",!0)]),be("div",wo,[t(E,{label:m.$t("main.publish.github")},{default:a(()=>[t(G,{modelValue:s(Y).githubEnabled,"onUpdate:modelValue":M[11]||(M[11]=W=>s(Y).githubEnabled=W),onChange:s(B).githubOnChange},null,8,["modelValue","onChange"]),s(Y).githubEnabled?w("",!0):(u(),g(J,{key:0,closable:!1,title:m.$t("main.publish.github.no.tip"),type:"warning"},null,8,["title"]))]),_:1},8,["label"]),s(Y).githubEnabled?(u(),ee("div",Eo,[s(p).isPublished?w("",!0):(u(),g(E,{key:0,label:m.$t("main.publish.github.choose.path.use.default")},{default:a(()=>[t(G,{modelValue:s(Y).useDefaultPath,"onUpdate:modelValue":M[12]||(M[12]=W=>s(Y).useDefaultPath=W),onChange:s(B).defaultPathOnChange},null,8,["modelValue","onChange"]),s(Y).useDefaultPath?(u(),g(J,{key:0,closable:!1,title:m.$t("main.publish.github.choose.path.use.default.tip")+s(Y).currentDefaultPath,type:"info"},null,8,["title"])):w("",!0)]),_:1},8,["label"])),!s(Y).useDefaultPath&&!s(p).isPublished?(u(),g(E,{key:1,label:m.$t("main.publish.github.choose.path")},{default:a(()=>[t(H,{modelValue:s(Y).customPath,"onUpdate:modelValue":M[13]||(M[13]=W=>s(Y).customPath=W),"check-strictly":!0,"empty-text":m.$t("main.cat.empty"),load:s(B).customLoad,"no-data-text":m.$t("main.cat.empty"),placeholder:m.$t("main.cat.select"),props:s(Y).path.customProps,lazy:"",style:{width:"100%"},onNodeClick:s(B).onSelectChange},null,8,["modelValue","empty-text","load","no-data-text","placeholder","props","onNodeClick"])]),_:1},8,["label"])):w("",!0),s(p).isPublished?w("",!0):(u(),g(E,{key:2,label:m.$t("main.publish.github.choose.title")},{default:a(()=>[t(F,{modelValue:s(Y).mdTitle,"onUpdate:modelValue":M[14]||(M[14]=W=>s(Y).mdTitle=W)},null,8,["modelValue"])]),_:1},8,["label"])),t(E,{label:m.$t("main.publish.github.published.path")},{default:a(()=>[t(F,{modelValue:s(Y).publishPath,"onUpdate:modelValue":M[15]||(M[15]=W=>s(Y).publishPath=W),disabled:s(p).isPublished},null,8,["modelValue","disabled"])]),_:1},8,["label"])])):w("",!0)])])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),ee("div",To,[t(E,{label:m.$t("main.opt.quick")},{default:a(()=>[t(I,{loading:s(h).isGenLoading,type:"primary",onClick:s(d).oneclickAttr},{default:a(()=>[N(L(s(h).isGenLoading?m.$t("main.opt.loading"):m.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["label"]),s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:0},{default:a(()=>[t(I,{type:"primary",onClick:s(o).saveAttrToSiyuanWithInit},{default:a(()=>[N(L(m.$t("main.save.attr.to.siyuan")),1)]),_:1},8,["onClick"])]),_:1})):w("",!0),s(n).etype!==s(pe).EditMode_simple?(u(),g(E,{key:1},{default:a(()=>[t(I,{type:"primary",onClick:M[16]||(M[16]=W=>s(o).onEditModeChange(s(pe).EditMode_source))},{default:a(()=>[N(L(m.$t("main.siyuan.to.yaml")),1)]),_:1})]),_:1})):w("",!0)])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),ee("div",So,[t(E,null,{default:a(()=>[t(I,{loading:s(C).isPublishLoading,type:"primary",onClick:s(f).doPublish},{default:a(()=>[N(L(s(C).isPublishLoading?m.$t("main.publish.loading"):s(p).isPublished?m.$t("main.update"):m.$t("main.publish")),1)]),_:1},8,["loading","onClick"]),s(p).isPublished?(u(),g(I,{key:0,loading:s(C).isCancelLoading,onClick:s(f).cancelPublish},{default:a(()=>[N(L(m.$t("main.cancel")),1)]),_:1},8,["loading","onClick"])):w("",!0)]),_:1})])):w("",!0),s(n).etype!==s(pe).EditMode_source?(u(),ee("div",ko,[t(E,{class:"publish-status-box"},{default:a(()=>[t(I,{class:"publish-text-btn",disabled:"",text:"",type:"danger"},{default:a(()=>[N(L(s(p).isPublished?m.$t("main.publish.status.published"):m.$t("main.publish.status.unpublish")),1)]),_:1}),s(p).isPublished?(u(),ee("a",{key:0,href:s(p).previewMdUrl,title:s(p).previewMdUrl,target:"_blank"},L(m.$t("main.publish.see.md.preview")),9,Do)):w("",!0)]),_:1}),s(p).isPublished?(u(),g(E,{key:0,class:"publish-status-box"},{default:a(()=>[be("img",{src:s(p).mdStatusUrl,alt:"md-build-status",class:"publish-build-status-icon"},null,8,Po),be("a",{href:s(p).previewUrl,title:s(p).previewUrl,target:"_blank"},L(m.$t("main.publish.see.real.preview")),9,Mo)]),_:1})):w("",!0)])):w("",!0),s(n).etype===s(pe).EditMode_source?(u(),ee("div",Vo,[t(E,null,{default:a(()=>[t(J,{closable:!1,title:s(Fa)(e.apiType)+" "+m.$t("main.yaml.formatter"),class:"top-yaml-tip",type:"info"},null,8,["title"])]),_:1}),s(n).etype.toString()!==s(pe).EditMode_simple.toString()?(u(),g(E,{key:0,label:s(v).readMode?m.$t("main.read.mode"):m.$t("main.edit.mode")},{default:a(()=>[t(G,{modelValue:s(v).readMode,"onUpdate:modelValue":M[17]||(M[17]=W=>s(v).readMode=W)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),be("div",Ao,[t(E,null,{default:a(()=>[be("a",{class:yt({current:s(n).stype===s(Ve).YAML}),onClick:M[18]||(M[18]=W=>s(o).onYamlShowTypeChange(s(Ve).YAML))},L(m.$t("yaml.show.type.yaml")),3),be("a",{class:yt({current:s(n).stype===s(Ve).CONTENT,middle:!0}),onClick:M[19]||(M[19]=W=>s(o).onYamlShowTypeChange(s(Ve).CONTENT))},L(m.$t("yaml.show.type.md")),3),be("a",{class:yt({current:s(n).stype===s(Ve).YAML_CONTENT,middle:!0}),onClick:M[20]||(M[20]=W=>s(o).onYamlShowTypeChange(s(Ve).YAML_CONTENT))},L(m.$t("yaml.show.type.yamlmd")),3),be("a",{class:yt({current:s(n).stype===s(Ve).HTML_CONTENT}),onClick:M[21]||(M[21]=W=>s(o).onYamlShowTypeChange(s(Ve).HTML_CONTENT))},L(m.$t("yaml.show.type.html")),3)]),_:1})]),s(v).readMode?(u(),ee("div",$o,[t(E,null,{default:a(()=>[t(F,{id:"yaml-detail-preview",modelValue:s(v).yamlPreviewContent,"onUpdate:modelValue":M[22]||(M[22]=W=>s(v).yamlPreviewContent=W),autosize:{minRows:4,maxRows:16},readonly:"",type:"textarea",onClick:s(P).onYamlContentFocus,onContextmenu:s(P).onYamlContextMenu},null,8,["modelValue","onClick","onContextmenu"])]),_:1})])):w("",!0),s(v).readMode?w("",!0):(u(),ee("div",Io,[t(E,null,{default:a(()=>[t(F,{modelValue:s(v).yamlContent,"onUpdate:modelValue":M[23]||(M[23]=W=>s(v).yamlContent=W),autosize:{minRows:4,maxRows:16},type:"textarea",onInput:s(P).onYamlContentInput},null,8,["modelValue","onInput"])]),_:1})])),s(v).readMode?w("",!0):(u(),ee("div",Fo,[t(E,null,{default:a(()=>[t(I,{type:"primary",onClick:s(o).convertYAMLToAttr},{default:a(()=>[N(L(m.$t("main.yaml.to.siyuan")),1)]),_:1},8,["onClick"]),t(I,{type:"primary",onClick:M[24]||(M[24]=W=>s(P).copyYamlToClipboard())},{default:a(()=>[N(L(m.$t("main.copy")),1)]),_:1})]),_:1})])),be("div",Bo,[t(E,null,{default:a(()=>[t(J,{closable:!1,title:m.$t("main.read.mode.tip"),type:"info"},null,8,["title"])]),_:1})])])):w("",!0)]),_:1})])]),_:1})]),_:1})),t(We,{loading:s(p).isInitLoading,rows:5,animated:""},null,8,["loading"])])}}});const ft=Ze(Uo,[["__scopeId","data-v-edb118dc"]]),Yo=te({__name:"VuepressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_VUEPRESS),n=new Ba,i=_(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":l.value,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Ko=te({__name:"HugoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_HUGO),n=new Ua,i=_(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"is-main-reload":e.isMainReload,"api-type":l.value,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Oo=te({__name:"HexoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_HEXO),n=new Ya,i=_(n);return(b,r)=>(u(),g(ft,{"api-type":l.value,"is-reload":e.isReload,"is-main-reload":e.isMainReload,"page-id":e.pageId,"yaml-converter":i.value},null,8,["api-type","is-reload","is-main-reload","page-id","yaml-converter"]))}}),Ro=te({__name:"JekyllMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_JEKYLL),n=new Ka,i=_(n);return(b,r)=>(u(),g(ft,{"is-reload":e.isReload,"api-type":l.value,"is-main-reload":e.isMainReload,"page-id":e.pageId,"yaml-converter":i.value},null,8,["is-reload","api-type","is-main-reload","page-id","yaml-converter"]))}}),Lo={class:"form-post-title"},No=["href","title"],Ho=te({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/main/MetaweblogMain.vue"),n=new Oe,{t:i}=De(),b=_(""),r=_(i("setting.blog.platform.support.metaweblog")+e.apiType+" "),k=_(!1),T=_(!1),y=_(!1),V=_(!1),$=_(!1),D=_(!1),A=_(!1),Y=_(!1),B=_(!1),v=_(!1),P=_(!1),h=_(!1),d=_(""),p=_(!1),o=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"]}),C=ce({pageId:"",meta:{tags:""}}),f=()=>{B.value=!1},m=()=>{B.value=!0},M=async()=>{Y.value=!0;const R=await rt(!0,e.pageId);if(!R||R==="")return;const z=fe(e.apiType);pt(z)||(b.value=z.blogName);const oe=Ue();P.value=!0,C.pageId=R,C.meta=await n.getBlockAttrs(R);const S=await n.getBlockByID(R);if(!S)throw Y.value=!1,U.error(i("config.error.msg")+"_"+e.apiType),new Error(i("config.error.msg")+"_"+e.apiType);l.debug("MetaweblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",C.meta);let O=S.content;oe.fixTitle&&(O=Ot(S.content)),o.title=O,o.customSlug=C.meta[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],o.desc=C.meta[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],o.created=Nt(S.created),o.tag.dynamicTags=[];const q=(C.meta.tags||"").split(",");for(let me=0;me<q.length;me++)q[me]!==""&&o.tag.dynamicTags.push(q[me]);oe.autoTag&&o.tag.dynamicTags.length===0&&(p.value=!0),h.value=qt(e.apiType,C.meta);const Z=fe(e.apiType),x=new He(e.apiType);let Ce=[];if(h.value){const me=C.meta;o.postid=me[Z.posidKey],d.value=await x.getPreviewUrl(o.postid.toString());try{const de=await x.getPost(o.postid.toString());Ce=de.categories,l.debug("postid=>",o.postid),l.debug("post=>",de),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",Ce)}catch(de){U.error(i("post.delete.by.platform")),Y.value=!1,l.error("\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",de)}}let ve=[];try{ve=await x.getCategories()}catch(me){Y.value=!1,l.error(i("main.cat.list.error"),me)}const ge=[];ve&&ve.length&&ve.length>0&&(ve.forEach(me=>{const de={value:me.description,label:me.description};ge.push(de)}),o.cat.categoryList=ge),o.cat.categorySelected=Ce,o.categories=Ce,k.value=z.apiStatus,Y.value=!1};Ke(async()=>{await M()});function J(){return Ne(o.customSlug)||v.value?!0:(l.debug(i("main.force.refresh.tip")),!1)}const F=async R=>{if(!J())return;T.value=!0;const z=await n.getBlockByID(C.pageId);l.debug("page=>",z);let oe=z.content;if(oe.indexOf(".")>-1&&(oe=oe.replace(/\d*\./g,"")),l.debug("fmtTitle=>",oe),o.checkList.length>0){const S=await Kt(oe);l.debug("result=>",S),S?o.customSlug=S:U.success(i("main.opt.failure"))}else o.customSlug=tt(oe);if(P.value){const S=z.content+new Date().toISOString(),O="-"+zt(S).toLowerCase();o.customSlug+=O}T.value=!1,R!==!0&&U.success(i("main.opt.success"))},E=async R=>{y.value=!0;const oe=(await n.exportMdContent(C.pageId)).content,S=da(oe);o.desc=Rt(S,Lt.MAX_PREVIEW_LENGTH,!0),y.value=!1,R!==!0&&U.success(i("main.opt.success"))},I=R=>{o.tag.dynamicTags.splice(o.tag.dynamicTags.indexOf(R),1)},K=_(),G=()=>{o.tag.inputVisible=!0,ca(()=>{K.value.focus()})},se=()=>{o.tag.inputValue&&o.tag.dynamicTags.push(o.tag.inputValue),o.tag.inputVisible=!1,o.tag.inputValue=""};async function Q(R){if(!p.value){U.warning(i("main.tag.auto.switch.no.tip"));return}V.value=!0;const oe=(await n.exportMdContent(C.pageId)).content,S=await Ht(oe);l.debug("genTags=>",S);const O=Gt(S,5);l.debug("hotTags=>",O);for(let j=0;j<O.length;j++)o.tag.dynamicTags.includes(O[j])||o.tag.dynamicTags.push(O[j]);V.value=!1,R!==!0&&U.success(i("main.opt.success"))}const H=async R=>{const z={[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:o.customSlug,[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:o.desc,tags:o.tag.dynamicTags.join(",")};await n.setBlockAttrs(C.pageId,z),l.debug("MetaweblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",z),R!==!0&&(await M(),U.success(i("main.opt.success")))},re=(R,z,oe,S)=>{},X=(R,z)=>{console.log("data=>",R),console.log("status=>",z);const oe=[];z.checkedKeys.forEach(O=>{oe.push(O.toString())}),o.categories=oe,l.debug(" formData.categories=>",o.categories)},Me=async R=>{$.value=!0,await F(!0),await E(!0),await Q(!0),await H(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),$.value=!1,R!==!0&&U.success(i("main.publish.oneclick.attr.finish"))},We=async()=>{if(!k.value){U.error(i("setting.blog.vali.tip.metaweblog"));return}D.value=!0;try{await Me(!0);const R=fe(e.apiType),z=new He(e.apiType),oe=Ue();let S;const j=(await n.exportMdContent(C.pageId)).content;if(Pe.Html===R.pageType){const Ce=_t(j);S=pa(Ce),oe.removeH1&&(S=vt(S))}else S=jt(j),oe.removeH1&&(S=Wt(S));const q=new Yt;q.title=o.title,q.wp_slug=o.customSlug,q.description=S,q.categories=o.categories,q.mt_keywords=o.tag.dynamicTags.join(","),e.apiType===ye.API_TYPE_CNBLOGS&&q.categories.push("[Markdown]"),q.dateCreated=new Date;const Z=!0;let x;if(h.value){if(x=o.postid,!await z.editPost(x,q,!0))throw U.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+x);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",x)}else{x=await z.newPost(q,Z),l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",R.posidKey);const Ce={[R.posidKey]:x};await n.setBlockAttrs(C.pageId,Ce),l.debug("MetaweblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",Ce),l.info("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",x)}await M(),U.success(i("main.opt.success"))}catch(R){throw l.error("\u53D1\u5E03\u5F02\u5E38"),U.error(i("main.opt.failure")),R}D.value=!1},W=async()=>{A.value=!0,Xe.confirm(i("main.opt.warning.tip"),i("main.opt.warning"),{confirmButtonText:i("main.opt.ok"),cancelButtonText:i("main.opt.cancel"),type:"warning"}).then(async()=>{await et(!0),A.value=!1,U.warning(i("main.opt.status.cancel"))}).catch(R=>{throw U({type:"error",message:i("main.opt.failure")}),A.value=!1,new Error(R)})},et=async R=>{const z=fe(e.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",o.postid);const oe={[z.posidKey]:""};await n.setBlockAttrs(C.pageId,oe),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",oe);try{await new He(e.apiType).deletePost(o.postid)||U.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(S){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",S)}R&&await M()};return Re(()=>e.isReload,async()=>{await M(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await M(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(R,z)=>{const oe=Ye,S=Je,O=Ge,j=qe,q=ut,Z=it,x=sa,Ce=na,ve=It,ge=Ft,me=oa,de=je,ne=bt,we=Bt,Le=ht;return u(),g(Le,null,{default:a(()=>[Y.value?w("",!0):(u(),g(ne,{key:0,class:"blog-main"},{default:a(()=>[t(oe,{class:"top-version-tip",title:r.value+b.value,type:"info",closable:!1},null,8,["title"]),k.value?w("",!0):(u(),g(oe,{key:0,class:"top-version-tip",title:R.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),c.useAdaptor?(u(),g(oe,{key:1,class:"top-version-tip",title:R.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):w("",!0),t(de,{"label-width":"120px"},{default:a(()=>[be("div",Lo,[t(O,{label:R.$t("main.title")},{default:a(()=>[t(S,{modelValue:o.title,"onUpdate:modelValue":z[0]||(z[0]=ue=>o.title=ue),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(O,{label:R.$t("main.publish.editmode")},{default:a(()=>[t(q,null,{default:a(()=>[t(j,{type:B.value?"default":"primary",onClick:f},{default:a(()=>[N(L(R.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(j,{type:B.value?"primary":"default",onClick:m},{default:a(()=>[N(L(R.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),B.value?(u(),g(O,{key:0,label:R.$t("main.force.refresh")},{default:a(()=>[t(Z,{modelValue:v.value,"onUpdate:modelValue":z[1]||(z[1]=ue=>v.value=ue)},null,8,["modelValue"]),v.value?w("",!0):(u(),g(oe,{key:0,title:R.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),B.value?(u(),g(O,{key:1,label:R.$t("main.slug")},{default:a(()=>[t(S,{modelValue:o.customSlug,"onUpdate:modelValue":z[2]||(z[2]=ue=>o.customSlug=ue)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),B.value?(u(),g(O,{key:2},{default:a(()=>[t(Ce,{modelValue:o.checkList,"onUpdate:modelValue":z[3]||(z[3]=ue=>o.checkList=ue)},{default:a(()=>[t(x,{label:"1"},{default:a(()=>[N(L(R.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),B.value?(u(),g(O,{key:3},{default:a(()=>[t(j,{type:"primary",class:"make-slug-btn",onClick:F,loading:T.value},{default:a(()=>[N(L(T.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),B.value?(u(),g(O,{key:4,label:R.$t("main.use.hash")},{default:a(()=>[t(Z,{modelValue:P.value,"onUpdate:modelValue":z[4]||(z[4]=ue=>P.value=ue)},null,8,["modelValue"]),P.value?w("",!0):(u(),g(oe,{key:0,title:R.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),B.value?(u(),g(O,{key:5,label:R.$t("main.desc")},{default:a(()=>[t(S,{type:"textarea",modelValue:o.desc,"onUpdate:modelValue":z[5]||(z[5]=ue=>o.desc=ue)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),B.value?(u(),g(O,{key:6},{default:a(()=>[t(j,{type:"primary",onClick:E,loading:y.value},{default:a(()=>[N(L(y.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),B.value?(u(),g(O,{key:7,label:R.$t("main.create.time")},{default:a(()=>[t(ve,{type:"datetime",modelValue:o.created,"onUpdate:modelValue":z[6]||(z[6]=ue=>o.created=ue),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:R.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),t(O,{label:R.$t("main.tag")},{default:a(()=>[(u(!0),ee(Ie,null,$e(o.tag.dynamicTags,ue=>(u(),g(ge,{key:ue,class:"mx-1",closable:"","disable-transitions":!1,onClose:Zt=>I(ue)},{default:a(()=>[N(L(ue),1)]),_:2},1032,["onClose"]))),128)),o.tag.inputVisible?(u(),g(S,{key:0,ref_key:"tagRefInput",ref:K,modelValue:o.tag.inputValue,"onUpdate:modelValue":z[7]||(z[7]=ue=>o.tag.inputValue=ue),class:"ml-1 w-20",size:"small",onKeyup:Jt(se,["enter"]),onBlur:se},null,8,["modelValue","onKeyup"])):(u(),g(j,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:G},{default:a(()=>[N(L(R.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),B.value?(u(),g(O,{key:8},{default:a(()=>[t(j,{type:"primary",onClick:Q,loading:V.value},{default:a(()=>[N(L(V.value?R.$t("main.opt.loading"):R.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),t(O,{label:R.$t("main.tag.auto.switch")},{default:a(()=>[t(Z,{modelValue:p.value,"onUpdate:modelValue":z[8]||(z[8]=ue=>p.value=ue)},null,8,["modelValue"])]),_:1},8,["label"]),t(O,{label:R.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[t(me,{style:{width:"100%"},modelValue:o.cat.categorySelected,"onUpdate:modelValue":z[9]||(z[9]=ue=>o.cat.categorySelected=ue),data:o.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:R.$t("main.cat.select"),"empty-text":R.$t("main.cat.empty"),"no-data-text":R.$t("main.cat.empty"),onNodeClick:re,onCheck:X},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])]),_:1},8,["label"]),t(O,{label:R.$t("main.opt.quick")},{default:a(()=>[t(j,{type:"primary",onClick:Me,loading:$.value},{default:a(()=>[N(L($.value?R.$t("main.opt.loading"):R.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),B.value?(u(),g(j,{key:0,type:"primary",onClick:H},{default:a(()=>[N(L(R.$t("main.save.attr.to.siyuan")),1)]),_:1})):w("",!0)]),_:1},8,["label"]),t(O,{label:""},{default:a(()=>[t(j,{type:"primary",onClick:We,loading:D.value},{default:a(()=>[N(L(D.value?R.$t("main.publish.loading"):h.value?R.$t("main.update"):R.$t("main.publish")),1)]),_:1},8,["loading"]),h.value?(u(),g(j,{key:0,loading:A.value,onClick:W},{default:a(()=>[N(L(R.$t("main.cancel")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),t(O,null,{default:a(()=>[t(j,{type:"danger",text:"",disabled:""},{default:a(()=>[N(L(h.value?R.$t("main.publish.status.published"):R.$t("main.publish.status.unpublish")),1)]),_:1}),h.value?(u(),ee("a",{key:0,href:d.value,title:d.value,target:"_blank"},L(R.$t("main.publish.see.preview")),9,No)):w("",!0)]),_:1})]),_:1})]),_:1})),t(we,{loading:Y.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const ot=Ze(Ho,[["__scopeId","data-v-a0321823"]]),Go=te({__name:"JVueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_JVUE);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),jo=te({__name:"ConfluenceMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_CONFLUENCE);return(n,i)=>(u(),g(ot,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":l.value,"use-adaptor":!0,"page-id":e.pageId},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),Wo=te({__name:"CnblogsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_CNBLOGS);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),qo=te({__name:"WordpressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_WORDPRESS);return(n,i)=>(u(),g(ot,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Jo=/.(gif|jpe?g|tiff?|png|webp|bmp|ico)$/i;async function zo(c){let e="";if(c.uri){const l=new URL(c.uri);e=(await(await Xa(l)).buffer()).toString("base64")}else if(c.path&&Jo.test(c.path))(await(void 0)(c.path)).isFile()&&(e=(await(void 0)(Qa(c.path))).toString("base64"));else throw new Error("Didn't get an image or a good uri for the appropriate param");return{base64:e}}class Qo{constructor(){ie(this,"logger",_e.getLogger("utils/parser/imageParser.ts"))}hasExternalImages(e){const n=/!\[.*]\((http|https):\/.*\/.*\)/g,i=e.match(n);if(i!=null&&i.length>0)return!0;const b=/!\[.*]\((data:image):\/.*\/.*\)/g,r=e.match(b);return r!=null&&r.length>0}removeImages(e){let l=e;return l=l.replace(/!\[.*]\((http|https):\/.*\/.*\)/g,""),l}async replaceImagesWithBase64(e){var b,r,k;let l=e;const n=/!\[.*]\((http|https):\/.*\/.*\)/g,i=l.match(n);if(i==null||i.length===0)return l;for(let T=0;T<i.length;T++){const y=i[T];this.logger.debug("img=>",y);const V=y.replace(/!\[]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",V);let $;if(Oa()){const D=await zo({uri:V});$=(b=D==null?void 0:D.base64)!=null?b:"no pic"}else{const A=Ra("VITE_MIDDLEWARE_URL","/api/middleware")+"/imageToBase64",Y={fetchParams:{imgUrl:V}},B={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)};this.logger.debug("middleApiUrl=>",A),this.logger.debug("middleFetchOption=>",B);const P=await(await fetch(A,B)).json();this.logger.debug("resJson=>",P),$=(k=(r=P==null?void 0:P.body)==null?void 0:r.base64str)!=null?k:"parse error"}$=ke('<img src="data:image/png;base64,',$,'"  alt="base64Image"/>'),l=l.replace(y,$)}return l}replaceImagesWithAscii(e){return e}replaceImagesWithColorAscii(e){return e}async uploadImageToBeds(e){return e}async downloadMdWithImages(){}async downloadImagesToSiyuan(){throw new Error("\u601D\u6E90\u7B14\u8BB0\u5DF2\u7ECF\u6709\u6B64\u529F\u80FD\uFF0C\u65E0\u9700\u91CD\u65B0\u5B9E\u73B0")}}const Xo={class:"form-post-title"},Zo=["href","title"],xo=te({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:gt,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/main/CommonBlogMain.vue"),n=new Oe,i=new Qo,{t:b}=De(),r=_(""),k=_(b("setting.blog.platform.support.common")+e.apiType+" "),T=_(!1),y=_(!1),V=_(!1),$=_(!1),D=_(!1),A=_(!1),Y=_(!1),B=_(!1),v=_(!1),P=_(!1),h=_(!1),d=_(!1),p=_(""),o=_(!1),C=_(!1),f=ce({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["\u9ED8\u8BA4\u5206\u7C7B"],cat_slugs:[]}),m=ce({pageId:"",meta:{tags:""}}),M=()=>{v.value=!1},J=()=>{v.value=!0},F=async()=>{B.value=!0;const S=await rt(!0,e.pageId);if(!S||S==="")return;const O=fe(e.apiType);pt(O)||(r.value=O.blogName||"");const j=Ue();h.value=!0,m.pageId=S,m.meta=await n.getBlockAttrs(S);let q;try{q=await n.getBlockByID(S)}catch(ne){throw B.value=!1,l.error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25",ne),new Error("\u9875\u9762\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}if(!q)throw B.value=!1,U.error(b("config.error.msg")+"_"+e.apiType),new Error(b("config.error.msg")+"_"+e.apiType);l.debug("CommonblogMain\u521D\u59CB\u5316\u9875\u9762,meta=>",m.meta);let Z=q.content;j.fixTitle&&(Z=Ot(q.content)),f.title=Z,f.customSlug=m.meta[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY],f.desc=m.meta[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY],f.created=Nt(q.created),f.tag.dynamicTags=[];const Ce=(m.meta.tags||"").split(",");for(let ne=0;ne<Ce.length;ne++)Ce[ne]!==""&&f.tag.dynamicTags.push(Ce[ne]);j.autoTag&&f.tag.dynamicTags.length===0&&(o.value=!0),d.value=qt(e.apiType,m.meta),C.value=!d.value;const ve=fe(e.apiType),ge=new He(e.apiType);let me=[],de=[];if(d.value){const ne=m.meta;if(f.postid=ne[ve.posidKey||""],p.value=await ge.getPreviewUrl(f.postid.toString()),e.useCat)try{const we=await ge.getPost(f.postid.toString());me=we.categories,de=we.cate_slugs,l.debug("postid=>",f.postid),l.debug("post=>",we),l.debug("\u521D\u59CB\u5316\u9009\u62E9\u8FC7\u7684\u5206\u7C7B,catData=>",me)}catch(we){U.error(b("post.delete.by.platform")),B.value=!1,l.error("\u5E73\u53F0\u6587\u7AE0\u65B0\u83B7\u53D6\u5931\u8D25",we)}}else if(e.useCat&&!Ne(ve.blogName)){const ne=[],we=[];ne.push(ve.blogName),me=ne,we.push(ve.blogid),de=we}if(e.useCat){let ne=[];try{ne=await ge.getCategories()}catch(Le){B.value=!1,l.error(b("main.cat.list.error"),Le)}const we=[];ne&&ne.length&&ne.length>0&&(ne.forEach(Le=>{const ue={value:Le.categoryId,label:Le.description};we.push(ue)}),f.cat.categoryList=we),f.cat.categorySelected=me.length>0?me[0]:"",r.value=f.cat.categorySelected,f.categories=me,f.cat_slugs=de}T.value=O.apiStatus||!1,B.value=!1};Ke(async()=>{await F()});function E(){return Ne(f.customSlug)||P.value?!0:(l.debug(b("main.force.refresh.tip")),!1)}const I=async S=>{if(!E())return;y.value=!0;const O=await n.getBlockByID(m.pageId);l.debug("page=>",O);let j=O.content;if(j.indexOf(".")>-1&&(j=j.replace(/\d*\./g,"")),l.debug("fmtTitle=>",j),f.checkList.length>0){const q=await Kt(j);l.debug("result=>",q),q?f.customSlug=q:U.success(b("main.opt.failure"))}else f.customSlug=tt(j);if(h.value){const q=O.content+new Date().toISOString(),Z="-"+zt(q).toLowerCase();f.customSlug+=Z}y.value=!1,S!==!0&&U.success(b("main.opt.success"))},K=async S=>{V.value=!0;const j=(await n.exportMdContent(m.pageId)).content,q=da(j);f.desc=Rt(q,Lt.MAX_PREVIEW_LENGTH,!0),V.value=!1,S!==!0&&U.success(b("main.opt.success"))},G=S=>{f.tag.dynamicTags.splice(f.tag.dynamicTags.indexOf(S),1)},se=_(),Q=()=>{f.tag.inputVisible=!0,ca(()=>{se.value.focus()})},H=()=>{f.tag.inputValue&&f.tag.dynamicTags.push(f.tag.inputValue),f.tag.inputVisible=!1,f.tag.inputValue=""};async function re(S){if(!o.value){U.warning(b("main.tag.auto.switch.no.tip"));return}$.value=!0;const j=(await n.exportMdContent(m.pageId)).content,q=await Ht(j);l.debug("genTags=>",q);const Z=Gt(q,5);l.debug("hotTags=>",Z);for(let x=0;x<Z.length;x++)f.tag.dynamicTags.includes(Z[x])||f.tag.dynamicTags.push(Z[x]);$.value=!1,S!==!0&&U.success(b("main.opt.success"))}const X=S=>{l.debug("val=>",S);const O=fe(e.apiType),j=[],q=[];j.push(S.label),f.categories=j,q.push(O.username+"/"+S.value),f.cat_slugs=q,r.value=S.label,l.debug(" formData.categories=>",f.categories),l.debug(" formData.cat_slugs=>",f.cat_slugs)},Me=async S=>{const O={[Ae.SIYUAN_PAGE_ATTR_CUSTOM_SLUG_KEY]:f.customSlug,[Ae.SIYUAN_PAGE_ATTR_CUSTOM_DESC_KEY]:f.desc,tags:f.tag.dynamicTags.join(",")};await n.setBlockAttrs(m.pageId,O),l.debug("CommonblogMain\u4FDD\u5B58\u5C5E\u6027\u5230\u601D\u6E90\u7B14\u8BB0,meta=>",O),S!==!0&&(await F(),U.success(b("main.opt.success")))},We=async S=>{D.value=!0,await I(!0),await K(!0),await re(!0),await Me(!0),l.debug("\u53D1\u5E03\u5C5E\u6027\u5B8C\u6210"),D.value=!1,S!==!0&&U.success(b("main.publish.oneclick.attr.finish"))},W=S=>{const j=ia(S);if(Ne(j))return!1;l.debug("checkLimit lastmodKey=>",S),l.debug("checkLimit lastmodDate=>",j);const q=Na(j);return q<=e.limitSeconds?(U.error("\u7531\u4E8E\u3010"+e.apiType+"\u3011\u5E73\u53F0\u7684\u9650\u5236\uFF0C\u6BCF6\u5206\u949F\u4E4B\u5185\u53EA\u80FD\u53D1\u5E03\u6216\u8005\u66F4\u65B0\u4E00\u6B21\u6587\u7AE0\uFF0C\u8DDD\u79BB\u4E0A\u4E00\u6B21\u53D1\u5E03\u65F6\u95F4\u4E3A\uFF1A"+q+"\u79D2\uFF0C\u4ECD\u9700\u7B49\u5F85\uFF1A"+(e.limitSeconds-q)+"\u79D2"),!0):!1},et=async()=>{const O=(await n.exportMdContent(m.pageId)).content;e.removeImage&&i.hasExternalImages(O)?Xe.confirm("\u68C0\u6D4B\u5230\u5916\u94FE\u56FE\u7247\uFF0C\u7531\u4E8E\u5E73\u53F0\u9650\u5236\uFF0C\u7EE7\u7EED\u53D1\u5E03\u5C06\u5254\u9664\u8FD9\u4E9B\u56FE\u7247\uFF0C\u4EE5\u7EAF\u6587\u672C\u53D1\u5E03\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await R()}).catch(()=>{}):await R()},R=async()=>{if(!T.value){U.error(b("setting.blog.vali.tip.metaweblog"));return}A.value=!0;try{const S=e.apiType+"_PUBLISH_LIMIT";if(W(S)){A.value=!1;return}l.debug("\u9A8C\u8BC1\u901A\u8FC7\uFF0C\u66F4\u65B0\u53D1\u5E03\u65F6\u95F4");const O=new Date().toISOString();La(S,O),await We(!0);const j=fe(e.apiType),q=new He(e.apiType),Z=Ue();let x,ve=(await n.exportMdContent(m.pageId)).content;if(e.removeImage&&(ve=i.removeImages(ve)),Pe.Html===j.pageType){const ne=_t(ve);x=pa(ne),Z.removeH1&&(x=vt(x))}else x=jt(ve),Z.removeH1&&(x=Wt(x));const ge=new Yt;ge.title=f.title,ge.wp_slug=f.customSlug,ge.description=x,ge.categories=f.categories,ge.cate_slugs=f.cat_slugs,ge.mt_keywords=f.tag.dynamicTags.join(","),ge.dateCreated=new Date;const me=!0;let de;if(d.value){if(de=f.postid,!await q.editPost(de,ge,!0))throw U.error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25"),new Error("\u6587\u7AE0\u66F4\u65B0\u5931\u8D25=>"+de);l.debug("\u6587\u7AE0\u5DF2\u66F4\u65B0\uFF0Cpostid=>",de)}else{if(de=await q.newPost(ge,me),ge.cate_slugs&&ge.cate_slugs.length>0){const we=ge.cate_slugs[0];de=de+"_"+we}l.debug("\u5F53\u524D\u4FDD\u5B58\u7684posidKey=>",j.posidKey);const ne={[j.posidKey||""]:de};await n.setBlockAttrs(m.pageId,ne),l.debug("CommonblogMain\u53D1\u5E03\u6210\u529F\uFF0C\u4FDD\u5B58postid,meta=>",ne),l.debug("\u6587\u7AE0\u53D1\u5E03\u6210\u529F\uFF0Cpostid=>",de)}await F(),U.success(b("main.opt.success"))}catch(S){A.value=!1,l.error("\u53D1\u5E03\u5F02\u5E38",S),U.error({dangerouslyUseHTMLString:!0,message:b("main.opt.failure")+"=>"+S})}A.value=!1},z=async()=>{Y.value=!0,Xe.confirm(b("main.opt.warning.tip"),b("main.opt.warning"),{confirmButtonText:b("main.opt.ok"),cancelButtonText:b("main.opt.cancel"),type:"warning"}).then(async()=>{await oe(!0),Y.value=!1,U.warning(b("main.opt.status.cancel"))}).catch(S=>{throw U({type:"error",message:b("main.opt.failure")}),Y.value=!1,new Error(S)})},oe=async S=>{const O=fe(e.apiType);l.debug("\u51C6\u5907\u53D6\u6D88\u53D1\u5E03\uFF0Cpostid=>",f.postid);const j={[O.posidKey||""]:""};await n.setBlockAttrs(m.pageId,j),l.debug("MetaweblogMain\u53D6\u6D88\u53D1\u5E03,meta=>",j);try{if(!await new He(e.apiType).deletePost(f.postid))throw U.error("\u6587\u7AE0\u5220\u9664\u5931\u8D25"),new Error("\u6587\u7AE0\u5220\u9664\u5931\u8D25")}catch(q){l.error("\u5F3A\u884C\u5220\u9664\u4E00\u6B21",q)}S&&await F()};return Re(()=>e.isReload,async()=>{await F(),l.debug(e.apiType+"_Main\u68C0\u6D4B\u5230\u8BBE\u7F6E\u66F4\u65B0\u64CD\u4F5C\uFF0C\u5237\u65B0\u9875\u9762")}),Re(()=>e.isMainReload,async()=>{await F(),l.debug(e.apiType+"_Main\u5DE6\u53F3\u5207\u6362tab\uFF0C\u5237\u65B0\u9875\u9762")}),(S,O)=>{const j=Ye,q=Je,Z=Ge,x=qe,Ce=ut,ve=it,ge=sa,me=na,de=It,ne=Ft,we=aa,Le=la,ue=je,Zt=bt,ga=Bt,fa=ht;return u(),g(fa,null,{default:a(()=>[B.value?w("",!0):(u(),g(Zt,{key:0,class:"common-main"},{default:a(()=>[t(j,{class:"top-version-tip",title:k.value+r.value,type:"info",closable:!1},null,8,["title"]),c.useCat&&d.value?(u(),g(j,{key:0,class:"top-version-tip",title:"\u6682\u65F6\u4E0D\u652F\u6301\u7F16\u8F91\u6240\u5C5E\u77E5\u8BC6\u5E93\u3002\u5982\u679C\u60A8\u60F3\u79FB\u52A8\u6587\u6863\uFF0C\u8BF7\u5148\u70B9\u51FB\u53D6\u6D88\u5220\u9664\u8BE5\u6587\u6863\uFF0C\u7136\u540E\u91CD\u65B0\u9009\u62E9\u65B0\u7684\u77E5\u8BC6\u5E93\u53D1\u5E03\u3002",type:"warning",closable:!1})):w("",!0),T.value?w("",!0):(u(),g(j,{key:1,class:"top-version-tip",title:S.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),t(ue,{"label-width":"120px"},{default:a(()=>[be("div",Xo,[t(Z,{label:S.$t("main.title")},{default:a(()=>[t(q,{modelValue:f.title,"onUpdate:modelValue":O[0]||(O[0]=ae=>f.title=ae),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"])]),t(Z,{label:S.$t("main.publish.editmode")},{default:a(()=>[t(Ce,null,{default:a(()=>[t(x,{type:v.value?"default":"primary",onClick:M},{default:a(()=>[N(L(S.$t("main.publish.editmode.simple")),1)]),_:1},8,["type"]),t(x,{type:v.value?"primary":"default",onClick:J},{default:a(()=>[N(L(S.$t("main.publish.editmode.complex")),1)]),_:1},8,["type"])]),_:1})]),_:1},8,["label"]),v.value?(u(),g(Z,{key:0,label:S.$t("main.force.refresh")},{default:a(()=>[t(ve,{modelValue:P.value,"onUpdate:modelValue":O[1]||(O[1]=ae=>P.value=ae)},null,8,["modelValue"]),P.value?w("",!0):(u(),g(j,{key:0,title:S.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),v.value?(u(),g(Z,{key:1,label:S.$t("main.slug")},{default:a(()=>[t(q,{modelValue:f.customSlug,"onUpdate:modelValue":O[2]||(O[2]=ae=>f.customSlug=ae)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),v.value?(u(),g(Z,{key:2},{default:a(()=>[t(me,{modelValue:f.checkList,"onUpdate:modelValue":O[3]||(O[3]=ae=>f.checkList=ae)},{default:a(()=>[t(ge,{label:"1"},{default:a(()=>[N(L(S.$t("main.use.google.translate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),v.value?(u(),g(Z,{key:3},{default:a(()=>[t(x,{type:"primary",class:"make-slug-btn",onClick:I,loading:y.value},{default:a(()=>[N(L(y.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.slug")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),v.value?(u(),g(Z,{key:4,label:S.$t("main.use.hash")},{default:a(()=>[t(ve,{modelValue:h.value,"onUpdate:modelValue":O[4]||(O[4]=ae=>h.value=ae)},null,8,["modelValue"]),h.value?w("",!0):(u(),g(j,{key:0,title:S.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))]),_:1},8,["label"])):w("",!0),v.value?(u(),g(Z,{key:5,label:S.$t("main.desc")},{default:a(()=>[t(q,{type:"textarea",modelValue:f.desc,"onUpdate:modelValue":O[5]||(O[5]=ae=>f.desc=ae)},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),v.value?(u(),g(Z,{key:6},{default:a(()=>[t(x,{type:"primary",onClick:K,loading:V.value},{default:a(()=>[N(L(V.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.desc")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),v.value?(u(),g(Z,{key:7,label:S.$t("main.create.time")},{default:a(()=>[t(de,{type:"datetime",modelValue:f.created,"onUpdate:modelValue":O[6]||(O[6]=ae=>f.created=ae),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:S.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),t(Z,{label:S.$t("main.tag")},{default:a(()=>[(u(!0),ee(Ie,null,$e(f.tag.dynamicTags,ae=>(u(),g(ne,{key:ae,class:"mx-1",closable:"","disable-transitions":!1,onClose:ns=>G(ae)},{default:a(()=>[N(L(ae),1)]),_:2},1032,["onClose"]))),128)),f.tag.inputVisible?(u(),g(q,{key:0,ref_key:"tagRefInput",ref:se,modelValue:f.tag.inputValue,"onUpdate:modelValue":O[7]||(O[7]=ae=>f.tag.inputValue=ae),class:"ml-1 w-20",size:"small",onKeyup:Jt(H,["enter"]),onBlur:H},null,8,["modelValue","onKeyup"])):(u(),g(x,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Q},{default:a(()=>[N(L(S.$t("main.tag.new")),1)]),_:1}))]),_:1},8,["label"]),v.value?(u(),g(Z,{key:8},{default:a(()=>[t(x,{type:"primary",onClick:re,loading:$.value},{default:a(()=>[N(L($.value?S.$t("main.opt.loading"):S.$t("main.auto.fetch.tag")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),t(Z,{label:S.$t("main.tag.auto.switch")},{default:a(()=>[t(ve,{modelValue:o.value,"onUpdate:modelValue":O[8]||(O[8]=ae=>o.value=ae)},null,8,["modelValue"])]),_:1},8,["label"]),e.useCat?(u(),g(Z,{key:9,label:S.$t("main.cat"),style:{width:"100%"}},{default:a(()=>[C.value?(u(),g(Le,{key:0,modelValue:f.cat.categorySelected,"onUpdate:modelValue":O[9]||(O[9]=ae=>f.cat.categorySelected=ae),placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:X},{default:a(()=>[(u(!0),ee(Ie,null,$e(f.cat.categoryList,ae=>(u(),g(we,{key:ae.value,label:ae.label,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(u(),g(Le,{key:1,modelValue:f.cat.categorySelected,"onUpdate:modelValue":O[10]||(O[10]=ae=>f.cat.categorySelected=ae),disabled:"",placeholder:"\u8BF7\u9009\u62E9","no-data-text":"\u6682\u65E0\u6570\u636E",class:"m-2",size:"default",onChange:X},{default:a(()=>[(u(!0),ee(Ie,null,$e(f.cat.categoryList,ae=>(u(),g(we,{key:ae.value,label:ae.label,value:ae},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"])):w("",!0),t(Z,{label:S.$t("main.opt.quick")},{default:a(()=>[t(x,{type:"primary",onClick:We,loading:D.value},{default:a(()=>[N(L(D.value?S.$t("main.opt.loading"):S.$t("main.publish.oneclick.attr")),1)]),_:1},8,["loading"]),v.value?(u(),g(x,{key:0,type:"primary",onClick:Me},{default:a(()=>[N(L(S.$t("main.save.attr.to.siyuan")),1)]),_:1})):w("",!0)]),_:1},8,["label"]),t(Z,{label:""},{default:a(()=>[t(x,{type:"primary",onClick:et,loading:A.value},{default:a(()=>[N(L(A.value?S.$t("main.publish.loading"):d.value?S.$t("main.update"):S.$t("main.publish")),1)]),_:1},8,["loading"]),d.value?(u(),g(x,{key:0,loading:Y.value,onClick:z},{default:a(()=>[N(L(S.$t("main.cancel")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),t(Z,null,{default:a(()=>[t(x,{type:"danger",text:"",disabled:""},{default:a(()=>[N(L(d.value?S.$t("main.publish.status.published"):S.$t("main.publish.status.unpublish")),1)]),_:1}),d.value?(u(),ee("a",{key:0,href:p.value,title:p.value,target:"_blank"},L(S.$t("main.publish.see.preview")),9,Zo)):w("",!0)]),_:1})]),_:1})]),_:1})),t(ga,{loading:B.value,rows:5,animated:""},null,8,["loading"])]),_:1})}}});const Xt=Ze(xo,[["__scopeId","data-v-0a68e6b1"]]),es=te({__name:"LiandiMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_LIANDI);return(n,i)=>(u(),g(Xt,{"is-main-reload":e.isMainReload,"is-reload":e.isReload,"api-type":l.value,"page-id":e.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),ts=te({__name:"YuqueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_YUQUE);return(n,i)=>(u(),g(Xt,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId,"use-cat":!0},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),as=te({__name:"KmsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_(ye.API_TYPE_KMS);return(n,i)=>(u(),g(Xt,{"api-type":l.value,"is-main-reload":e.isMainReload,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),ls={key:1},os=te({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_e.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:n,vuepressEnabled:i,hugoEnabled:b,hexoEnabled:r,jekyllEnabled:k,jvueEnabled:T,confEnabled:y,cnblogsEnabled:V,wordpressEnabled:$,liandiEnabled:D,yuqueEnabled:A,kmsEnabled:Y,doCount:B}=Ct(),v=_(!1),P=ce({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),h=o=>{const C=[];return o.forEach(f=>{const m=new lt(f.platformType,f.platformKey,f.platformName),M="switch-"+f.platformKey,J=Se(M);m.modelValue=J,J&&C.push(m),m.yamlConverter=Ha(f.platformKey)}),C},d=()=>{B();const o=st();P.dynamicConfigArray=h(o.totalCfg||[]),P.githubArray=h(o.githubCfg||[]),P.metaweblogArray=h(o.metaweblogCfg||[]),P.wordpressArray=h(o.wordpressCfg||[]),l.debug("dynamicJsonCfg=>",JSON.stringify(o)),l.debug("\u5E73\u53F0\u8BBE\u7F6E\u521D\u59CB\u5316")},p=()=>{v.value=!v.value};return Re(()=>e.isReload,(o,C)=>{d()}),Ke(()=>{d()}),(o,C)=>{const f=At,m=$t,M=Ye;return s(n).tabCount>0?(u(),g(m,{key:0,type:"border-card",onTabChange:p},{default:a(()=>[s(i)?(u(),g(f,{key:0,label:o.$t("main.publish.to.vuepress")},{default:a(()=>[t(Yo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(b)?(u(),g(f,{key:1,label:o.$t("main.publish.to.hugo")},{default:a(()=>[t(Ko,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(r)?(u(),g(f,{key:2,label:o.$t("main.publish.to.hexo")},{default:a(()=>[t(Oo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(k)?(u(),g(f,{key:3,label:o.$t("main.publish.to.jekyll")},{default:a(()=>[t(Ro,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(T)?(u(),g(f,{key:4,label:o.$t("main.publish.to.jvue")},{default:a(()=>[t(Go,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(y)?(u(),g(f,{key:5,label:o.$t("main.publish.to.conf")},{default:a(()=>[t(jo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(V)?(u(),g(f,{key:6,label:o.$t("main.publish.to.cnblogs")},{default:a(()=>[t(Wo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s($)?(u(),g(f,{key:7,label:o.$t("main.publish.to.wordpress")},{default:a(()=>[t(qo,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(D)?(u(),g(f,{key:8,label:o.$t("main.publish.to.liandi")},{default:a(()=>[t(es,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(A)?(u(),g(f,{key:9,label:o.$t("main.publish.to.yuque")},{default:a(()=>[t(ts,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),s(Y)?(u(),g(f,{key:10,label:o.$t("main.publish.to.kms")},{default:a(()=>[t(as,{"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["is-main-reload","is-reload","page-id"])]),_:1},8,["label"])):w("",!0),(u(!0),ee(Ie,null,$e(P.githubArray,J=>(u(),g(f,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ft,{"is-main-reload":v.value,"is-reload":e.isReload,"api-type":J.platformKey,"page-id":e.pageId,"yaml-converter":J.yamlConverter},null,8,["is-main-reload","is-reload","api-type","page-id","yaml-converter"])]),_:2},1032,["label"]))),128)),(u(!0),ee(Ie,null,$e(P.metaweblogArray,J=>(u(),g(f,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ot,{"api-type":J.platformKey,"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128)),(u(!0),ee(Ie,null,$e(P.wordpressArray,J=>(u(),g(f,{key:J.platformKey,label:J.platformName},{default:a(()=>[t(ot,{"api-type":J.platformKey,"is-main-reload":v.value,"is-reload":e.isReload,"page-id":e.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])]),_:2},1032,["label"]))),128))]),_:1})):(u(),ee("div",ls,[t(M,{class:"top-version-tip",title:o.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),ss=te({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(c){const e=c,l=_e.getLogger("components/publish/PublishService.vue"),n=_("platform-main"),i=_(!1),b=r=>{const k=r.paneName;l.debug("serviceTabChange=>",k),i.value=!i.value};return(r,k)=>{const T=At,y=$t;return u(),g(y,{"model-value":n.value,"tab-position":"left",onTabClick:b},{default:a(()=>[t(T,{class:"pane-platform-main-body",name:"platform-main",label:r.$t("service.tab.publish.service")},{default:a(()=>[t(os,{"is-reload":i.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(T,{name:"platform-setting",label:r.$t("service.tab.publish.setting")},{default:a(()=>[t(Ql,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"]),t(T,{name:"post-bind",label:r.$t("service.tab.post.bind")},{default:a(()=>[t(vl,{"is-reload":i.value,"page-id":e.pageId},null,8,["is-reload","page-id"])]),_:1},8,["label"]),t(T,{name:"service-switch",label:r.$t("service.tab.service.switch")},{default:a(()=>[t(yl,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"]),t(T,{name:"dynamic-platform",label:r.$t("dynamic.platform.new")},{default:a(()=>[t(tl)]),_:1},8,["label"]),t(T,{label:r.$t("service.tab.change.local"),name:"general-setting"},{default:a(()=>[t(Ga,{"is-reload":i.value},null,8,["is-reload"])]),_:1},8,["label"])]),_:1},8,["model-value"])}}});const bs=Ze(ss,[["__scopeId","data-v-988c3419"]]);export{bs as P};

var e=Object.defineProperty,a=(a,t,l)=>(((a,t,l)=>{t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l})(a,"symbol"!=typeof t?t+"":t,l),l);import{E as t,t as l,h as i,f as o,e as s,a as n,d as u,g as d,J as r,K as c,L as p,b as g,i as m,r as y,s as h,H as b,w as f,x as v,n as w,o as _,l as k,m as M}from"./vendor_element-plus-6396cda2.js";import{L as P,f as T,o as C,q as D,z as S,t as V,l as $,u as I,v as E,w as L,x as A,Y as R,r as B,y as x,A as Y,C as U,P as O,B as N,m as H,D as G,E as j,F as K,c as F,G as z,H as q,I as J,J as W,K as Q,h as X,M as Z,N as ee,O as ae,Q as te,R as le,T as ie,U as oe,V as se,W as ne,X as ue,j as de,b as re,Z as ce,k as pe,$ as ge,a0 as me,a1 as ye,a2 as he,a3 as be,a4 as fe,a5 as ve,a6 as we,a7 as _e,a8 as ke,a9 as Me,aa as Pe,ab as Te,ac as Ce,ad as De,ae as Se,af as Ve,ag as $e,ah as Ie,ai as Ee,aj as Le}from"./AppLayout.vue_vue_type_script_setup_true_lang-59c75e45.js";import{ad as Ae,u as Re,O as Be,z as xe,A as Ye,P as Ue,Q as Oe,x as Ne,U as He,V as Ge,a2 as je,X as Ke,_ as Fe,$ as ze,a0 as qe,a1 as Je,ao as We,ap as Qe,Y as Xe,aN as Ze,a9 as ea}from"./vendor-42595716.js";import{d as aa}from"./vendor_shorthash2-e60185c0.js";import{u as ta}from"./vendor_vue-i18n-8a61efa7.js";import{c as la}from"./vendor_copy-to-clipboard-a51858f9.js";import{P as ia,I as oa}from"./picgoPostApi-e82981a4.js";const sa="custom-slug",na="custom-desc",ua="custom-menu-title",da="custom-weight",ra="custom-use-permalink",ca="custom-use-date",pa="true"==={VITE_LOG_INFO_ENABLED:"false",VITE_DEBUG_MODE:"false",VITE_MIDDLEWARE_URL:"https://api.terwer.space/api/middleware"}.TEST,ga="test-data-siyuanPage",ma=(e,a)=>{const l=P.getLogger("composables/publish/makeSlugCom.ts"),{t:i}=ta(),o=new E,s=T(),n=Ae({isSlugLoading:!1,forceRefresh:!1,title:"",customSlug:"",slugHashEnabled:!0}),u=a.siyuanPageMethods,d={makeSlug:async e=>{if(!$(n.customSlug)&&!n.forceRefresh)return!0!==e&&t.warning(i("main.force.refresh.tip")),void l.debug(i("main.force.refresh.tip"));n.isSlugLoading=!0,l.debug("开始生成别名...");try{const d=await u.getPageId();if(pa){const e=C(ga),a=JSON.parse(JSON.parse(e));vi.spyOn(o,"getBlockByID").mockResolvedValue(a)}const r=await o.getBlockByID(d);l.debug("获取到思源页面数据=>",r);const c=n.title;if(s.useGoogleTranslate)try{let e;if(pa){const a=vi.fn().mockImplementation((e=>D(e)));e=await a(c)}else e=await S(c);l.debug("使用谷歌翻译"),e?n.customSlug=e:(n.customSlug=D(c),t.success(i("main.opt.failure")))}catch(a){n.customSlug=D(c)}else n.customSlug=D(c);if(l.debug("完成别名翻译"),n.slugHashEnabled){const e=r.content+(new Date).toISOString(),a=V("-",aa(e).toLowerCase());n.customSlug+=a,l.debug("为别名添加hash")}const p={[sa]:n.customSlug};pa&&vi.spyOn(o,"setBlockAttrs").mockResolvedValue(void 0),await o.setBlockAttrs(d,p),!0!==e&&t.success(i("main.opt.success")),l.info("生成别名正常完成,slugData=>",n)}catch(a){const o=V(i("main.opt.failure"),"=>",a);!0!==e&&t.error(o),l.error(o)}n.isSlugLoading=!1,l.debug("生成别名结束.")},getSlugData:()=>n,isSlugEmpty:()=>$(n.customSlug),initSlug:e=>{let a=e.page.content;s.fixTitle&&(a=I(a)),l.debug("标题处理完毕"),n.title=a;const t=sa;n.customSlug=e.meta[t],l.debug("initSlug=>",n)},syncSlug:e=>{n.title=e.formData.title,n.customSlug=e.formData.customSlug}};return{slugData:n,slugMethods:d}};class ya{constructor(){a(this,"logger",P.getLogger("utils/parser/LinkParser.ts")),a(this,"siyuanApi",new E)}convertSiyuanLinkToInnerLink(e){let a=e;const t=a.match(/\[.*]\(.*\)/g);if(null==t||0===t.length)return this.logger.warn("未匹配到链接，将不会替换链接"),a;for(let l=0;l<t.length;l++){const e=t[l];if(!e.includes("siyuan://blocks"))continue;this.logger.debug("找到思源链接=>",e);const i=e.replace(/\[.*]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",i);let o=e.replace(/\[/g,"").replace(/]\(.*\)/g,"");T().fixTitle&&(o=B(o)),this.logger.debug("title=>",o);let s=i.replace(/siyuan:\/\/blocks\//g,"");s="/detail/index.html?id="+s;const n=`[${o}](${s})`;this.logger.debug("newLink=>",n),a=a.replaceAll(e,n)}return a}async convertSiyuanLinkToPlatformLink(e,a){let t=e;const l=t.match(/\[.*]\(.*\)/g);if(null==l||0===l.length)return this.logger.warn("未匹配到链接，将不会替换链接"),t;for(let i=0;i<l.length;i++){const e=l[i];if(!e.includes("siyuan://blocks"))continue;this.logger.debug("找到思源链接=>",e);const o=e.replace(/\[.*]\(/g,"").replace(/\)/,"");this.logger.debug("src=>",o);let s=e.replace(/\[/g,"").replace(/]\(.*\)/g,"");T().fixTitle&&(s=B(s)),this.logger.debug("title=>",s);const n=o.replace(/siyuan:\/\/blocks\//g,"");let u=n;const d=await this.siyuanApi.getRootBlock(n);d&&(u=d.root_id);const r=(await this.siyuanApi.getBlockAttrs(u))[sa],c=await a.getPreviewUrl(r);this.logger.debug("url=>",c);const p=`[${s}](${c})`;this.logger.debug("newLink=>",p),t=t.replaceAll(e,p)}return t}}class ha{constructor(){a(this,"pageId"),a(this,"meta"),a(this,"page"),a(this,"content")}}const ba=e=>{const a=P.getLogger("composables/publish/siyuanPageCom.ts"),{t:t}=ta(),l=new E,i=Ae({dataObj:new ha}),o={getPageId:async()=>{const l=await F(!0,e.pageId);if(!l||""===l)throw a.error(t("page.no.id")),new Error("page.no.id");return a.debug("当前页面ID为=>",l),l},getSiyuanPageData:()=>i,initSiyuanPage:async e=>{i.dataObj.pageId=e,i.dataObj.meta=await l.getBlockAttrs(e),i.dataObj.page=await l.getBlockByID(e),i.dataObj.content=await l.exportMdContent(e)}};return{siyuanPageData:i,siyuanPageMethods:o}},fa=()=>{const e=P.getLogger("composables/picgo/import/picgoPostCom.ts"),{t:a}=ta(),l=Ae({picgoEnabled:!1}),i={picgoOnChange:e=>{l.picgoEnabled=e},handlePicgoManage:async l=>{try{let e;e=l instanceof Promise?await l:l;ne().isInSiyuan?await ue(e,"picgo/index.html"):de("/picgo/index.html?id="+e)}catch(i){e.error(a("main.opt.failure"),"=>",i),t.error(V(a("main.opt.failure"),"=>",i))}},initPicgo:e=>{l.picgoEnabled=e},getPicgoPostData:()=>l};return{picgoPostData:l,picgoPostMethods:i}},va={class:"github-tips"},wa={class:"github-form"},_a={key:0,class:"form-post-title"},ka={class:"form-edit-mode"},Ma={key:1,class:"normal-mode"},Pa={key:0,class:"form-slug"},Ta={class:"form-desc"},Ca={class:"form-publish-time"},Da={class:"form-tags"},Sa={class:"form-github-pages"},Va={key:0,class:"form-github-pages-items"},$a={key:2,class:"addition-attributes"},Ia={key:3,class:"convert-option"},Ea={key:4,class:"publish-action"},La={key:5,class:"publish-status"},Aa=["href","title"],Ra=["src"],Ba=["href","title"],xa={key:6,class:"source-mode"},Ya={class:"source-opt"},Ua={key:1,id:"yaml-detail-content"},Oa={key:2,id:"yaml-edit-content"},Na={key:3,id:"yaml-action"},Ha={id:"yaml-read-mode-tip"},Ga=pe(Be({__name:"GithubMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},pageId:{type:String,default:void 0},yamlConverter:{type:R}},setup(e){const a=e,f=P.getLogger("components/publish/tab/main/GithubMain.vue"),{pageModeData:v,pageModeMethods:w}=(()=>{const e=Ae({etype:Z.EditMode_simple,stype:ee.YAML_CONTENT});return{pageModeData:e,pageModeMethods:{getPageModeData:()=>e}}})(),{siyuanPageMethods:_}=ba(a),{slugData:k,slugMethods:M}=ma(0,{siyuanPageMethods:_}),{descData:C,descMethods:D}=((e,a)=>{const l=P.getLogger("composables/publish/makeDescCom.ts"),{t:i}=ta(),o=new E,s=Ae({isDescLoading:!1,desc:""}),n=a.siyuanPageMethods,u={makeDesc:async e=>{l.debug("准备生成摘要..."),s.isDescLoading=!0;try{const a=T(),l=await n.getPageId(),u=(await o.exportMdContent(l)).content;let d=H(u);a.removeH1&&(d=G(d)),s.desc=j(d,U.MAX_PREVIEW_LENGTH,!0);const r={[na]:s.desc};await o.setBlockAttrs(l,r),!0!==e&&t.success(i("main.opt.success"))}catch(a){!0!==e&&t.error(V(i("main.opt.failure"),"=>",a))}s.isDescLoading=!1,l.debug("摘要生成完毕.")},getDescData:()=>s,initDesc:e=>{const a=na;s.desc=e.meta[a]},syncDesc:e=>{s.desc=e.formData.desc}};return{descData:s,descMethods:u}})(0,{siyuanPageMethods:_}),{publishTimeData:S,publishTimeMethods:ne}=(()=>{const e=Ae({created:""}),a={getPublishTime:()=>e,initPublishTime:a=>{e.created=K(a.page.created)},syncPublishTime:a=>{e.created=a.formData.created}};return{publishTimeData:e,publishTimeMethods:a}})(),{tagData:ue,tagMethods:de}=(e=>{const a=P.getLogger("composables/publish/makeTagCom.ts"),{t:l}=ta(),i=new E,o=Ae({isTagLoading:!1,tagSwitch:!1,tag:{inputValue:"",dynamicTags:[],inputVisible:!1}}),{siyuanPageMethods:s}=ba(e),n={tagHandleClose:e=>{o.tag.dynamicTags.splice(o.tag.dynamicTags.indexOf(e),1)},tagShowInput:()=>{o.tag.inputVisible=!0},tagHandleInputConfirm:()=>{o.tag.inputValue&&o.tag.dynamicTags.push(o.tag.inputValue),o.tag.inputVisible=!1,o.tag.inputValue=""},fetchTag:async e=>{try{if(!o.tagSwitch)return void t.warning(l("main.tag.auto.switch.no.tip"));o.isTagLoading=!0;const n=await s.getPageId(),u=(await i.exportMdContent(n)).content,d=await z(u);a.debug("genTags=>",d);const r=q(d,5);a.debug("hotTags=>",r);for(let e=0;e<r.length;e++)o.tag.dynamicTags.includes(r[e])||o.tag.dynamicTags.push(r[e]);const c={tags:o.tag.dynamicTags.join(",")};await i.setBlockAttrs(n,c),!0!==e&&t.success(l("main.opt.success"))}catch(n){const i=V(l("main.opt.failure"),"=>",n);!0!==e&&t.error(i),a.error(i)}o.isTagLoading=!1,!0!==e&&t.success(l("main.opt.success"))},getTagData:()=>o.tag.dynamicTags,initTag:e=>{const a=T();o.tag.dynamicTags=[];const t=(e.meta.tags||"").split(",");for(let l=0;l<t.length;l++)""!==t[l]&&o.tag.dynamicTags.push(t[l]);a.autoTag&&0===o.tag.dynamicTags.length&&(o.tagSwitch=!0)},syncTag:e=>{for(let a=0;a<e.formData.tag.dynamicTags.length;a++){const t=e.formData.tag.dynamicTags[a];o.tag.dynamicTags.includes(t)||""===t||o.tag.dynamicTags.push(t)}}};return{tagData:o,tagMethods:n}})(a),{githubPagesData:pe,githubPagesMethods:ge}=((e,a)=>{const l=P.getLogger("composables/publish/githubPagesCom.ts"),i=Ae({githubEnabled:!1,useDefaultPath:!1,currentDefaultPath:"",customPath:"",mdTitle:"",path:{customProps:{label:"label",children:"children",isLeaf:"isLeaf"}},publishPath:"",usePermalink:!0,linkTitle:"",weight:0,useDate:!0}),o=a.siyuanPageMethods,s=a.slugMethods,n={githubOnChange:e=>{i.githubEnabled=e},defaultPathOnChange:a=>{var t;if(i.useDefaultPath=a,1==a){const a=x(e.apiType);n.initGithubPages({cpath:null!=(t=a.defaultPath)?t:"",defpath:i.currentDefaultPath,fname:i.mdTitle})}},customLoad:async(a,t)=>{if(a.isLeaf)return t([]);l.debug("目前已保存路径=>",i.customPath),l.debug("当前节点=>",a.data);const o=x(e.apiType),s=new J(o);let n,u=a.data.value||"";""===u&&""!==i.customPath?n="":(""===u&&(u=""),n=u),t(await s.getGithubPageTreeNode(n))},onSelectChange:e=>{l.debug("onSelectChange=>",e),e.isLeaf?t.error("您当前选择的是页面，请注意，页面必须发布在目录下"):n.initGithubPages({cpath:e.value,defpath:i.currentDefaultPath,fname:i.mdTitle})},onFilenameChange:()=>{if(""===i.customPath)return;const e=Re(i.customPath);n.onSelectChange(e),l.info("触发文件名修改，同步发布路径.")},permalinkOnChange:e=>{i.usePermalink=e},showDateOnChange:e=>{i.useDate=e},getGithubPagesData:()=>i,getDocPath:()=>{const a=W(e.apiType).posidKey;return o.getSiyuanPageData().dataObj.meta[a]||""},getMdFilename:()=>{var a,t,l;const i=x(e.apiType),n=s.getSlugData(),u=o.getSiyuanPageData().dataObj,d=i.mdFilenameRule;let r;const c=U.PUBLISH_DYNAMIC_SLUG;if($(d))r=null!=(t=null!=(a=u.page.content)?a:n.customSlug)?t:c;else{r=d,d.indexOf("filename")>-1&&(r=r.replace(/\[filename]/g,u.page.content)),d.indexOf("slug")>-1&&(r=r.replace(/\[slug]/g,null!=(l=n.customSlug)?l:c));let e=new Date;if(d.indexOf("yyyy")>-1){const a=e.getFullYear();r=r.replace(/\[yyyy]/g,a.toString())}if(d.indexOf("MM")>-1||d.indexOf("mm")>-1){let a,t=e.getMonth()+1;a=t.toString(),t<10&&(a=V("0",a)),r=r.replace(/\[MM]/g,a),r=r.replace(/\[mm]/g,a)}if(d.indexOf("dd")>-1){let a,t=e.getDate();a=t.toString(),t<10&&(a=V("0",a)),r=r.replace(/\[dd]/g,a)}}return r},initGithubPages:(e,a)=>{var t,o,s,n;let u,d,r;if(e&&(u=e.cpath,d=e.defpath,r=e.fname),l.debug("paths=>",e),i.customPath=u,i.currentDefaultPath=d,i.mdTitle=r.indexOf(".md")>-1?r:r+".md",i.customPath.indexOf(".md")>-1?i.publishPath=i.customPath:i.publishPath=Q(i.customPath,"/"+i.mdTitle),a){const e=ua;i.linkTitle=null!=(t=a.meta[e])?t:"";const l=da;i.weight=null!=(o=a.meta[l])?o:"0";const u=ra;i.usePermalink=X(null!=(s=a.meta[u])?s:"true");const d=ca;i.useDate=X(null!=(n=a.meta[d])?n:"false")}}};return{githubPagesData:i,githubPagesMethods:n}})(a,{siyuanPageMethods:_,slugMethods:M}),{yamlData:me,yamlMethods:ye}=(()=>{const e=P.getLogger("composables/publish/makeYamlCom.ts"),{t:a}=ta(),l=Ae({yamlObj:{},readMode:!0,yamlPreviewContent:"",yamlContent:"",isSaved:!0,formatter:"",mdContent:"",mdFullContent:"",htmlContent:""}),i={onYamlContentFocus:e=>{e.preventDefault(),e.target.select(),L()&&A(l.yamlContent)},onYamlContentInput:()=>{l.isSaved=!1},onYamlContextMenu:e=>{e.preventDefault()},doConvertAttrToYAML:(a,t,i)=>{a||(a=new R,e.error("未指定YAML转换器"));const o=a.convertToYaml(t,i);l.yamlObj=o.yamlObj,l.formatter=o.formatter,l.mdContent=o.mdContent,l.mdFullContent=o.formatter+"\n\n"+o.mdContent,l.htmlContent=o.htmlContent},doConvertYAMLToAttr:(a,t,l)=>{a||(a=new R,e.error("未指定YAML转换器"));const i=a.convertToAttr(t,l);return e.debug("doConvertYAMLToAttr转换中转数据postForm=>",i),i},copyYamlToClipboard:()=>{la(l.yamlContent),t.success(a("main.opt.success"))},getYamlData:()=>l,initYaml:e=>{l.yamlContent=e,l.yamlPreviewContent=V(e)}};return{yamlData:l,yamlMethods:i}})(),{quickData:he,quickMethods:be}=((e,a)=>{const i=P.getLogger("composables/publish/publishQuickCom.ts"),{t:o}=ta(),s=new E,n=Ae({isGenLoading:!1,onclickFlag:!1}),u=a.siyuanPageMethods,d=a.slugMethods,r=a.descMethods,c=a.tagMethods,p=a.githubPagesMethods,g={oneclickAttr:async e=>{l.confirm(o("main.opt.onclick.confirm.tip"),o("main.opt.warning"),{confirmButtonText:o("main.opt.ok"),cancelButtonText:o("main.opt.cancel"),type:"warning"}).then((async()=>{n.isGenLoading=!0,await g.doOneclickAttr(),N(),n.isGenLoading=!1,i.debug("一键生成属性完成."),!0!==e&&t.success(o("main.publish.oneclick.attr.finish"))})).catch((e=>{n.isGenLoading=!1,e.toString().indexOf("cancel")<=-1&&(t({type:"error",message:o("main.opt.failure")+"=>"+e}),i.error(o("main.opt.failure")+"=>"+e))}))},doOneclickAttr:async()=>{await d.makeSlug(!0),await r.makeDesc(!0),await c.fetchTag(!0),await g.saveAttrToSiyuan(!0),n.onclickFlag=!0,i.debug("发布属性完成")},saveAttrToSiyuan:async e=>{try{const a=d.getSlugData(),l=r.getDescData(),i=c.getTagData(),n=p.getGithubPagesData();let g={[sa]:a.customSlug,[na]:l.desc,[ra]:n.usePermalink.toString(),[ca]:n.useDate.toString(),tags:i.join(",")};$(n.linkTitle)||(g=Object.assign(g,{[ua]:n.linkTitle}));const m=parseInt(n.weight);m>0&&(g=Object.assign(g,{[da]:m}));const y=await u.getPageId();await s.setBlockAttrs(y,g),!0!==e&&t.success(o("main.opt.success"))}catch(a){const l=V(o("main.opt.failure"),"=>",a);!0!==e&&t.error(V(o("main.opt.failure"),"=>",a)),i.error(l)}},getQuickData:()=>n};return{quickData:n,quickMethods:g}})(0,{siyuanPageMethods:_,slugMethods:M,descMethods:D,tagMethods:de,githubPagesMethods:ge}),{picgoPostData:fe,picgoPostMethods:ve}=fa(),{initPublishData:we,initPublishMethods:_e}=((e,a,i)=>{const o=P.getLogger("composables/publish/initPublishCom.ts"),{t:s}=ta(),n=Ae({isInitLoading:!1,apiStatus:!1,apiTypeInfo:Re(V(s("setting.blog.platform.support.github"),e.apiType)),isPublished:!1,previewMdUrl:"",previewUrl:"",mdStatusUrl:""}),u=a.pageModeMethods,d=a.siyuanPageMethods,r=a.slugMethods,c=a.descMethods,p=a.publishTimeMethods,g=a.tagMethods,m=a.githubPagesMethods,y=a.yamlMethods,h=a.quickMethods,b=a.picgoPostMethods,f={onEditModeChange:e=>{const a=u.getPageModeData();e===Z.EditMode_source?(f.convertAttrToYAML(!0),a.etype=e):y.getYamlData().isSaved?a.etype=e:l.confirm(s("main.yaml.no.save"),s("main.opt.warning"),{confirmButtonText:s("main.opt.ok"),cancelButtonText:s("main.opt.cancel"),type:"warning"}).then((async()=>{f.convertYAMLToAttr(!0),a.etype=e})).catch((()=>{a.etype=e}))},onYamlShowTypeChange:e=>{switch(u.getPageModeData().stype=e,e){case ee.YAML:y.initYaml(y.getYamlData().formatter);break;case ee.CONTENT:y.initYaml(y.getYamlData().mdContent);break;case ee.YAML_CONTENT:y.initYaml(y.getYamlData().mdFullContent);break;case ee.HTML_CONTENT:y.initYaml(y.getYamlData().htmlContent)}},convertDocPathToCategories:e=>{const a=T();o.debug("docPath=>",e);const t=e.split("/");let l=[];if(t.length>1)for(let i=1;i<t.length-1;i++){let e;e=a.fixTitle?I(t[i]):t[i],l.push(e)}return l},composableDataToForm:()=>{const e=T(),a=new se;a.formData.title=r.getSlugData().title,a.formData.customSlug=r.getSlugData().customSlug,a.formData.desc=c.getDescData().desc,a.formData.created=p.getPublishTime().created,a.formData.tag.dynamicTags=g.getTagData();const t=m.getGithubPagesData().customPath;a.formData.categories=f.convertDocPathToCategories(t);let l=d.getSiyuanPageData().dataObj.content.content;return l=ae(l),e.removeH1&&(l=te(l)),a.formData.mdContent=l,a.formData.htmlContent=H(l),a.formData.usePermalink=m.getGithubPagesData().usePermalink,a.formData.linkTitle=m.getGithubPagesData().linkTitle,a.formData.weight=m.getGithubPagesData().weight,a.formData.useDate=m.getGithubPagesData().useDate,a},convertAttrToYAML:a=>{const l=T(),i=x(e.apiType),o=f.composableDataToForm();y.doConvertAttrToYAML(e.yamlConverter,o,i),f.onYamlShowTypeChange(l.contentShowType),!0!==a&&t.success(s("main.opt.success"))},formToComposableData:e=>{r.syncSlug(e),c.syncDesc(e),p.syncPublishTime(e),g.syncTag(e)},convertYAMLToAttr:a=>{if(u.getPageModeData().stype!==ee.YAML){const e="只能转换YAML，请切换显示模式";throw t.error(e),y.getYamlData().isSaved=!0,new Error(e)}try{const l=x(e.apiType),i=y.getYamlData().yamlContent,n=le(i),u=new ie;u.yamlObj=n,o.debug("准备将YAML转换为文章属性，yamlFormatObj=>",u);const d=y.doConvertYAMLToAttr(e.yamlConverter,u,l);f.formToComposableData(d),y.getYamlData().isSaved=!0,!0!==a&&t.success(s("main.opt.success"))}catch(l){!0!==a&&t.error(V(s("main.opt.failure"),"=>",l))}},saveAttrToSiyuanWithInit:async()=>{await h.saveAttrToSiyuan(!0),await f.initPage(!0),t.success(s("main.opt.success"))},getInitPublishData:()=>n,initPage:async a=>{var l,i,h,v,w;n.isInitLoading=1!=a;try{const a=T(),_=u.getPageModeData();_.etype=a.editMode,_.stype=a.contentShowType;const k=x(e.apiType);n.apiStatus=k.apiStatus;const M=await F(!0,e.pageId);if(!M||""===M)return n.isInitLoading=!1,o.error(s("page.no.id")),void t.error(s("page.no.id"));await d.initSiyuanPage(M);const P=d.getSiyuanPageData().dataObj;n.isPublished=oe(e.apiType,d.getSiyuanPageData().dataObj.meta),r.initSlug(P),c.initDesc(P),p.initPublishTime(P),g.initTag(P),b.initPicgo(a.usePicgo);const C=m.getGithubPagesData();let D;C.githubEnabled=n.apiStatus,n.isPublished?(C.useDefaultPath=!1,D=m.getDocPath()):D=null!=(l=k.defaultPath)?l:"";const S=null!=(i=k.defaultPath)?i:"尚未配置",I=m.getMdFilename();if(m.initGithubPages({cpath:D,defpath:S,fname:I},P),f.convertAttrToYAML(!0),n.apiStatus&&n.isPublished){const e=null!=(h=k.baseUrl)?h:"https://terwer.space/",a=null!=(v=k.home)?v:"https://terwer.space/";let t;t=Q(k.githubUser,"/"+k.githubRepo),t=Q(t,"/blob/"),t=Q(t,"/"+k.defaultBranch),t=Q(t,"/"+D),$(k.previewMdUrl)||(t=k.previewMdUrl,t=t.replace(/\[user]/,k.githubUser),t=t.replace(/\[repo]/,k.githubRepo),t=t.replace(/\[branch]/,k.defaultBranch),t=t.replace(/\[docpath]/,D)),t=Q(e,t),n.previewMdUrl=t,n.mdStatusUrl=V("https://img.shields.io/github/checks-status/",k.githubUser,"/",k.githubRepo,"/",k.defaultBranch,"?label=build");let l=y.getYamlData().yamlObj.permalink;if(!$(k.previewUrl))if(k.previewUrl.indexOf("[docpath]")>-1){const e=null!=(w=k.defaultPath)?w:"docs",a=D.replace(e,"").replace(".md","");l=k.previewUrl.replace("/[docpath]",a)}else{l=k.previewUrl.replace(/\[postid]/g,r.getSlugData().customSlug);const e=p.getPublishTime().created.split(" ")[0].split("-");o.debug("created numarr=>",e);const a=e[0],t=e[1],i=e[2];l=l.replace(/\[yyyy]/g,a),l=l.replace(/\[MM]/g,t),l=l.replace(/\[mm]/g,t),l=l.replace(/\[dd]/g,i);const s=m.getGithubPagesData().publishPath,n=f.convertDocPathToCategories(s);l=n.length>0?l.replace(/\[cats]/,n.join("/")):l.replace(/\/\[cats]/,"")}n.previewUrl=Q(a,l)}}catch(_){const e=V(s("main.opt.failure"),"=>",_);o.error(e)}n.isInitLoading=!1}};return{initPublishData:n,initPublishMethods:f}})(a,{pageModeMethods:w,siyuanPageMethods:_,slugMethods:M,descMethods:D,publishTimeMethods:ne,tagMethods:de,githubPagesMethods:ge,yamlMethods:ye,quickMethods:be,picgoPostMethods:ve}),{publishData:ke,publishMethods:Me}=((e,a)=>{const i=P.getLogger("composables/publish/publishActionCom.ts"),{t:o}=ta(),s=new E,n=new ia,u=new ya,d=Ae({isPublishLoading:!1,isCancelLoading:!1}),r=a.siyuanPageMethods,c=a.yamlMethods,p=a.githubPagesMethods,g=a.quickMethods,m=a.picgoPostMethods,y=a.initPublishMethods,h={doPublish:async()=>{var a;i.debug("准备发布文章..."),d.isPublishLoading=!0;try{const l=x(e.apiType),h=new Y(e.apiType),b=p.getGithubPagesData().mdTitle;let f=B(b);if(f=f.replace(/\.md/g,""),/[\s*|\\.]/g.test(f))return i.debug("fmtTitle=>",f),t.error("文件名不能包含空格或者特殊字符"),void(d.isPublishLoading=!1);y.getInitPublishData().isPublished||g.getQuickData().onclickFlag?await g.saveAttrToSiyuan(!0):await g.doOneclickAttr();const v=l.apiStatus;if(!v&&p.getGithubPagesData().githubEnabled)return d.isPublishLoading=!1,void t.error("检测到api不可用或者配置错误，无法发布到Github，请转到源码模式自行复制文本");if(v&&p.getGithubPagesData().githubEnabled){i.debug("开始真正调用api发布到Github");let g=p.getGithubPagesData().customPath;const b=null!=(a=l.defaultPath)?a:"尚未配置";let f=p.getGithubPagesData().mdTitle;f.includes(U.PUBLISH_DYNAMIC_SLUG)&&(f=p.getMdFilename()),p.initGithubPages({cpath:g,defpath:b,fname:f}),y.convertAttrToYAML(!0);let v=c.getYamlData().mdFullContent;if(v=await u.convertSiyuanLinkToPlatformLink(v,h),m.getPicgoPostData().picgoEnabled){const e=r.getSiyuanPageData().dataObj,a=await n.uploadPostImagesToBed(e.pageId,e.meta,v);a.hasImages&&(a.flag?v=a.mdContent:t.error(o("github.post.picgo.picbed.error")+"=>"+a.errmsg))}i.debug("即将发布的内容，publishContent=>",{publishContent:v});const w=p.getGithubPagesData().publishPath,_=new O;let k;if(_.postid=w,_.description=v,k=y.getInitPublishData().isPublished?await h.editPost(_.postid,_):await h.newPost(_),!k)return d.isPublishLoading=!1,void t.error(o("main.publish.vuepress.failure"));const M={[l.posidKey]:w},P=await r.getPageId();await s.setBlockAttrs(P,M),i.debug(e.apiType+"_Main发布成功，保存路径,meta=>",M),await y.initPage(),d.isPublishLoading=!1}i.debug("文章发布完成."),y.getInitPublishData().isPublished?t.success(o("main.opt.status.updated")):t.success(o("main.opt.status.publish"))}catch(l){try{await h.doCancel(!1)}catch(b){i.error("强制删除异常，不影响发布=>",b)}const e=V(o("main.opt.failure"),"=>发布异常，可能是Github平台已自行删除。已清除关联，请重新发布",l);t.error(e),i.error(e)}d.isPublishLoading=!1},cancelPublish:async()=>{i.debug("准备取消文章发布..."),d.isCancelLoading=!0,l.confirm(o("main.opt.warning.tip"),o("main.opt.warning"),{confirmButtonText:o("main.opt.ok"),cancelButtonText:o("main.opt.cancel"),type:"warning"}).then((async()=>{await h.doCancel(!0),d.isCancelLoading=!1,t.warning(o("main.opt.status.cancel"))})).catch((e=>{e.toString().indexOf("cancel")<=-1&&(t({type:"error",message:o("main.opt.failure")+"=>"+e}),i.error(o("main.opt.failure")+"=>"+e)),d.isCancelLoading=!1}))},doCancel:async a=>{const t=x(e.apiType),l=new Y(e.apiType),o=p.getGithubPagesData().publishPath;i.debug("准备取消发布，docPath=>",o);try{await l.deletePost(o)}catch(d){i.error("调用Github平台删除页面失败=>",d)}const n={[t.posidKey]:""},u=await r.getPageId();await s.setBlockAttrs(u,n),i.debug(e.apiType+"_Main取消发布,meta=>",n),a&&await y.initPage()}};return{publishData:d,publishMethods:h}})(a,{siyuanPageMethods:_,yamlMethods:ye,githubPagesMethods:ge,picgoPostMethods:ve,quickMethods:be,initPublishMethods:_e});return xe((()=>a.isReload),(async()=>{await _e.initPage(),f.debug(a.apiType+"_Main检测到设置更新操作，刷新页面")})),xe((()=>a.isMainReload),(async()=>{await _e.initPage(),f.debug(a.apiType+"_Main左右切换tab，刷新页面")})),Ye((async()=>{await _e.initPage()})),(e,t)=>{const l=i,f=o,w=s,P=n,T=u,V=d,$=r,I=c,E=p,L=Ze("font-awesome-icon"),A=g,R=m,B=y,x=h,Y=b;return Ue(),Oe("div",null,[Ne(we).isInitLoading?Fe("",!0):(Ue(),He(x,{key:0},{default:Ge((()=>[je(B,{class:"github-main"},{default:Ge((()=>[Ke("div",va,[Ne(v).etype!==Ne(Z).EditMode_source?(Ue(),He(l,{key:0,closable:!1,title:Ne(we).apiTypeInfo,class:"top-version-tip",type:"info"},null,8,["title"])):Fe("",!0),Ne(we).apiStatus||Ne(v).etype===Ne(Z).EditMode_source?Fe("",!0):(Ue(),He(l,{key:1,closable:!1,title:e.$t("main.publish.github.error.tip"),class:"top-version-tip",type:"error"},null,8,["title"]))]),Ke("div",wa,[je(R,{"label-width":"100px"},{default:Ge((()=>[Ne(v).etype!==Ne(Z).EditMode_source?(Ue(),Oe("div",_a,[je(w,{label:e.$t("main.title")},{default:Ge((()=>[je(f,{modelValue:Ne(k).title,"onUpdate:modelValue":t[0]||(t[0]=e=>Ne(k).title=e),disabled:!0},null,8,["modelValue"])])),_:1},8,["label"])])):Fe("",!0),Ke("div",ka,[je(w,{label:e.$t("main.publish.editmode")},{default:Ge((()=>[je(T,null,{default:Ge((()=>[je(P,{type:Ne(v).etype===Ne(Z).EditMode_simple?"primary":"default",onClick:t[1]||(t[1]=e=>Ne(_e).onEditModeChange(Ne(Z).EditMode_simple))},{default:Ge((()=>[ze(qe(e.$t("main.publish.editmode.simple")),1)])),_:1},8,["type"]),je(P,{type:Ne(v).etype===Ne(Z).EditMode_complex?"primary":"default",onClick:t[2]||(t[2]=e=>Ne(_e).onEditModeChange(Ne(Z).EditMode_complex))},{default:Ge((()=>[ze(qe(e.$t("main.publish.editmode.complex")),1)])),_:1},8,["type"]),je(P,{type:Ne(v).etype===Ne(Z).EditMode_source?"primary":"default",onClick:t[3]||(t[3]=e=>Ne(_e).onEditModeChange(Ne(Z).EditMode_source))},{default:Ge((()=>[ze(qe(e.$t("main.publish.editmode.source")),1)])),_:1},8,["type"])])),_:1})])),_:1},8,["label"])]),Ne(v).etype!==Ne(Z).EditMode_source?(Ue(),Oe("div",Ma,[Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),Oe("div",Pa,[je(w,{label:e.$t("main.force.refresh")},{default:Ge((()=>[je(V,{modelValue:Ne(k).forceRefresh,"onUpdate:modelValue":t[4]||(t[4]=e=>Ne(k).forceRefresh=e)},null,8,["modelValue"])])),_:1},8,["label"]),je(w,{label:e.$t("main.use.hash")},{default:Ge((()=>[je(V,{modelValue:Ne(k).slugHashEnabled,"onUpdate:modelValue":t[5]||(t[5]=e=>Ne(k).slugHashEnabled=e)},null,8,["modelValue"]),Ne(k).slugHashEnabled?Fe("",!0):(Ue(),He(l,{key:0,closable:!1,title:e.$t("main.use.hash.tip"),type:"warning"},null,8,["title"]))])),_:1},8,["label"]),je(w,{label:e.$t("main.slug")},{default:Ge((()=>[je(f,{modelValue:Ne(k).customSlug,"onUpdate:modelValue":t[6]||(t[6]=e=>Ne(k).customSlug=e)},null,8,["modelValue"])])),_:1},8,["label"]),je(w,null,{default:Ge((()=>[je(P,{loading:Ne(k).isSlugLoading,class:"make-slug-btn",type:"primary",onClick:Ne(M).makeSlug},{default:Ge((()=>[ze(qe(Ne(k).isSlugLoading?e.$t("main.opt.loading"):e.$t("main.auto.fetch.slug")),1)])),_:1},8,["loading","onClick"])])),_:1})])):Fe("",!0),Ke("div",Ta,[Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:0,label:e.$t("main.desc")},{default:Ge((()=>[je(f,{modelValue:Ne(C).desc,"onUpdate:modelValue":t[7]||(t[7]=e=>Ne(C).desc=e),autosize:{minRows:3,maxRows:16},type:"textarea"},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:1},{default:Ge((()=>[je(P,{loading:Ne(C).isDescLoading,type:"primary",onClick:Ne(D).makeDesc},{default:Ge((()=>[ze(qe(Ne(C).isDescLoading?e.$t("main.opt.loading"):e.$t("main.auto.fetch.desc")),1)])),_:1},8,["loading","onClick"])])),_:1})):Fe("",!0)]),Ke("div",Ca,[Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:0,label:e.$t("main.create.time")},{default:Ge((()=>[je($,{modelValue:Ne(S).created,"onUpdate:modelValue":t[8]||(t[8]=e=>Ne(S).created=e),placeholder:e.$t("main.create.time.placeholder"),format:"YYYY-MM-DD HH:mm:ss",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):Fe("",!0)]),Ke("div",Da,[Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:0,label:e.$t("main.tag.auto.switch")},{default:Ge((()=>[je(V,{modelValue:Ne(ue).tagSwitch,"onUpdate:modelValue":t[9]||(t[9]=e=>Ne(ue).tagSwitch=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),je(w,{label:e.$t("main.tag")},{default:Ge((()=>[(Ue(!0),Oe(Je,null,We(Ne(ue).tag.dynamicTags,(e=>(Ue(),He(I,{key:e,"disable-transitions":!1,class:"mx-1",closable:"",onClose:a=>Ne(de).tagHandleClose(e)},{default:Ge((()=>[ze(qe(e),1)])),_:2},1032,["onClose"])))),128)),Ne(ue).tag.inputVisible?(Ue(),He(f,{key:0,ref:"tagRefInput",modelValue:Ne(ue).tag.inputValue,"onUpdate:modelValue":t[10]||(t[10]=e=>Ne(ue).tag.inputValue=e),class:"ml-1 w-20",size:"small",onBlur:Ne(de).tagHandleInputConfirm,onKeyup:Qe(Ne(de).tagHandleInputConfirm,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(Ue(),He(P,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Ne(de).tagShowInput},{default:Ge((()=>[ze(qe(e.$t("main.tag.new")),1)])),_:1},8,["onClick"]))])),_:1},8,["label"]),Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:1},{default:Ge((()=>[je(P,{loading:Ne(ue).isTagLoading,type:"primary",onClick:Ne(de).fetchTag},{default:Ge((()=>[ze(qe(Ne(ue).isTagLoading?e.$t("main.opt.loading"):e.$t("main.auto.fetch.tag")),1)])),_:1},8,["loading","onClick"])])),_:1})):Fe("",!0)]),Ke("div",Sa,[je(w,{label:e.$t("main.publish.github")},{default:Ge((()=>[je(V,{modelValue:Ne(pe).githubEnabled,"onUpdate:modelValue":t[11]||(t[11]=e=>Ne(pe).githubEnabled=e),onChange:Ne(ge).githubOnChange},null,8,["modelValue","onChange"]),Ne(pe).githubEnabled?Fe("",!0):(Ue(),He(l,{key:0,closable:!1,title:e.$t("main.publish.github.no.tip"),type:"warning"},null,8,["title"]))])),_:1},8,["label"]),Ne(pe).githubEnabled?(Ue(),Oe("div",Va,[Ne(we).isPublished?Fe("",!0):(Ue(),He(w,{key:0,label:e.$t("main.publish.github.choose.path.use.default")},{default:Ge((()=>[je(V,{modelValue:Ne(pe).useDefaultPath,"onUpdate:modelValue":t[12]||(t[12]=e=>Ne(pe).useDefaultPath=e),onChange:Ne(ge).defaultPathOnChange},null,8,["modelValue","onChange"]),Ne(pe).useDefaultPath?(Ue(),He(l,{key:0,closable:!1,title:e.$t("main.publish.github.choose.path.use.default.tip")+Ne(pe).currentDefaultPath,type:"info"},null,8,["title"])):Fe("",!0)])),_:1},8,["label"])),Ne(pe).useDefaultPath||Ne(we).isPublished?Fe("",!0):(Ue(),He(w,{key:1,label:e.$t("main.publish.github.choose.path")},{default:Ge((()=>[je(E,{modelValue:Ne(pe).customPath,"onUpdate:modelValue":t[13]||(t[13]=e=>Ne(pe).customPath=e),"check-strictly":!0,"empty-text":e.$t("main.cat.empty"),load:Ne(ge).customLoad,"no-data-text":e.$t("main.cat.empty"),placeholder:e.$t("main.cat.select"),props:Ne(pe).path.customProps,lazy:"",style:{width:"100%"},onNodeClick:Ne(ge).onSelectChange},null,8,["modelValue","empty-text","load","no-data-text","placeholder","props","onNodeClick"])])),_:1},8,["label"])),Ne(we).isPublished?Fe("",!0):(Ue(),He(w,{key:2,label:e.$t("main.publish.github.choose.title")},{default:Ge((()=>[je(f,{modelValue:Ne(pe).mdTitle,"onUpdate:modelValue":t[14]||(t[14]=e=>Ne(pe).mdTitle=e),onChange:Ne(ge).onFilenameChange,disabled:Ne(M).isSlugEmpty()},null,8,["modelValue","onChange","disabled"])])),_:1},8,["label"])),je(w,{label:e.$t("main.publish.github.published.path")},{default:Ge((()=>[je(f,{modelValue:Ne(pe).publishPath,"onUpdate:modelValue":t[15]||(t[15]=e=>Ne(pe).publishPath=e),disabled:!0},null,8,["modelValue"])])),_:1},8,["label"])])):Fe("",!0)])])):Fe("",!0),Ne(v).etype===Ne(Z).EditMode_complex?(Ue(),Oe("div",$a,[je(w,{label:e.$t("github.use.permalink")},{default:Ge((()=>[je(V,{modelValue:Ne(pe).usePermalink,"onUpdate:modelValue":t[16]||(t[16]=e=>Ne(pe).usePermalink=e),onChange:Ne(ge).permalinkOnChange},null,8,["modelValue","onChange"]),Ne(pe).usePermalink?Fe("",!0):(Ue(),He(l,{key:0,closable:!1,title:e.$t("github.use.permalink.no.warn"),type:"warning"},null,8,["title"]))])),_:1},8,["label"]),je(w,{label:e.$t("github.menu.title")},{default:Ge((()=>[je(f,{modelValue:Ne(pe).linkTitle,"onUpdate:modelValue":t[17]||(t[17]=e=>Ne(pe).linkTitle=e),placeholder:e.$t("github.menu.title.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),je(w,{label:e.$t("github.weight")},{default:Ge((()=>[je(f,{modelValue:Ne(pe).weight,"onUpdate:modelValue":t[18]||(t[18]=e=>Ne(pe).weight=e),placeholder:e.$t("github.weight.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),je(w,{label:e.$t("github.use.date")},{default:Ge((()=>[je(V,{modelValue:Ne(pe).useDate,"onUpdate:modelValue":t[19]||(t[19]=e=>Ne(pe).useDate=e),onChange:Ne(ge).showDateOnChange},null,8,["modelValue","onChange"]),Ne(pe).useDate?Fe("",!0):(Ue(),He(l,{key:0,closable:!1,title:e.$t("github.use.date.no.warn"),type:"warning"},null,8,["title"]))])),_:1},8,["label"])])):Fe("",!0),Ne(v).etype!==Ne(Z).EditMode_source?(Ue(),Oe("div",Ia,[Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:0,label:e.$t("main.opt.quick")},{default:Ge((()=>[je(P,{loading:Ne(he).isGenLoading,type:"primary",onClick:Ne(be).oneclickAttr},{default:Ge((()=>[ze(qe(Ne(he).isGenLoading?e.$t("main.opt.loading"):e.$t("main.publish.oneclick.attr")),1)])),_:1},8,["loading","onClick"])])),_:1},8,["label"])):Fe("",!0),Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:1},{default:Ge((()=>[je(P,{type:"primary",onClick:Ne(_e).saveAttrToSiyuanWithInit},{default:Ge((()=>[ze(qe(e.$t("main.save.attr.to.siyuan")),1)])),_:1},8,["onClick"])])),_:1})):Fe("",!0),Ne(v).etype!==Ne(Z).EditMode_simple?(Ue(),He(w,{key:2},{default:Ge((()=>[je(P,{type:"primary",onClick:t[20]||(t[20]=e=>Ne(_e).onEditModeChange(Ne(Z).EditMode_source))},{default:Ge((()=>[ze(qe(e.$t("main.siyuan.to.yaml")),1)])),_:1})])),_:1})):Fe("",!0)])):Fe("",!0),Ne(pe).githubEnabled&&Ne(v).etype!==Ne(Z).EditMode_source?(Ue(),Oe("div",Ea,[je(w,{label:e.$t("github.post.picgo.use")},{default:Ge((()=>[je(V,{modelValue:Ne(fe).picgoEnabled,"onUpdate:modelValue":t[21]||(t[21]=e=>Ne(fe).picgoEnabled=e),onChange:Ne(ve).picgoOnChange},null,8,["modelValue","onChange"]),Ne(fe).picgoEnabled&&!Ne(re)()?(Ue(),He(A,{key:0,content:e.$t("siyuan.browser.menu.picture.btn"),class:"box-item",effect:"light",placement:"right","popper-class":"publish-menu-tooltip"},{default:Ge((()=>[je(P,{class:"pic-manage-btn",type:"success",size:"small",onClick:t[22]||(t[22]=e=>Ne(ve).handlePicgoManage(Ne(_).getPageId()))},{default:Ge((()=>[je(L,{icon:"fa-solid fa-image"}),ze(" "+qe(e.$t("setting.picgo.manage")),1)])),_:1})])),_:1},8,["content"])):Fe("",!0),Ne(fe).picgoEnabled?(Ue(),He(l,{key:1,closable:!1,title:e.$t("github.post.picgo.use.tip"),type:"warning"},null,8,["title"])):Fe("",!0)])),_:1},8,["label"]),je(w,null,{default:Ge((()=>[je(P,{loading:Ne(ke).isPublishLoading,type:"primary",onClick:Ne(Me).doPublish},{default:Ge((()=>[ze(qe(Ne(ke).isPublishLoading?e.$t("main.publish.loading"):Ne(we).isPublished?e.$t("main.update"):e.$t("main.publish")),1)])),_:1},8,["loading","onClick"]),Ne(we).isPublished?(Ue(),He(P,{key:0,loading:Ne(ke).isCancelLoading,onClick:Ne(Me).cancelPublish},{default:Ge((()=>[ze(qe(e.$t("main.cancel")),1)])),_:1},8,["loading","onClick"])):Fe("",!0)])),_:1})])):Fe("",!0),Ne(pe).githubEnabled&&Ne(v).etype!==Ne(Z).EditMode_source&&Ne(we).apiStatus?(Ue(),Oe("div",La,[je(w,{class:"publish-status-box"},{default:Ge((()=>[je(P,{class:"publish-text-btn",disabled:"",text:"",type:"danger"},{default:Ge((()=>[ze(qe(Ne(we).isPublished?e.$t("main.publish.status.published"):e.$t("main.publish.status.unpublish")),1)])),_:1}),Ne(we).isPublished?(Ue(),Oe("a",{key:0,href:Ne(we).previewMdUrl,title:Ne(we).previewMdUrl,target:"_blank"},qe(e.$t("main.publish.see.md.preview")),9,Aa)):Fe("",!0)])),_:1}),Ne(we).isPublished?(Ue(),He(w,{key:0,class:"publish-status-box"},{default:Ge((()=>[Ke("img",{src:Ne(we).mdStatusUrl,alt:"md-build-status",class:"publish-build-status-icon"},null,8,Ra),Ke("a",{href:Ne(we).previewUrl,title:Ne(we).previewUrl,target:"_blank"},qe(e.$t("main.publish.see.real.preview")),9,Ba)])),_:1})):Fe("",!0)])):Fe("",!0),Ne(v).etype===Ne(Z).EditMode_source?(Ue(),Oe("div",xa,[je(w,null,{default:Ge((()=>[je(l,{closable:!1,title:Ne(ce)(a.apiType)+" "+e.$t("main.yaml.formatter"),class:"top-yaml-tip",type:"info"},null,8,["title"])])),_:1}),Ne(v).etype.toString()!==Ne(Z).EditMode_simple.toString()?(Ue(),He(w,{key:0,label:Ne(me).readMode?e.$t("main.read.mode"):e.$t("main.edit.mode")},{default:Ge((()=>[je(V,{modelValue:Ne(me).readMode,"onUpdate:modelValue":t[23]||(t[23]=e=>Ne(me).readMode=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),Ke("div",Ya,[je(w,null,{default:Ge((()=>[Ke("a",{class:Xe({current:Ne(v).stype===Ne(ee).YAML}),onClick:t[24]||(t[24]=e=>Ne(_e).onYamlShowTypeChange(Ne(ee).YAML))},qe(e.$t("yaml.show.type.yaml")),3),Ke("a",{class:Xe({current:Ne(v).stype===Ne(ee).CONTENT,middle:!0}),onClick:t[25]||(t[25]=e=>Ne(_e).onYamlShowTypeChange(Ne(ee).CONTENT))},qe(e.$t("yaml.show.type.md")),3),Ke("a",{class:Xe({current:Ne(v).stype===Ne(ee).YAML_CONTENT,middle:!0}),onClick:t[26]||(t[26]=e=>Ne(_e).onYamlShowTypeChange(Ne(ee).YAML_CONTENT))},qe(e.$t("yaml.show.type.yamlmd")),3),Ke("a",{class:Xe({current:Ne(v).stype===Ne(ee).HTML_CONTENT}),onClick:t[27]||(t[27]=e=>Ne(_e).onYamlShowTypeChange(Ne(ee).HTML_CONTENT))},qe(e.$t("yaml.show.type.html")),3)])),_:1})]),Ne(me).readMode?(Ue(),Oe("div",Ua,[je(w,null,{default:Ge((()=>[je(f,{id:"yaml-detail-preview",modelValue:Ne(me).yamlPreviewContent,"onUpdate:modelValue":t[28]||(t[28]=e=>Ne(me).yamlPreviewContent=e),autosize:{minRows:4,maxRows:16},readonly:"",type:"textarea",onClick:Ne(ye).onYamlContentFocus,onContextmenu:Ne(ye).onYamlContextMenu},null,8,["modelValue","onClick","onContextmenu"])])),_:1})])):Fe("",!0),Ne(me).readMode?Fe("",!0):(Ue(),Oe("div",Oa,[je(w,null,{default:Ge((()=>[je(f,{modelValue:Ne(me).yamlContent,"onUpdate:modelValue":t[29]||(t[29]=e=>Ne(me).yamlContent=e),autosize:{minRows:4,maxRows:16},type:"textarea",onInput:Ne(ye).onYamlContentInput},null,8,["modelValue","onInput"])])),_:1})])),Ne(me).readMode?Fe("",!0):(Ue(),Oe("div",Na,[je(w,null,{default:Ge((()=>[je(P,{type:"primary",onClick:Ne(_e).convertYAMLToAttr},{default:Ge((()=>[ze(qe(e.$t("main.yaml.to.siyuan")),1)])),_:1},8,["onClick"]),je(P,{type:"primary",onClick:t[30]||(t[30]=e=>Ne(ye).copyYamlToClipboard())},{default:Ge((()=>[ze(qe(e.$t("main.copy")),1)])),_:1})])),_:1})])),Ke("div",Ha,[je(w,null,{default:Ge((()=>[je(l,{closable:!1,title:e.$t("main.read.mode.tip"),type:"info"},null,8,["title"])])),_:1})])])):Fe("",!0)])),_:1})])])),_:1})])),_:1})),je(Y,{loading:Ne(we).isInitLoading,rows:5,animated:""},null,8,["loading"])])}}}),[["__scopeId","data-v-cb21efa9"]]),ja=Be({__name:"VuepressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_VUEPRESS),l=new me,i=Re(l);return(e,l)=>(Ue(),He(Ga,{"is-reload":a.isReload,"is-main-reload":a.isMainReload,"api-type":t.value,"page-id":a.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Ka=Be({__name:"HugoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_HUGO),l=new ye,i=Re(l);return(e,l)=>(Ue(),He(Ga,{"is-reload":a.isReload,"is-main-reload":a.isMainReload,"api-type":t.value,"page-id":a.pageId,"yaml-converter":i.value},null,8,["is-reload","is-main-reload","api-type","page-id","yaml-converter"]))}}),Fa=Be({__name:"HexoMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_HEXO),l=new he,i=Re(l);return(e,l)=>(Ue(),He(Ga,{"api-type":t.value,"is-reload":a.isReload,"is-main-reload":a.isMainReload,"page-id":a.pageId,"yaml-converter":i.value},null,8,["api-type","is-reload","is-main-reload","page-id","yaml-converter"]))}}),za=Be({__name:"JekyllMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_JEKYLL),l=new be,i=Re(l);return(e,l)=>(Ue(),He(Ga,{"is-reload":a.isReload,"api-type":t.value,"is-main-reload":a.isMainReload,"page-id":a.pageId,"yaml-converter":i.value},null,8,["is-reload","api-type","is-main-reload","page-id","yaml-converter"]))}}),qa={class:"form-post-title"},Ja=["href","title"],Wa=pe(Be({__name:"MetaweblogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},apiType:{type:String,default:""},useAdaptor:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,w=P.getLogger("components/publish/tab/main/MetaweblogMain.vue"),_=new E,{t:k}=ta(),M=Re(""),C=Re(k("setting.blog.platform.support.metaweblog")+a.apiType+" "),V=Re(!1),I=new ia,L=new ya,{picgoPostData:A,picgoPostMethods:R}=fa(),N=Re(!1),J=Re(!1),Q=Re(!1),X=Re(!1),Z=Re(!1),ee=Re(!1),le=Re(!1),ie=Re(!1),se=Re(!1),ne=Re(!1),ue=Re(!1),de=Re(""),ce=Re(!1),pe=Ae({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:[],categoryList:[]},categories:["默认分类"]}),me=Ae({pageId:"",meta:{tags:""}}),ye=()=>{ie.value=!1},he=()=>{ie.value=!0},be=async()=>{var e;le.value=!0;const l=await F(!0,a.pageId);if(!l||""===l)return;const i=x(a.apiType);fe(i)||(M.value=i.blogName);const o=T();ne.value=!0,me.pageId=l,me.meta=await _.getBlockAttrs(l);const s=await _.getBlockByID(l);if(!s)throw le.value=!1,t.error(k("config.error.msg")+"_"+a.apiType),new Error(k("config.error.msg")+"_"+a.apiType);w.debug("MetaweblogMain初始化页面,meta=>",me.meta);let n=s.content;o.fixTitle&&(n=B(s.content)),pe.title=n,pe.customSlug=me.meta[sa],pe.desc=me.meta[na],pe.created=K(s.created),pe.tag.dynamicTags=[];const u=(me.meta.tags||"").split(",");for(let a=0;a<u.length;a++){""!==u[a]&&pe.tag.dynamicTags.push(u[a])}o.autoTag&&0===pe.tag.dynamicTags.length&&(ce.value=!0),A.picgoEnabled=o.usePicgo,ue.value=oe(a.apiType,me.meta);const d=x(a.apiType),r=new Y(a.apiType);let c=[];if(ue.value){const a=me.meta;pe.postid=a[d.posidKey],de.value=await r.getPreviewUrl(null==(e=null==pe?void 0:pe.postid)?void 0:e.toString());try{const e=await r.getPost(pe.postid.toString());c=e.categories,w.debug("postid=>",pe.postid),w.debug("post=>",e),w.debug("初始化选择过的分类,catData=>",c)}catch(m){t.error(k("post.delete.by.platform")),le.value=!1,w.error("文章新获取失败",m)}}else{w.warn("检测到之前发布异常，清空文章ID");const e={[W(a.apiType).posidKey]:""};await _.setBlockAttrs(me.pageId,e)}let p=[];try{p=await r.getCategories()}catch(m){le.value=!1,w.error(k("main.cat.list.error"),m)}const g=[];p&&p.length&&p.length>0&&(p.forEach((e=>{const a={value:e.description,label:e.description};g.push(a)})),pe.cat.categoryList=g),pe.cat.categorySelected=c,pe.categories=c,V.value=i.apiStatus,le.value=!1};Ye((async()=>{await be()}));const ke=async e=>{if(!($(pe.customSlug)||se.value||(w.debug(k("main.force.refresh.tip")),0)))return;N.value=!0;const a=await _.getBlockByID(me.pageId);w.debug("page=>",a);let l=a.content;if(l.indexOf(".")>-1&&(l=l.replace(/\d*\./g,"")),w.debug("fmtTitle=>",l),pe.checkList.length>0){const e=await S(l);w.debug("result=>",e),e?pe.customSlug=e:t.success(k("main.opt.failure"))}else pe.customSlug=D(l);if(ne.value){const e=a.content+(new Date).toISOString(),t="-"+aa(e).toLowerCase();pe.customSlug+=t}N.value=!1,!0!==e&&t.success(k("main.opt.success"))},Me=async e=>{J.value=!0;const a=(await _.exportMdContent(me.pageId)).content,l=ve(a);pe.desc=j(l,U.MAX_PREVIEW_LENGTH,!0),J.value=!1,!0!==e&&t.success(k("main.opt.success"))},Pe=Re(),Te=()=>{pe.tag.inputVisible=!0,ea((()=>{Pe.value.focus()}))},Ce=()=>{pe.tag.inputValue&&pe.tag.dynamicTags.push(pe.tag.inputValue),pe.tag.inputVisible=!1,pe.tag.inputValue=""};async function De(e){if(!ce.value)return void t.warning(k("main.tag.auto.switch.no.tip"));Q.value=!0;const a=(await _.exportMdContent(me.pageId)).content,l=await z(a);w.debug("genTags=>",l);const i=q(l,5);w.debug("hotTags=>",i);for(let t=0;t<i.length;t++)pe.tag.dynamicTags.includes(i[t])||pe.tag.dynamicTags.push(i[t]);Q.value=!1,!0!==e&&t.success(k("main.opt.success"))}const Se=async e=>{const a={[sa]:pe.customSlug,[na]:pe.desc,tags:pe.tag.dynamicTags.join(",")};await _.setBlockAttrs(me.pageId,a),w.debug("MetaweblogMain保存属性到思源笔记,meta=>",a),!0!==e&&(await be(),t.success(k("main.opt.success")))},Ve=(e,a,t,l)=>{},$e=(e,a)=>{const t=[];a.checkedKeys.forEach((e=>{t.push(e.toString())})),pe.categories=t,w.debug(" formData.categories=>",pe.categories)},Ie=async e=>{X.value=!0,await ke(!0),await Me(!0),await De(!0),await Se(!0),w.debug("发布属性完成"),X.value=!1,!0!==e&&t.success(k("main.publish.oneclick.attr.finish"))},Ee=async()=>{if(V.value){Z.value=!0;try{await Ie(!0);const e=x(a.apiType),l=new Y(a.apiType),i=T();let o;let s=(await _.exportMdContent(me.pageId)).content;if(s=await L.convertSiyuanLinkToPlatformLink(s,l),R.getPicgoPostData().picgoEnabled){const e=await I.uploadPostImagesToBed(me.pageId,me.meta,s);e.hasImages&&(e.flag?s=e.mdContent:t.error(k("github.post.picgo.picbed.error")+"=>"+e.errmsg))}if(we.Html===e.pageType){const e=H(s);o=_e(e),i.removeH1&&(o=G(o))}else o=ae(s),i.removeH1&&(o=te(o));const n=new O;n.title=pe.title,n.wp_slug=pe.customSlug,n.description=o,n.categories=pe.categories,n.mt_keywords=pe.tag.dynamicTags.join(","),a.apiType===ge.API_TYPE_CNBLOGS&&n.categories.push("[Markdown]"),n.dateCreated=new Date;const u=!0;let d;if(ue.value){d=pe.postid;if(!(await l.editPost(d,n,!0)))throw t.error("文章更新失败"),new Error("文章更新失败=>"+d);w.debug("文章已更新，postid=>",d)}else{d=await l.newPost(n,u),w.debug("当前保存的posidKey=>",e.posidKey);const a={[e.posidKey]:d};await _.setBlockAttrs(me.pageId,a),w.debug("MetaweblogMain发布成功，保存postid,meta=>",a),w.info("文章发布成功，postid=>",d)}await be(),t.success(k("main.opt.success"))}catch(e){Z.value=!1,w.error("发布异常",e),t.error({dangerouslyUseHTMLString:!0,message:k("main.opt.failure")+"=>"+e})}Z.value=!1}else t.error(k("setting.blog.vali.tip.metaweblog"))},Le=async()=>{ee.value=!0,l.confirm(k("main.opt.warning.tip"),k("main.opt.warning"),{confirmButtonText:k("main.opt.ok"),cancelButtonText:k("main.opt.cancel"),type:"warning"}).then((async()=>{await Be(!0),ee.value=!1,t.warning(k("main.opt.status.cancel"))})).catch((e=>{throw t({type:"error",message:k("main.opt.failure")}),ee.value=!1,new Error(e)}))},Be=async e=>{const l=x(a.apiType);w.debug("准备取消发布，postid=>",pe.postid);const i={[l.posidKey]:""};await _.setBlockAttrs(me.pageId,i),w.debug("MetaweblogMain取消发布,meta=>",i);try{const e=new Y(a.apiType);await e.deletePost(pe.postid)||t.error("文章删除失败")}catch(o){w.error("强行删除一次",o)}e&&await be()};return xe((()=>a.isReload),(async()=>{await be(),w.debug(a.apiType+"_Main检测到设置更新操作，刷新页面")})),xe((()=>a.isMainReload),(async()=>{await be(),w.debug(a.apiType+"_Main左右切换tab，刷新页面")})),(a,t)=>{const l=i,w=o,_=s,k=n,P=u,T=d,D=f,S=v,$=r,I=c,E=p,L=Ze("font-awesome-icon"),B=g,x=m,Y=y,U=b,O=h;return Ue(),He(O,null,{default:Ge((()=>[le.value?Fe("",!0):(Ue(),He(Y,{key:0,class:"blog-main"},{default:Ge((()=>[je(l,{class:"top-version-tip",title:C.value+M.value,type:"info",closable:!1},null,8,["title"]),V.value?Fe("",!0):(Ue(),He(l,{key:0,class:"top-version-tip",title:a.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),e.useAdaptor?(Ue(),He(l,{key:1,class:"top-version-tip",title:a.$t("setting.conf.tip"),type:"info",closable:!1},null,8,["title"])):Fe("",!0),je(x,{"label-width":"120px"},{default:Ge((()=>[Ke("div",qa,[je(_,{label:a.$t("main.title")},{default:Ge((()=>[je(w,{modelValue:pe.title,"onUpdate:modelValue":t[0]||(t[0]=e=>pe.title=e),disabled:!0},null,8,["modelValue"])])),_:1},8,["label"])]),je(_,{label:a.$t("main.publish.editmode")},{default:Ge((()=>[je(P,null,{default:Ge((()=>[je(k,{type:ie.value?"default":"primary",onClick:ye},{default:Ge((()=>[ze(qe(a.$t("main.publish.editmode.simple")),1)])),_:1},8,["type"]),je(k,{type:ie.value?"primary":"default",onClick:he},{default:Ge((()=>[ze(qe(a.$t("main.publish.editmode.complex")),1)])),_:1},8,["type"])])),_:1})])),_:1},8,["label"]),ie.value?(Ue(),He(_,{key:0,label:a.$t("main.force.refresh")},{default:Ge((()=>[je(T,{modelValue:se.value,"onUpdate:modelValue":t[1]||(t[1]=e=>se.value=e)},null,8,["modelValue"]),se.value?Fe("",!0):(Ue(),He(l,{key:0,title:a.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(_,{key:1,label:a.$t("main.slug")},{default:Ge((()=>[je(w,{modelValue:pe.customSlug,"onUpdate:modelValue":t[2]||(t[2]=e=>pe.customSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(_,{key:2},{default:Ge((()=>[je(S,{modelValue:pe.checkList,"onUpdate:modelValue":t[3]||(t[3]=e=>pe.checkList=e)},{default:Ge((()=>[je(D,{label:"1"},{default:Ge((()=>[ze(qe(a.$t("main.use.google.translate")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(_,{key:3},{default:Ge((()=>[je(k,{type:"primary",class:"make-slug-btn",onClick:ke,loading:N.value},{default:Ge((()=>[ze(qe(N.value?a.$t("main.opt.loading"):a.$t("main.auto.fetch.slug")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(_,{key:4,label:a.$t("main.use.hash")},{default:Ge((()=>[je(T,{modelValue:ne.value,"onUpdate:modelValue":t[4]||(t[4]=e=>ne.value=e)},null,8,["modelValue"]),ne.value?Fe("",!0):(Ue(),He(l,{key:0,title:a.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(_,{key:5,label:a.$t("main.desc")},{default:Ge((()=>[je(w,{type:"textarea",modelValue:pe.desc,"onUpdate:modelValue":t[5]||(t[5]=e=>pe.desc=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(_,{key:6},{default:Ge((()=>[je(k,{type:"primary",onClick:Me,loading:J.value},{default:Ge((()=>[ze(qe(J.value?a.$t("main.opt.loading"):a.$t("main.auto.fetch.desc")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(_,{key:7,label:a.$t("main.create.time")},{default:Ge((()=>[je($,{type:"datetime",modelValue:pe.created,"onUpdate:modelValue":t[6]||(t[6]=e=>pe.created=e),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:a.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(_,{key:8,label:a.$t("main.tag.auto.switch")},{default:Ge((()=>[je(T,{modelValue:ce.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ce.value=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),je(_,{label:a.$t("main.tag")},{default:Ge((()=>[(Ue(!0),Oe(Je,null,We(pe.tag.dynamicTags,(e=>(Ue(),He(I,{key:e,class:"mx-1",closable:"","disable-transitions":!1,onClose:a=>(e=>{pe.tag.dynamicTags.splice(pe.tag.dynamicTags.indexOf(e),1)})(e)},{default:Ge((()=>[ze(qe(e),1)])),_:2},1032,["onClose"])))),128)),pe.tag.inputVisible?(Ue(),He(w,{key:0,ref_key:"tagRefInput",ref:Pe,modelValue:pe.tag.inputValue,"onUpdate:modelValue":t[8]||(t[8]=e=>pe.tag.inputValue=e),class:"ml-1 w-20",size:"small",onKeyup:Qe(Ce,["enter"]),onBlur:Ce},null,8,["modelValue","onKeyup"])):(Ue(),He(k,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Te},{default:Ge((()=>[ze(qe(a.$t("main.tag.new")),1)])),_:1}))])),_:1},8,["label"]),ie.value?(Ue(),He(_,{key:9},{default:Ge((()=>[je(k,{type:"primary",onClick:De,loading:Q.value},{default:Ge((()=>[ze(qe(Q.value?a.$t("main.opt.loading"):a.$t("main.auto.fetch.tag")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),je(_,{label:a.$t("main.cat"),style:{width:"100%"}},{default:Ge((()=>[je(E,{style:{width:"100%"},modelValue:pe.cat.categorySelected,"onUpdate:modelValue":t[9]||(t[9]=e=>pe.cat.categorySelected=e),data:pe.cat.categoryList,multiple:"","tag-type":"info","check-on-click-node":!0,"render-after-expand":!1,"show-checkbox":"",placeholder:a.$t("main.cat.select"),"empty-text":a.$t("main.cat.empty"),"no-data-text":a.$t("main.cat.empty"),onNodeClick:Ve,onCheck:$e},null,8,["modelValue","data","placeholder","empty-text","no-data-text"])])),_:1},8,["label"]),ie.value?(Ue(),He(_,{key:10,label:a.$t("main.opt.quick")},{default:Ge((()=>[je(k,{type:"primary",onClick:Ie,loading:X.value},{default:Ge((()=>[ze(qe(X.value?a.$t("main.opt.loading"):a.$t("main.publish.oneclick.attr")),1)])),_:1},8,["loading"]),je(k,{type:"primary",onClick:Se},{default:Ge((()=>[ze(qe(a.$t("main.save.attr.to.siyuan")),1)])),_:1})])),_:1},8,["label"])):Fe("",!0),je(_,{label:a.$t("github.post.picgo.use")},{default:Ge((()=>[je(T,{modelValue:Ne(A).picgoEnabled,"onUpdate:modelValue":t[10]||(t[10]=e=>Ne(A).picgoEnabled=e),onChange:Ne(R).picgoOnChange},null,8,["modelValue","onChange"]),Ne(A).picgoEnabled&&!Ne(re)()?(Ue(),He(B,{key:0,content:a.$t("siyuan.browser.menu.picture.btn"),class:"box-item",effect:"light",placement:"right","popper-class":"publish-menu-tooltip"},{default:Ge((()=>[je(k,{class:"pic-manage-btn",type:"success",size:"small",onClick:t[11]||(t[11]=e=>Ne(R).handlePicgoManage(me.pageId))},{default:Ge((()=>[je(L,{icon:"fa-solid fa-image"}),ze(" "+qe(a.$t("setting.picgo.manage")),1)])),_:1})])),_:1},8,["content"])):Fe("",!0),Ne(A).picgoEnabled?(Ue(),He(l,{key:1,closable:!1,title:a.$t("github.post.picgo.use.tip"),type:"warning"},null,8,["title"])):Fe("",!0)])),_:1},8,["label"]),je(_,{label:""},{default:Ge((()=>[je(k,{type:"primary",onClick:Ee,loading:Z.value},{default:Ge((()=>[ze(qe(Z.value?a.$t("main.publish.loading"):ue.value?a.$t("main.update"):a.$t("main.publish")),1)])),_:1},8,["loading"]),ue.value?(Ue(),He(k,{key:0,loading:ee.value,onClick:Le},{default:Ge((()=>[ze(qe(a.$t("main.cancel")),1)])),_:1},8,["loading"])):Fe("",!0)])),_:1}),je(_,null,{default:Ge((()=>[je(k,{type:"danger",text:"",disabled:""},{default:Ge((()=>[ze(qe(ue.value?a.$t("main.publish.status.published"):a.$t("main.publish.status.unpublish")),1)])),_:1}),ue.value?(Ue(),Oe("a",{key:0,href:de.value,title:de.value,target:"_blank"},qe(a.$t("main.publish.see.preview")),9,Ja)):Fe("",!0)])),_:1})])),_:1})])),_:1})),je(U,{loading:le.value,rows:5,animated:""},null,8,["loading"])])),_:1})}}}),[["__scopeId","data-v-50a0a125"]]),Qa=Be({__name:"JVueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_JVUE);return(e,l)=>(Ue(),He(Wa,{"api-type":t.value,"is-main-reload":a.isMainReload,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),Xa=Be({__name:"ConfluenceMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_CONFLUENCE);return(e,l)=>(Ue(),He(Wa,{"is-main-reload":a.isMainReload,"is-reload":a.isReload,"api-type":t.value,"use-adaptor":!0,"page-id":a.pageId},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),Za=Be({__name:"CnblogsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_CNBLOGS);return(e,l)=>(Ue(),He(Wa,{"api-type":t.value,"is-main-reload":a.isMainReload,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),et=Be({__name:"WordpressMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_WORDPRESS);return(e,l)=>(Ue(),He(Wa,{"api-type":t.value,"is-main-reload":a.isMainReload,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),at={class:"form-post-title"},tt=["href","title"],lt=pe(Be({__name:"CommonBlogMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},useCat:{type:Boolean,default:!1},apiType:{type:String,default:""},cfg:{type:ke,default:null},pageId:{type:String,default:void 0},limitRate:{type:Boolean,default:!1},limitSeconds:{type:Number,default:5},imageToBase64:{type:Boolean,default:!1},removeImage:{type:Boolean,default:!1}},setup(e){const a=e,p=P.getLogger("components/publish/tab/main/CommonBlogMain.vue"),k=new E,M=new oa,V=new ya,{t:I}=ta(),L=Re(""),A=Re(I("setting.blog.platform.support.common")+a.apiType+" "),R=Re(!1),N=new ia,J=Re(!1),W=Re(!1),Q=Re(!1),X=Re(!1),Z=Re(!1),ee=Re(!1),le=Re(!1),ie=Re(!1),se=Re(!1),ne=Re(!1),ue=Re(!1),de=Re(""),ce=Re(!1),pe=Re(!1),{picgoPostData:ge,picgoPostMethods:me}=fa(),ye=Ae({postid:"",title:"",customSlug:"",desc:"",created:"",checkList:["1"],tag:{inputValue:"",dynamicTags:[],inputVisible:!1},cat:{categorySelected:"",categoryList:[]},categories:["默认分类"],cat_slugs:[]}),he=Ae({pageId:"",meta:{tags:""}}),be=()=>{ie.value=!1},ke=()=>{ie.value=!0},Te=async()=>{le.value=!0;const e=await F(!0,a.pageId);if(!e||""===e)return;const l=x(a.apiType);fe(l)||(L.value=l.blogName||"");const i=T();let o;ne.value=!0,he.pageId=e,he.meta=await k.getBlockAttrs(e);try{o=await k.getBlockByID(e)}catch(g){throw le.value=!1,p.error("页面信息获取失败",g),new Error("页面信息获取失败")}if(!o)throw le.value=!1,t.error(I("config.error.msg")+"_"+a.apiType),new Error(I("config.error.msg")+"_"+a.apiType);p.debug("CommonblogMain初始化页面,meta=>",he.meta);let s=o.content;i.fixTitle&&(s=B(o.content)),ye.title=s,ye.customSlug=he.meta[sa],ye.desc=he.meta[na],ye.created=K(o.created),ye.tag.dynamicTags=[];const n=(he.meta.tags||"").split(",");for(let a=0;a<n.length;a++){""!==n[a]&&ye.tag.dynamicTags.push(n[a])}i.autoTag&&0===ye.tag.dynamicTags.length&&(ce.value=!0),ge.picgoEnabled=i.usePicgo,ue.value=oe(a.apiType,he.meta),pe.value=!ue.value;const u=x(a.apiType),d=new Y(a.apiType);let r=[],c=[];if(ue.value){const e=he.meta;if(ye.postid=e[u.posidKey||""],de.value=await d.getPreviewUrl(ye.postid.toString()),a.useCat)try{const e=await d.getPost(ye.postid.toString());r=e.categories,c=e.cate_slugs,p.debug("postid=>",ye.postid),p.debug("post=>",e),p.debug("初始化选择过的分类,catData=>",r)}catch(g){t.error(I("post.delete.by.platform")),le.value=!1,p.error("平台文章新获取失败",g)}}else if(a.useCat&&!$(u.blogName)){const e=[],a=[];e.push(u.blogName),r=e,a.push(u.blogid),c=a}if(a.useCat){let e=[];try{e=await d.getCategories()}catch(g){le.value=!1,p.error(I("main.cat.list.error"),g)}const a=[];e&&e.length&&e.length>0&&(e.forEach((e=>{const t={value:e.categoryId,label:e.description};a.push(t)})),ye.cat.categoryList=a),ye.cat.categorySelected=r.length>0?r[0]:"",L.value=ye.cat.categorySelected,ye.categories=r,ye.cat_slugs=c}R.value=l.apiStatus||!1,le.value=!1};Ye((async()=>{await Te()}));const Ce=async e=>{if(!($(ye.customSlug)||se.value||(p.debug(I("main.force.refresh.tip")),0)))return;J.value=!0;const a=await k.getBlockByID(he.pageId);p.debug("page=>",a);let l=a.content;if(l.indexOf(".")>-1&&(l=l.replace(/\d*\./g,"")),p.debug("fmtTitle=>",l),ye.checkList.length>0){const e=await S(l);p.debug("result=>",e),e?ye.customSlug=e:t.success(I("main.opt.failure"))}else ye.customSlug=D(l);if(ne.value){const e=a.content+(new Date).toISOString(),t="-"+aa(e).toLowerCase();ye.customSlug+=t}J.value=!1,!0!==e&&t.success(I("main.opt.success"))},De=async e=>{W.value=!0;const a=(await k.exportMdContent(he.pageId)).content,l=ve(a);ye.desc=j(l,U.MAX_PREVIEW_LENGTH,!0),W.value=!1,!0!==e&&t.success(I("main.opt.success"))},Se=Re(),Ve=()=>{ye.tag.inputVisible=!0,ea((()=>{Se.value.focus()}))},$e=()=>{ye.tag.inputValue&&ye.tag.dynamicTags.push(ye.tag.inputValue),ye.tag.inputVisible=!1,ye.tag.inputValue=""};async function Ie(e){if(!ce.value)return void t.warning(I("main.tag.auto.switch.no.tip"));Q.value=!0;const a=(await k.exportMdContent(he.pageId)).content,l=await z(a);p.debug("genTags=>",l);const i=q(l,5);p.debug("hotTags=>",i);for(let t=0;t<i.length;t++)ye.tag.dynamicTags.includes(i[t])||ye.tag.dynamicTags.push(i[t]);Q.value=!1,!0!==e&&t.success(I("main.opt.success"))}const Ee=e=>{p.debug("val=>",e);const t=x(a.apiType),l=[],i=[];l.push(e.label),ye.categories=l,i.push(t.username+"/"+e.value),ye.cat_slugs=i,L.value=e.label,p.debug(" formData.categories=>",ye.categories),p.debug(" formData.cat_slugs=>",ye.cat_slugs)},Le=async e=>{const a={[sa]:ye.customSlug,[na]:ye.desc,tags:ye.tag.dynamicTags.join(",")};await k.setBlockAttrs(he.pageId,a),p.debug("CommonblogMain保存属性到思源笔记,meta=>",a),!0!==e&&(await Te(),t.success(I("main.opt.success")))},Be=async e=>{X.value=!0,await Ce(!0),await De(!0),await Ie(!0),await Le(!0),p.debug("发布属性完成"),X.value=!1,!0!==e&&t.success(I("main.publish.oneclick.attr.finish"))},Xe=async()=>{const e=(await k.exportMdContent(he.pageId)).content;a.removeImage&&M.hasExternalImages(e)?l.confirm("检测到外链图片，由于平台限制，继续发布将剔除这些图片，以纯文本发布，是否继续？",I("main.opt.warning"),{confirmButtonText:I("main.opt.ok"),cancelButtonText:I("main.opt.cancel"),type:"warning"}).then((async()=>{await la()})).catch((()=>{})):await la()},la=async()=>{if(R.value){Z.value=!0;try{const e=a.apiType+"_PUBLISH_LIMIT";if((e=>{if(!a.limitRate)return!1;const l=C(e);if($(l))return!1;p.debug("checkLimit lastmodKey=>",e),p.debug("checkLimit lastmodDate=>",l);const i=Pe(l);return i<=a.limitSeconds&&(t.error("由于【"+a.apiType+"】平台的限制，每"+a.limitSeconds+"秒之内只能发布或者更新一次文章，距离上一次发布时间为："+i+"秒，仍需等待："+(a.limitSeconds-i)+"秒"),!0)})(e))return void(Z.value=!1);p.debug("验证通过，更新发布时间");const l=(new Date).toISOString();Me(e,l),await Be(!0);const i=x(a.apiType),o=new Y(a.apiType),s=T();let n;let u=(await k.exportMdContent(he.pageId)).content;if(u=await V.convertSiyuanLinkToPlatformLink(u,o),a.removeImage)u=M.removeImages(u);else if(me.getPicgoPostData().picgoEnabled){const e=await N.uploadPostImagesToBed(he.pageId,he.meta,u);e.hasImages&&(e.flag?u=e.mdContent:t.error(I("github.post.picgo.picbed.error")+"=>"+e.errmsg))}if(we.Html===i.pageType){const e=H(u);n=_e(e),s.removeH1&&(n=G(n))}else n=ae(u),s.removeH1&&(n=te(n));const d=new O;d.title=ye.title,d.wp_slug=ye.customSlug,d.description=n,d.categories=ye.categories,d.cate_slugs=ye.cat_slugs,d.mt_keywords=ye.tag.dynamicTags.join(","),d.dateCreated=new Date;const r=!0;let c;if(ue.value){c=ye.postid;if(!(await o.editPost(c,d,!0)))throw t.error("文章更新失败"),new Error("文章更新失败=>"+c);p.debug("文章已更新，postid=>",c)}else{if(c=await o.newPost(d,r),d.cate_slugs&&d.cate_slugs.length>0){c=c+"_"+d.cate_slugs[0]}p.debug("当前保存的posidKey=>",i.posidKey);const e={[i.posidKey||""]:c};await k.setBlockAttrs(he.pageId,e),p.debug("CommonblogMain发布成功，保存postid,meta=>",e),p.debug("文章发布成功，postid=>",c)}await Te(),ue.value?t.success(I("main.opt.status.updated")):t.success(I("main.opt.status.publish"))}catch(e){Z.value=!1,p.error("发布异常",e),t.error({dangerouslyUseHTMLString:!0,message:I("main.opt.failure")+"=>"+e})}Z.value=!1}else t.error(I("setting.blog.vali.tip.metaweblog"))},ua=async()=>{ee.value=!0,l.confirm(I("main.opt.warning.tip"),I("main.opt.warning"),{confirmButtonText:I("main.opt.ok"),cancelButtonText:I("main.opt.cancel"),type:"warning"}).then((async()=>{await da(!0),ee.value=!1,t.warning(I("main.opt.status.cancel"))})).catch((e=>{throw t({type:"error",message:I("main.opt.failure")}),ee.value=!1,new Error(e)}))},da=async e=>{const l=x(a.apiType);p.debug("准备取消发布，postid=>",ye.postid);const i={[l.posidKey||""]:""};await k.setBlockAttrs(he.pageId,i),p.debug("MetaweblogMain取消发布,meta=>",i);try{const e=new Y(a.apiType);if(!(await e.deletePost(ye.postid)))throw t.error("文章删除失败"),new Error("文章删除失败")}catch(o){p.error("强行删除一次",o)}e&&await Te()};return xe((()=>a.isReload),(async()=>{await Te(),p.debug(a.apiType+"_Main检测到设置更新操作，刷新页面")})),xe((()=>a.isMainReload),(async()=>{await Te(),p.debug(a.apiType+"_Main左右切换tab，刷新页面")})),(t,l)=>{const p=i,k=o,M=s,P=n,T=u,C=d,D=f,S=v,V=r,$=c,I=w,E=_,B=Ze("font-awesome-icon"),x=g,Y=m,U=y,O=b,N=h;return Ue(),He(N,null,{default:Ge((()=>[le.value?Fe("",!0):(Ue(),He(U,{key:0,class:"common-main"},{default:Ge((()=>[je(p,{class:"top-version-tip",title:A.value+L.value,type:"info",closable:!1},null,8,["title"]),e.useCat&&ue.value?(Ue(),He(p,{key:0,class:"top-version-tip",title:"由于语雀平台的限制，暂时不支持编辑所属知识库。如果您想移动文档，请先点击取消删除该文档，然后重新选择新的知识库发布。",type:"warning",closable:!1})):Fe("",!0),R.value?Fe("",!0):(Ue(),He(p,{key:1,class:"top-version-tip",title:t.$t("setting.blog.vali.tip.metaweblog"),type:"error",closable:!1},null,8,["title"])),je(Y,{"label-width":"120px"},{default:Ge((()=>[Ke("div",at,[je(M,{label:t.$t("main.title")},{default:Ge((()=>[je(k,{modelValue:ye.title,"onUpdate:modelValue":l[0]||(l[0]=e=>ye.title=e),disabled:!0},null,8,["modelValue"])])),_:1},8,["label"])]),je(M,{label:t.$t("main.publish.editmode")},{default:Ge((()=>[je(T,null,{default:Ge((()=>[je(P,{type:ie.value?"default":"primary",onClick:be},{default:Ge((()=>[ze(qe(t.$t("main.publish.editmode.simple")),1)])),_:1},8,["type"]),je(P,{type:ie.value?"primary":"default",onClick:ke},{default:Ge((()=>[ze(qe(t.$t("main.publish.editmode.complex")),1)])),_:1},8,["type"])])),_:1})])),_:1},8,["label"]),ie.value?(Ue(),He(M,{key:0,label:t.$t("main.force.refresh")},{default:Ge((()=>[je(C,{modelValue:se.value,"onUpdate:modelValue":l[1]||(l[1]=e=>se.value=e)},null,8,["modelValue"]),se.value?Fe("",!0):(Ue(),He(p,{key:0,title:t.$t("main.force.refresh.tip"),type:"warning",closable:!1},null,8,["title"]))])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:1,label:t.$t("main.slug")},{default:Ge((()=>[je(k,{modelValue:ye.customSlug,"onUpdate:modelValue":l[2]||(l[2]=e=>ye.customSlug=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:2},{default:Ge((()=>[je(S,{modelValue:ye.checkList,"onUpdate:modelValue":l[3]||(l[3]=e=>ye.checkList=e)},{default:Ge((()=>[je(D,{label:"1"},{default:Ge((()=>[ze(qe(t.$t("main.use.google.translate")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(M,{key:3},{default:Ge((()=>[je(P,{type:"primary",class:"make-slug-btn",onClick:Ce,loading:J.value},{default:Ge((()=>[ze(qe(J.value?t.$t("main.opt.loading"):t.$t("main.auto.fetch.slug")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(M,{key:4,label:t.$t("main.use.hash")},{default:Ge((()=>[je(C,{modelValue:ne.value,"onUpdate:modelValue":l[4]||(l[4]=e=>ne.value=e)},null,8,["modelValue"]),ne.value?Fe("",!0):(Ue(),He(p,{key:0,title:t.$t("main.use.hash.tip"),type:"warning",closable:!1},null,8,["title"]))])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:5,label:t.$t("main.desc")},{default:Ge((()=>[je(k,{type:"textarea",modelValue:ye.desc,"onUpdate:modelValue":l[5]||(l[5]=e=>ye.desc=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:6},{default:Ge((()=>[je(P,{type:"primary",onClick:De,loading:W.value},{default:Ge((()=>[ze(qe(W.value?t.$t("main.opt.loading"):t.$t("main.auto.fetch.desc")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),ie.value?(Ue(),He(M,{key:7,label:t.$t("main.create.time")},{default:Ge((()=>[je(V,{type:"datetime",modelValue:ye.created,"onUpdate:modelValue":l[6]||(l[6]=e=>ye.created=e),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:t.$t("main.create.time.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:8,label:t.$t("main.tag.auto.switch")},{default:Ge((()=>[je(C,{modelValue:ce.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ce.value=e)},null,8,["modelValue"])])),_:1},8,["label"])):Fe("",!0),je(M,{label:t.$t("main.tag")},{default:Ge((()=>[(Ue(!0),Oe(Je,null,We(ye.tag.dynamicTags,(e=>(Ue(),He($,{key:e,class:"mx-1",closable:"","disable-transitions":!1,onClose:a=>(e=>{ye.tag.dynamicTags.splice(ye.tag.dynamicTags.indexOf(e),1)})(e)},{default:Ge((()=>[ze(qe(e),1)])),_:2},1032,["onClose"])))),128)),ye.tag.inputVisible?(Ue(),He(k,{key:0,ref_key:"tagRefInput",ref:Se,modelValue:ye.tag.inputValue,"onUpdate:modelValue":l[8]||(l[8]=e=>ye.tag.inputValue=e),class:"ml-1 w-20",size:"small",onKeyup:Qe($e,["enter"]),onBlur:$e},null,8,["modelValue","onKeyup"])):(Ue(),He(P,{key:1,class:"button-new-tag ml-1 el-tag",size:"small",onClick:Ve},{default:Ge((()=>[ze(qe(t.$t("main.tag.new")),1)])),_:1}))])),_:1},8,["label"]),ie.value?(Ue(),He(M,{key:9},{default:Ge((()=>[je(P,{type:"primary",onClick:Ie,loading:Q.value},{default:Ge((()=>[ze(qe(Q.value?t.$t("main.opt.loading"):t.$t("main.auto.fetch.tag")),1)])),_:1},8,["loading"])])),_:1})):Fe("",!0),a.useCat?(Ue(),He(M,{key:10,label:t.$t("main.cat"),style:{width:"100%"}},{default:Ge((()=>[pe.value?(Ue(),He(E,{key:0,modelValue:ye.cat.categorySelected,"onUpdate:modelValue":l[9]||(l[9]=e=>ye.cat.categorySelected=e),placeholder:"请选择","no-data-text":"暂无数据",class:"m-2",size:"default",onChange:Ee},{default:Ge((()=>[(Ue(!0),Oe(Je,null,We(ye.cat.categoryList,(e=>(Ue(),He(I,{key:e.value,label:e.label,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(Ue(),He(E,{key:1,modelValue:ye.cat.categorySelected,"onUpdate:modelValue":l[10]||(l[10]=e=>ye.cat.categorySelected=e),disabled:"",placeholder:"请选择","no-data-text":"暂无数据",class:"m-2",size:"default",onChange:Ee},{default:Ge((()=>[(Ue(!0),Oe(Je,null,We(ye.cat.categoryList,(e=>(Ue(),He(I,{key:e.value,label:e.label,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1},8,["label"])):Fe("",!0),ie.value?(Ue(),He(M,{key:11,label:t.$t("main.opt.quick")},{default:Ge((()=>[je(P,{type:"primary",onClick:Be,loading:X.value},{default:Ge((()=>[ze(qe(X.value?t.$t("main.opt.loading"):t.$t("main.publish.oneclick.attr")),1)])),_:1},8,["loading"]),je(P,{type:"primary",onClick:Le},{default:Ge((()=>[ze(qe(t.$t("main.save.attr.to.siyuan")),1)])),_:1})])),_:1},8,["label"])):Fe("",!0),je(M,{label:t.$t("github.post.picgo.use")},{default:Ge((()=>[je(C,{modelValue:Ne(ge).picgoEnabled,"onUpdate:modelValue":l[11]||(l[11]=e=>Ne(ge).picgoEnabled=e),onChange:Ne(me).picgoOnChange},null,8,["modelValue","onChange"]),Ne(ge).picgoEnabled&&!Ne(re)()?(Ue(),He(x,{key:0,content:t.$t("siyuan.browser.menu.picture.btn"),class:"box-item",effect:"light",placement:"right","popper-class":"publish-menu-tooltip"},{default:Ge((()=>[je(P,{class:"pic-manage-btn",type:"success",size:"small",onClick:l[12]||(l[12]=e=>Ne(me).handlePicgoManage(he.pageId))},{default:Ge((()=>[je(B,{icon:"fa-solid fa-image"}),ze(" "+qe(t.$t("setting.picgo.manage")),1)])),_:1})])),_:1},8,["content"])):Fe("",!0),Ne(ge).picgoEnabled?(Ue(),He(p,{key:1,closable:!1,title:t.$t("github.post.picgo.use.tip"),type:"warning"},null,8,["title"])):Fe("",!0)])),_:1},8,["label"]),je(M,{label:""},{default:Ge((()=>[je(P,{type:"primary",onClick:Xe,loading:Z.value},{default:Ge((()=>[ze(qe(Z.value?t.$t("main.publish.loading"):ue.value?t.$t("main.update"):t.$t("main.publish")),1)])),_:1},8,["loading"]),ue.value?(Ue(),He(P,{key:0,loading:ee.value,onClick:ua},{default:Ge((()=>[ze(qe(t.$t("main.cancel")),1)])),_:1},8,["loading"])):Fe("",!0)])),_:1}),je(M,null,{default:Ge((()=>[je(P,{type:"danger",text:"",disabled:""},{default:Ge((()=>[ze(qe(ue.value?t.$t("main.publish.status.published"):t.$t("main.publish.status.unpublish")),1)])),_:1}),ue.value?(Ue(),Oe("a",{key:0,href:de.value,title:de.value,target:"_blank"},qe(t.$t("main.publish.see.preview")),9,tt)):Fe("",!0)])),_:1})])),_:1})])),_:1})),je(O,{loading:le.value,rows:5,animated:""},null,8,["loading"])])),_:1})}}}),[["__scopeId","data-v-ab51a096"]]),it=Be({__name:"LiandiMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_LIANDI);return(e,l)=>(Ue(),He(lt,{"is-main-reload":a.isMainReload,"is-reload":a.isReload,"api-type":t.value,"page-id":a.pageId,"limit-rate":!0,"limit-seconds":360,"remove-image":!0},null,8,["is-main-reload","is-reload","api-type","page-id"]))}}),ot=Be({__name:"YuqueMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_YUQUE);return(e,l)=>(Ue(),He(lt,{"api-type":t.value,"is-main-reload":a.isMainReload,"is-reload":a.isReload,"page-id":a.pageId,"use-cat":!0},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),st=Be({__name:"KmsMain",props:{isReload:{type:Boolean,default:!1},isMainReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=Re(ge.API_TYPE_KMS);return(e,l)=>(Ue(),He(lt,{"api-type":t.value,"is-main-reload":a.isMainReload,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"]))}}),nt={key:1},ut=Be({__name:"PlatformMain",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=P.getLogger("components/publish/tab/PlatformMain.vue"),{tabCountStore:l,vuepressEnabled:o,hugoEnabled:s,hexoEnabled:n,jekyllEnabled:u,jvueEnabled:d,confEnabled:r,cnblogsEnabled:c,wordpressEnabled:p,liandiEnabled:g,yuqueEnabled:m,kmsEnabled:y,doCount:h}=Te(),b=Re(!1),f=Ae({dynamicConfigArray:[],githubArray:[],metaweblogArray:[],wordpressArray:[]}),v=e=>{const a=[];return e.forEach((e=>{const t=new De(e.platformType,e.platformKey,e.platformName),l="switch-"+e.platformKey,i=Se(l);t.modelValue=i,i&&a.push(t),t.yamlConverter=Ve(e.platformKey)})),a},w=()=>{h();const e=Ce();f.dynamicConfigArray=v(e.totalCfg||[]),f.githubArray=v(e.githubCfg||[]),f.metaweblogArray=v(e.metaweblogCfg||[]),f.wordpressArray=v(e.wordpressCfg||[]),t.debug("dynamicJsonCfg=>",JSON.stringify(e)),t.debug("平台设置初始化")},_=()=>{b.value=!b.value};return xe((()=>a.isReload),((e,a)=>{w()})),Ye((()=>{w()})),(e,t)=>{const h=k,v=M,w=i;return Ne(l).tabCount>0?(Ue(),He(v,{key:0,type:"border-card",onTabChange:_},{default:Ge((()=>[Ne(o)?(Ue(),He(h,{key:0,label:e.$t("main.publish.to.vuepress")},{default:Ge((()=>[je(ja,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(s)?(Ue(),He(h,{key:1,label:e.$t("main.publish.to.hugo")},{default:Ge((()=>[je(Ka,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(n)?(Ue(),He(h,{key:2,label:e.$t("main.publish.to.hexo")},{default:Ge((()=>[je(Fa,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(u)?(Ue(),He(h,{key:3,label:e.$t("main.publish.to.jekyll")},{default:Ge((()=>[je(za,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(d)?(Ue(),He(h,{key:4,label:e.$t("main.publish.to.jvue")},{default:Ge((()=>[je(Qa,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(r)?(Ue(),He(h,{key:5,label:e.$t("main.publish.to.conf")},{default:Ge((()=>[je(Xa,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(c)?(Ue(),He(h,{key:6,label:e.$t("main.publish.to.cnblogs")},{default:Ge((()=>[je(Za,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(p)?(Ue(),He(h,{key:7,label:e.$t("main.publish.to.wordpress")},{default:Ge((()=>[je(et,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(g)?(Ue(),He(h,{key:8,label:e.$t("main.publish.to.liandi")},{default:Ge((()=>[je(it,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(m)?(Ue(),He(h,{key:9,label:e.$t("main.publish.to.yuque")},{default:Ge((()=>[je(ot,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),Ne(y)?(Ue(),He(h,{key:10,label:e.$t("main.publish.to.kms")},{default:Ge((()=>[je(st,{"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["is-main-reload","is-reload","page-id"])])),_:1},8,["label"])):Fe("",!0),(Ue(!0),Oe(Je,null,We(f.githubArray,(e=>(Ue(),He(h,{key:e.platformKey,label:e.platformName},{default:Ge((()=>[je(Ga,{"is-main-reload":b.value,"is-reload":a.isReload,"api-type":e.platformKey,"page-id":a.pageId,"yaml-converter":e.yamlConverter},null,8,["is-main-reload","is-reload","api-type","page-id","yaml-converter"])])),_:2},1032,["label"])))),128)),(Ue(!0),Oe(Je,null,We(f.metaweblogArray,(e=>(Ue(),He(h,{key:e.platformKey,label:e.platformName},{default:Ge((()=>[je(Wa,{"api-type":e.platformKey,"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])])),_:2},1032,["label"])))),128)),(Ue(!0),Oe(Je,null,We(f.wordpressArray,(e=>(Ue(),He(h,{key:e.platformKey,label:e.platformName},{default:Ge((()=>[je(Wa,{"api-type":e.platformKey,"is-main-reload":b.value,"is-reload":a.isReload,"page-id":a.pageId},null,8,["api-type","is-main-reload","is-reload","page-id"])])),_:2},1032,["label"])))),128))])),_:1})):(Ue(),Oe("div",nt,[je(w,{class:"top-version-tip",title:e.$t("config.platform.none"),type:"error",closable:!1},null,8,["title"])]))}}}),dt=pe(Be({__name:"PublishService",props:{isReload:{type:Boolean,default:!1},pageId:{type:String,default:void 0}},setup(e){const a=e,t=P.getLogger("components/publish/PublishService.vue"),l=Re("platform-main"),i=Re(!1),o=e=>{const a=e.paneName;t.debug("serviceTabChange=>",a),i.value=!i.value};return(e,t)=>{const s=k,n=M;return Ue(),He(n,{"model-value":l.value,"tab-position":"left",onTabClick:o},{default:Ge((()=>[je(s,{class:"pane-platform-main-body",name:"platform-main",label:e.$t("service.tab.publish.service")},{default:Ge((()=>[je(ut,{"is-reload":i.value,"page-id":a.pageId},null,8,["is-reload","page-id"])])),_:1},8,["label"]),je(s,{name:"platform-setting",label:e.$t("service.tab.publish.setting")},{default:Ge((()=>[je($e,{"is-reload":i.value},null,8,["is-reload"])])),_:1},8,["label"]),je(s,{name:"service-switch",label:e.$t("service.tab.service.switch")},{default:Ge((()=>[je(Ie,{"is-reload":i.value},null,8,["is-reload"])])),_:1},8,["label"]),je(s,{name:"dynamic-platform",label:e.$t("dynamic.platform.new")},{default:Ge((()=>[je(Ee)])),_:1},8,["label"]),je(s,{name:"picgo-setting",label:e.$t("picgo.pic.setting")},{default:Ge((()=>[je(Le)])),_:1},8,["label"])])),_:1},8,["model-value"])}}}),[["__scopeId","data-v-eec62261"]]);export{dt as P};
